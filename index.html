<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="phaser.min.js"></script>
    <script src="error.js"></script>
    <script src="loader.js"></script>
    <script src="trees.js"></script>
    <script src="tile.js"></script>
    <script src="map.js"></script>
    <script src="carai.js"></script>
    <script src="car.js"></script>
</head>
<body>
    <script>
    var game = new Phaser.Game('99', '99', Phaser.CANVAS, '', { preload: preload, create: create, update: update });
    var loader = new Loader();
    var map = new Map();
    var houses = [];
    var config;
    var cursors;

    function loadConfig(progress, key, success, totalLoadedFile, totalFiles) {
        if (key === 'config') {
            config = game.cache.getJSON('config');
            loader.load();
        }
    }

    function step() {
        map.update();
    }

    function preload() {
        game.load.onFileComplete.add(loadConfig, this);
        game.load.text('world', 'world.dat');
        game.load.json('config', 'config.json');
    }

    function create() {
        cursors = game.input.keyboard.createCursorKeys();

        map.loadMap(game.cache.getText('world'));
        map.initTiles(loader.houses, loader.trees, loader.cars);

        game.world.resize(map.getWidth(), map.getHeight());
        map.draw();

        var dt = 1. / config.World.stepsPerSecond;
        game.time.events.loop(dt, step);
    }

    function update() {
        if (cursors.up.isDown) {
            game.camera.y -= 20;
        } else if (cursors.down.isDown) {
            game.camera.y += 20;
        }

        if (cursors.left.isDown) {
            game.camera.x -= 20;
        } else if (cursors.right.isDown) {
            game.camera.x += 20;
        }
    }
    </script>
</body>
</html>
