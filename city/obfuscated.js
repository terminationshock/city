'use strict';function error(_0x230a78,_0x4ac97e,_0xf58ccb){console['error'](_0x230a78);if(_0xf58ccb===null){throw new Error(_0x230a78);}else{_0xf58ccb['call'](_0x4ac97e);}}function convertInt(_0x46d106){return parseInt(_0x46d106,0xa);}function getPermutations(_0x3bbef8,_0x37a0d2){var _0x3efc48=[];for(var _0x6ac266=0x0;_0x6ac266<_0x37a0d2;_0x6ac266++){var _0x3136f3=Math['floor'](_0x3bbef8['length']*_0x6ac266/_0x37a0d2);var _0x269646=_0x3bbef8['slice'](_0x3136f3);var _0xbeac9b=_0x3bbef8['slice'](0x0,_0x3136f3);_0x3efc48['push'](_0x269646['concat'](_0xbeac9b));}return _0x3efc48;}function normalizeAngle(_0x32f76f){if(_0x32f76f>=0x168){_0x32f76f-=0x168;}return _0x32f76f;}function generateRandomId(){var _0x20f447='';_0x20f447+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x20f447+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x20f447+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);return _0x20f447;}function getTurnDirection(_0x271ea3,_0x22790b){if(0x0<_0x22790b-_0x271ea3&&_0x22790b-_0x271ea3<0xb4){return 0x1;}else if(-0xb4<=_0x22790b-_0x271ea3&&_0x22790b-_0x271ea3<0x0){return-0x1;}else if(_0x22790b-_0x271ea3>=0xb4){return-0x1;}else if(-0xb4>_0x22790b-_0x271ea3){return 0x1;}return 0x0;}function getDeltaHead(_0x479999,_0x330ba2){var _0x584824=getTurnDirection(_0x479999,_0x330ba2);var _0x30c586=0x0;if(_0x584824<0x0){if(_0x330ba2>_0x479999){_0x30c586=_0x479999-(_0x330ba2-0x168);}else{_0x30c586=_0x479999-_0x330ba2;}}else if(_0x584824>0x0){if(_0x330ba2<_0x479999){_0x30c586=_0x330ba2+0x168-_0x479999;}else{_0x30c586=_0x330ba2-_0x479999;}}return _0x30c586;}function getCurve(_0x41edf0,_0x4878ce,_0x2df224,_0x345364,_0x248d7a){var _0x4edbe5=Math['sin'](_0x2df224*Math['PI']/0xb4);var _0x2fc94c=-Math['cos'](_0x2df224*Math['PI']/0xb4);var _0x4957d7=Math['sin'](_0x345364*Math['PI']/0xb4);var _0xfe1fd9=-Math['cos'](_0x345364*Math['PI']/0xb4);var _0x5e5250=getDeltaHead(_0x2df224,_0x345364);var _0x248d7a=_0x248d7a*_0x5e5250;if(_0x5e5250===0x0){return new BezierCurve([_0x41edf0,_0x4878ce]);}return new BezierCurve([_0x41edf0,new Point(_0x41edf0['x']+_0x248d7a*_0x4edbe5,_0x41edf0['y']+_0x248d7a*_0x2fc94c),new Point(_0x4878ce['x']-_0x248d7a*_0x4957d7,_0x4878ce['y']-_0x248d7a*_0xfe1fd9),_0x4878ce]);}function linesAreEqual(_0x5b644c,_0x25818f){if(_0x5b644c['length']!==_0x25818f['length']){return![];}for(var _0x5d84cb=0x0;_0x5d84cb<_0x5b644c['length'];_0x5d84cb++){if(_0x5b644c[_0x5d84cb]['start']['x']!==_0x25818f[_0x5d84cb]['start']['x']||_0x5b644c[_0x5d84cb]['start']['y']!==_0x25818f[_0x5d84cb]['start']['y']){return![];}if(_0x5b644c[_0x5d84cb]['end']['x']!==_0x25818f[_0x5d84cb]['end']['x']||_0x5b644c[_0x5d84cb]['end']['y']!==_0x25818f[_0x5d84cb]['end']['y']){return![];}}return!![];}class Point{constructor(_0xfb70da,_0x4a5ecd){this['x']=_0xfb70da;this['y']=_0x4a5ecd;}['equals'](_0x401250,_0x301e88){return this['x']===_0x401250&&this['y']===_0x301e88;}};class Loader{['load'](){this['streets']=['g0000','r0001','r0005','r0009','r0013','r0017','r0021','r0045','r0049','r0053','r0057','r0061','r0065','r0069','r0073','r0077','r0081','r0085'];this['houses']=['h0001','h0005','h0009','h0013','h0017','h0021','h0025','h0029','h0033','h0037','h0041','h0045','h0049','h0053','h0057','h0061','h0065','h0069','h0073','h0077','h0081','h0085','h0089','h0093','h0097','h0101','h0105','h0109','h0113','h0117','h0121','h0125','h0129','h0133','h0137','h0141','h0145','h0149','h0153','h0157','h0161','h0165','h0169','h0173','h0177','h0181','h0185','h0189','h0193','h0197','h0201','h0205','h0209','h0213','h0217','h0221','h0225','h0229','h0233','h0237','h0241','h0245','h0249','h0253'];this['trees']=['t01','t02','t03','t04','t05','t06','t07','t08','t09','t10','t11'];this['cars']=['v01','v02','v03','v04','v05','v06','v07','v08','v09','v10','v11','v12'];this['trams']=['v00'];this['streets']['forEach'](function(_0xd2fd6){game['load']['image'](_0xd2fd6,'city/img/'+_0xd2fd6+'.png');});this['houses']['forEach'](function(_0x107be5){game['load']['image'](_0x107be5,'city/img/'+_0x107be5+'.png');});this['trees']['forEach'](function(_0x53930a){game['load']['image'](_0x53930a,'city/img/'+_0x53930a+'.png');});this['cars']['forEach'](function(_0x37e1e3){game['load']['spritesheet'](_0x37e1e3,'city/img/'+_0x37e1e3+'.png',config['Car']['imgSize'],config['Car']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Car']['numTypes']);});this['trams']['forEach'](function(_0x372f07){game['load']['spritesheet'](_0x372f07,'city/img/'+_0x372f07+'.png',config['Tram']['imgSize'],config['Tram']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Tram']['numTypes']);});}};class Trees{constructor(_0x15dfc8,_0x4f6ba8){this['tile']=_0x15dfc8;this['treeImages']=_0x4f6ba8;this['trees']=[];this['sprites']=[];}['generateTrees'](){for(var _0x5ae03a=0x0;_0x5ae03a<config['Tree']['numTrees'];_0x5ae03a++){var _0x5e44d6=this['newTree']();if(_0x5e44d6!==null){this['trees']['push'](_0x5e44d6);}}this['trees']['sort'](function(_0xb0defb,_0x37744c){return _0xb0defb['y']-_0x37744c['y'];});}['newTree'](){var _0x4c6d4d=this['treeImages'][Math['floor'](Math['random']()*this['treeImages']['length'])];var _0x5a5aaa=game['cache']['getImage'](_0x4c6d4d);var _0x1ae0cd=this['tile']['imgX']+Math['floor'](Math['random']()*(config['Tile']['width']-_0x5a5aaa['width']));var _0x176fd6=this['tile']['imgY']+Math['floor'](Math['random']()*config['Tile']['height'])-_0x5a5aaa['height'];var _0x4e4c41=_0x1ae0cd+Math['floor'](_0x5a5aaa['width']/0x2);var _0x4cd724=_0x176fd6+_0x5a5aaa['height'];if(this['tile']['inside'](_0x4e4c41,_0x4cd724,config['Tree']['insideFactor'])){return{'y':_0x4cd724,'tree':_0x4c6d4d,'imgX':_0x1ae0cd,'imgY':_0x176fd6};}return null;}['draw'](_0x5e1fd9){for(var _0x4adf3c of this['trees']){this['sprites']['push'](game['add']['image'](_0x4adf3c['imgX'],_0x4adf3c['imgY'],_0x4adf3c['tree']));}this['sprites']['forEach'](_0x1188b7=>_0x5e1fd9['add'](_0x1188b7));}['remove'](){this['sprites']['forEach'](_0x3ae86f=>_0x3ae86f['destroy']());}};class Tracks{constructor(_0x363b5f){this['tile']=_0x363b5f;this['track']={};this['newTrack']={};this['trackPoints']=null;this['headsFrom']=[];this['headsTo']=[];this['lineSegments']=[];}['generate'](_0xfc026b){if(this['tile']['isHouse']()){return;}this['newTrack']={};if(_0xfc026b['length']===0x1&&_0xfc026b[0x0]===this['tile']['hash']){this['newTrack'][0x3c]=[0xf0];this['newTrack'][0x78]=[0x12c];this['newTrack'][0xf0]=[0x3c];this['newTrack'][0x12c]=[0x78];return;}var _0xb711fb=[];var _0xee0ba8=_0xfc026b['indexOf'](this['tile']['hash']);while(_0xee0ba8!=-0x1){_0xb711fb['push'](_0xee0ba8);_0xee0ba8=_0xfc026b['indexOf'](this['tile']['hash'],_0xee0ba8+0x1);}for(_0xee0ba8 of _0xb711fb){var _0x9cd387=_0xee0ba8+0x1;var _0x2d8c3d=_0xee0ba8-0x1;if(_0x9cd387===_0xfc026b['length']){_0x9cd387=0x0;}if(_0x2d8c3d===-0x1){_0x2d8c3d=_0xfc026b['length']-0x1;}var _0x2aba9f=null;var _0x22d047=null;if(_0xfc026b[_0x2d8c3d]in this['tile']['neighbourConnections']&&_0xfc026b[_0x9cd387]in this['tile']['neighbourConnections']){_0x2aba9f=this['tile']['neighbourConnections'][_0xfc026b[_0x2d8c3d]];_0x22d047=this['tile']['neighbourConnections'][_0xfc026b[_0x9cd387]];}else if(_0xfc026b[_0x2d8c3d]in this['tile']['neighbourConnections']){_0x2aba9f=this['tile']['neighbourConnections'][_0xfc026b[_0x2d8c3d]];_0x22d047=normalizeAngle(_0x2aba9f+0xb4);}else if(_0xfc026b[_0x9cd387]in this['tile']['neighbourConnections']){_0x22d047=this['tile']['neighbourConnections'][_0xfc026b[_0x9cd387]];_0x2aba9f=normalizeAngle(_0x22d047+0xb4);}if(_0x22d047!==null){if(_0x2aba9f in this['newTrack']){this['newTrack'][_0x2aba9f]['push'](_0x22d047);}else{this['newTrack'][_0x2aba9f]=[_0x22d047];}}}}['finalize'](){var _0x4c41cf=null;for(var _0x45cecc in this['newTrack']){if(_0x45cecc in this['track']){for(_0x4c41cf=0x0;_0x4c41cf<this['newTrack'][_0x45cecc]['length'];_0x4c41cf++){this['track'][_0x45cecc]['push'](this['newTrack'][_0x45cecc][_0x4c41cf]);}}else{this['track'][_0x45cecc]=this['newTrack'][_0x45cecc];}}for(var _0x2f5a2b in this['track']){var _0xeb9581=[];for(_0x4c41cf=0x0;_0x4c41cf<this['track'][_0x2f5a2b]['length'];_0x4c41cf++){if(!_0xeb9581['includes'](this['track'][_0x2f5a2b][_0x4c41cf])){_0xeb9581['push'](this['track'][_0x2f5a2b][_0x4c41cf]);}}this['track'][_0x2f5a2b]=_0xeb9581;}this['headsFrom']=Object['keys'](this['track']);this['headsTo']=Object['values'](this['track']);this['newTrack']={};this['lineSegments']=[];for(var _0x1f41d2 in this['track']){var _0x2f5a2b=normalizeAngle(convertInt(_0x1f41d2)+0xb4);for(var _0x412d3b of this['track'][_0x1f41d2]){var _0x4ea410=this['tile']['getLaneStartPoint'](_0x2f5a2b,config['Street']['laneDrive'],0x1);var _0x3865a5=this['tile']['getLaneTargetPoint'](_0x412d3b,config['Street']['laneDrive'],0.24);var _0x2c728e=[];if(getTurnDirection(_0x2f5a2b,_0x412d3b)===-0x1){_0x2c728e['push'](new Phaser['Line'](Math['round'](_0x4ea410['x']),Math['round'](_0x4ea410['y']),Math['round'](this['tile']['x']),Math['round'](this['tile']['y'])));_0x2c728e['push'](new Phaser['Line'](Math['round'](this['tile']['x']),Math['round'](this['tile']['y']),Math['round'](_0x3865a5['x']),Math['round'](_0x3865a5['y'])));}else{_0x2c728e['push'](new Phaser['Line'](Math['round'](_0x4ea410['x']),Math['round'](_0x4ea410['y']),Math['round'](_0x3865a5['x']),Math['round'](_0x3865a5['y'])));}this['lineSegments']['push'](_0x2c728e);}}}['abort'](){this['newTrack']={};}['addSingleTrack'](_0x194211,_0x509353){var _0x2d7ad8=normalizeAngle(convertInt(_0x194211)+0xb4);for(var _0x5dae22=-0x1;_0x5dae22<=0x1;_0x5dae22+=0x2){var _0x3026c4=this['tile']['getLaneStartPoint'](_0x2d7ad8,config['Street']['laneDrive']+_0x5dae22*config['Track']['width']/0x2,0x1);var _0x5677f9=this['tile']['getLaneStartPoint'](_0x2d7ad8,config['Street']['laneDrive']+_0x5dae22*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x2ad10a=this['tile']['getLaneTargetPoint'](_0x509353,config['Street']['laneDrive']+_0x5dae22*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x5d77a9=this['tile']['getLaneTargetPoint'](_0x509353,config['Street']['laneDrive']+_0x5dae22*config['Track']['width']/0x2,0x1);if(_0x2d7ad8===_0x509353){this['trackPoints']['moveTo'](_0x3026c4['x'],_0x3026c4['y']);this['trackPoints']['lineTo'](_0x5d77a9['x'],_0x5d77a9['y']);}else{var _0x2551f7=getCurve(_0x5677f9,_0x2ad10a,_0x2d7ad8,_0x509353,config['Track']['bezierFactor'])['getPath'](config['Track']['curveFactor']);this['trackPoints']['moveTo'](_0x3026c4['x'],_0x3026c4['y']);this['trackPoints']['lineTo'](_0x2551f7[0x0]['x'],_0x2551f7[0x0]['y']);for(var _0x2debf6 of _0x2551f7){this['trackPoints']['lineTo'](_0x2debf6['x'],_0x2debf6['y']);}this['trackPoints']['lineTo'](_0x5d77a9['x'],_0x5d77a9['y']);}}}['getRandomConnection'](){return this['headsTo'][Math['floor'](Math['random']()*this['headsTo']['length'])];}['hasTracks'](){return this['headsFrom']['length']>0x0;}['getTrackKeys'](){return Object['keys'](this['track']);}['getLineSegments'](){return this['lineSegments'];}['isNotIntersecting'](){if(this['isDeadEnd']()){return![];}if(this['tile']['linesIntersectInside'](this['lineSegments'])){return![];}return!![];}['isDeadEnd'](){for(var _0x2df49c in this['track']){for(var _0x37cad1 of this['track'][_0x2df49c]){if(_0x37cad1===convertInt(_0x2df49c)){return!![];}}}return![];}['isStraight'](){var _0x119c4d=this['headsFrom']['map'](_0x59bb8d=>convertInt(_0x59bb8d));if(_0x119c4d['length']>0x2){return![];}for(var _0x94dbf3 in this['track']){if(this['track'][_0x94dbf3]['length']>0x1){return![];}if(normalizeAngle(convertInt(_0x94dbf3)+0xb4)!==convertInt(this['track'][_0x94dbf3])){return![];}if(_0x119c4d['length']===0x2&&!_0x119c4d['includes'](this['track'][_0x94dbf3][0x0])){return![];}}return!![];}['getStraights'](){if(this['isStraight']()){return Object['keys'](this['track'])['map'](_0x211e92=>normalizeAngle(convertInt(_0x211e92)+0xb4));}return null;}['getHeadsFrom'](_0x4e0d04){if(_0x4e0d04 in this['track']){return this['track'][_0x4e0d04];}return null;}['draw'](_0x1d7c7d){if(this['trackPoints']!==null){_0x1d7c7d['removeChild'](this['trackPoints']);this['trackPoints']['destroy']();}if(this['hasTracks']()||Object['keys'](this['newTrack'])['length']>0x0){this['trackPoints']=new Phaser['Graphics'](game,0x0,0x0);var _0x2e3ab7=null;var _0x219972=null;var _0x5b0711=null;this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['color']),0x1);for(_0x2e3ab7 in this['track']){_0x5b0711=this['track'][_0x2e3ab7];for(_0x219972 of _0x5b0711){this['addSingleTrack'](_0x2e3ab7,_0x219972);}}this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['activeColor']),0x1);for(_0x2e3ab7 in this['newTrack']){_0x5b0711=this['newTrack'][_0x2e3ab7];for(_0x219972 of _0x5b0711){this['addSingleTrack'](_0x2e3ab7,_0x219972);}}_0x1d7c7d['add'](this['trackPoints']);}}['highlight'](_0x523891,_0x5877f8){if(_0x523891===null&&_0x5877f8===null){for(var _0x3a41a9 in this['track']){this['newTrack'][_0x3a41a9]=this['track'][_0x3a41a9]['slice'](0x0);}}else if(_0x5877f8===null){this['newTrack'][_0x523891]=this['track'][_0x523891]['slice'](0x0);}else{var _0x1d1406=[_0x5877f8];if(_0x523891 in this['newTrack']){_0x1d1406=_0x1d1406['concat'](this['newTrack'][_0x523891]);}this['newTrack'][_0x523891]=_0x1d1406;}}};class TramStop{constructor(_0x58edf7){this['tile']=_0x58edf7;this['canvas']=null;}['draw'](_0x241acd){if(this['canvas']!==null){_0x241acd['removeChild'](this['canvas']);this['canvas']['destroy']();}if(_0x241acd!==null){this['canvas']=new Phaser['Graphics'](game,this['tile']['imgX'],this['tile']['imgY']);var _0x31bab4=this['tile']['getStraightTracks']();for(var _0x3b677f of _0x31bab4){var _0xb95460=this['tile']['getClosestPointInLane'](this['tile']['x'],this['tile']['y'],_0x3b677f,config['Stop']['lane']);_0xb95460['x']-=this['tile']['imgX'];_0xb95460['y']-=this['tile']['imgY'];var _0x4ef3e3=Math['sin'](_0x3b677f*Math['PI']/0xb4)*0x14;var _0x248fc4=-Math['cos'](_0x3b677f*Math['PI']/0xb4)*0x14;if(_0x3b677f===0x78||_0x3b677f===0x12c){_0xb95460['x']-=_0x4ef3e3;_0xb95460['y']-=_0x248fc4;}_0x4ef3e3=Math['sin'](_0x3b677f*Math['PI']/0xb4)*config['Stop']['length'];_0x248fc4=-Math['cos'](_0x3b677f*Math['PI']/0xb4)*config['Stop']['length'];var _0x264ca6=Math['sin']((0xb4-_0x3b677f)*Math['PI']/0xb4)*config['Stop']['width'];var _0x5606b5=-Math['cos']((0xb4-_0x3b677f)*Math['PI']/0xb4)*config['Stop']['width'];this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color1']));var _0x182dfc=new Phaser['Point'](_0xb95460['x']+_0x264ca6-_0x4ef3e3,_0xb95460['y']+0x1+_0x5606b5-_0x248fc4);var _0x32ba02=new Phaser['Point'](_0xb95460['x']+_0x264ca6+_0x4ef3e3,_0xb95460['y']+0x1+_0x5606b5+_0x248fc4);var _0x52b466=new Phaser['Point'](_0xb95460['x']-_0x264ca6+_0x4ef3e3,_0xb95460['y']+0x1-_0x5606b5+_0x248fc4);var _0x569787=new Phaser['Point'](_0xb95460['x']-_0x264ca6-_0x4ef3e3,_0xb95460['y']+0x1-_0x5606b5-_0x248fc4);this['canvas']['drawPolygon']([_0x182dfc,_0x32ba02,_0x52b466,_0x569787]);this['canvas']['endFill']();this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color2']));_0x182dfc=new Phaser['Point'](_0xb95460['x']+_0x264ca6-_0x4ef3e3,_0xb95460['y']-0x1+_0x5606b5-_0x248fc4);_0x32ba02=new Phaser['Point'](_0xb95460['x']+_0x264ca6+_0x4ef3e3,_0xb95460['y']-0x1+_0x5606b5+_0x248fc4);_0x52b466=new Phaser['Point'](_0xb95460['x']-_0x264ca6+_0x4ef3e3,_0xb95460['y']-0x1-_0x5606b5+_0x248fc4);_0x569787=new Phaser['Point'](_0xb95460['x']-_0x264ca6-_0x4ef3e3,_0xb95460['y']-0x1-_0x5606b5-_0x248fc4);this['canvas']['drawPolygon']([_0x182dfc,_0x32ba02,_0x52b466,_0x569787]);this['canvas']['endFill']();}_0x241acd['add'](this['canvas']);}}};class TramLine{constructor(){this['NEIGHBOUR_STATUS']={'MULTIPLE_PATHS':0x0,'NO_NEIGHBOUR':0x1};this['tiles']=[];this['closed']=![];}['isEmpty'](){return this['tiles']['length']===0x0;}['isAllowed'](_0x48084f){if(!_0x48084f['hasTracks']()){return![];}var _0x4fec50=this['tiles']['length'];var _0x2e4e4f=null;if(_0x4fec50>0x1){_0x2e4e4f=this['tiles'][_0x4fec50-0x1]['getNeighbourConnection'](this['tiles'][_0x4fec50-0x2]);}else{_0x2e4e4f=_0x48084f['getNeighbourConnection'](this['tiles'][_0x4fec50-0x1]);}var _0x57c2df=this['tiles'][_0x4fec50-0x1]['getNeighbourConnection'](_0x48084f);if(_0x57c2df===null){return![];}var _0x3bd694=this['tiles'][_0x4fec50-0x1]['getTrackHeadsFrom'](_0x2e4e4f);if(_0x3bd694===null){return![];}if(!_0x3bd694['includes'](_0x57c2df)){return![];}if(_0x48084f['getTrackHeadsFrom'](normalizeAngle(_0x57c2df+0xb4))===null){return![];}return!![];}['getNextUniqueNeighbour'](){var _0x2616ca=this['tiles']['length'];var _0x5745ec=null;if(_0x2616ca>0x1){_0x5745ec=this['tiles'][_0x2616ca-0x1]['getNeighbourConnection'](this['tiles'][_0x2616ca-0x2]);}else{var _0x3f7d5b=this['tiles'][_0x2616ca-0x1]['tracks']['getTrackKeys']();if(_0x3f7d5b['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}_0x5745ec=_0x3f7d5b[0x0];}var _0x497183=this['tiles'][_0x2616ca-0x1]['getTrackHeadsFrom'](_0x5745ec);if(_0x497183===null){return this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR'];}if(_0x497183['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}return this['tiles'][_0x2616ca-0x1]['getNeighbourAtHead'](_0x497183[0x0]);}['getTiles'](){return this['tiles'];}['abort'](){this['tiles']['forEach'](_0x4128d9=>_0x4128d9['abortTrack']());this['tiles']=[];this['closed']=![];}['proceed'](_0x378cd3){if(this['isEmpty']()){this['tiles']=[_0x378cd3];this['tiles'][0x0]['tracks']['highlight'](null,null);var _0x1ff079=this['getNextUniqueNeighbour']();if(_0x1ff079!==this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){this['proceed'](_0x1ff079);}return;}var _0xe904f2=this['tiles']['length'];this['tiles'][_0xe904f2-0x1]['abortTrack']();if(_0xe904f2>0x1){this['tiles'][_0xe904f2-0x1]['tracks']['highlight'](this['tiles'][_0xe904f2-0x1]['getNeighbourConnection'](this['tiles'][_0xe904f2-0x2]),this['tiles'][_0xe904f2-0x1]['getNeighbourConnection'](_0x378cd3));}else{this['tiles'][_0xe904f2-0x1]['tracks']['highlight'](_0x378cd3['getNeighbourConnection'](this['tiles'][_0xe904f2-0x1]),this['tiles'][_0xe904f2-0x1]['getNeighbourConnection'](_0x378cd3));}this['tiles']['push'](_0x378cd3);while(!![]){var _0x1ff079=this['getNextUniqueNeighbour']();_0xe904f2=this['tiles']['length'];if(_0x1ff079===this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR']||_0x1ff079===null){this['abort']();break;}else if(_0x1ff079===this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){if(this['isAllowed'](this['tiles'][0x0])){this['closed']=!![];}else{this['tiles'][_0xe904f2-0x1]['tracks']['highlight'](this['tiles'][_0xe904f2-0x1]['getNeighbourConnection'](this['tiles'][_0xe904f2-0x2]),null);}break;}this['tiles'][_0xe904f2-0x1]['tracks']['highlight'](this['tiles'][_0xe904f2-0x1]['getNeighbourConnection'](this['tiles'][_0xe904f2-0x2]),this['tiles'][_0xe904f2-0x1]['getNeighbourConnection'](_0x1ff079));if(_0x1ff079['equals'](this['tiles'][0x1])&&this['tiles'][_0xe904f2-0x1]['equals'](this['tiles'][0x0])){this['tiles']['pop']();this['closed']=!![];break;}if(this['tiles']['length']>config['Tram']['maxLineLength']){this['abort']();break;}this['tiles']['push'](_0x1ff079);}}static['show'](_0x53266b){for(var _0x322688=0x0;_0x322688<_0x53266b['length'];_0x322688++){var _0x3ac61e=_0x322688-0x1;var _0xf7f8e8=_0x322688+0x1;if(_0x3ac61e<0x0){_0x3ac61e=_0x53266b['length']-0x1;}if(_0xf7f8e8>_0x53266b['length']-0x1){_0xf7f8e8=0x0;}_0x53266b[_0x322688]['tracks']['highlight'](_0x53266b[_0x322688]['getNeighbourConnection'](_0x53266b[_0x3ac61e]),_0x53266b[_0x322688]['getNeighbourConnection'](_0x53266b[_0xf7f8e8]));}}}class Tile{constructor(_0x4ed8c8,_0x37048e,_0x5bd27b,_0x31037e){this['fileId']=_0x4ed8c8;this['hash']=_0x37048e;this['imgX']=_0x5bd27b;this['imgY']=_0x31037e;this['x']=this['imgX']+Math['floor'](config['Tile']['width']/0x2);this['y']=this['imgY']+Math['floor'](config['Tile']['height']/0x2);this['neighbours']=[];this['streetNeighbours']=[];this['neighbourConnections']={};this['lineSegments']=[];this['tracks']=new Tracks(this);this['tramstop']=null;this['hover']=null;this['trees']=null;this['vehicles']=[];this['vehicleHashes']=[];}['updateImage'](_0x3e894b){this['fileId']=_0x3e894b;var _0x3fd449=game['cache']['getImage'](this['fileId']);this['imgY']=this['imgY']+config['Tile']['height']-_0x3fd449['height'];}['draw'](_0x105193,_0x33ddb2){if(this['isGrass']()||this['isStreet']()){_0x105193['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}else{_0x33ddb2['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}if(this['trees']!==null){this['trees']['draw'](_0x33ddb2);}this['hover']=new Phaser['Graphics'](game,this['imgX'],this['imgY']);this['hover']['beginFill'](Phaser['Color']['hexToRGB'](config['Tile']['hoverColor']));this['hover']['fillAlpha']=0.5;this['hover']['drawPolygon'](new Phaser['Point'](config['Tile']['width']/0x2,0x0),new Phaser['Point'](config['Tile']['width'],config['Tile']['height']/0x2),new Phaser['Point'](config['Tile']['width']/0x2,config['Tile']['height']),new Phaser['Point'](0x0,config['Tile']['height']/0x2));this['hover']['endFill']();this['hover']['visible']=![];_0x105193['add'](this['hover']);}['drawTracks'](_0x3f9507){this['tracks']['draw'](_0x3f9507);if(this['hasTracks']()&&this['trees']!==null){this['trees']['remove']();}}['drawVehicles'](_0x146f2d,_0x42aaf3){this['vehicles']['forEach'](_0x2d9149=>_0x2d9149['draw'](_0x146f2d,_0x42aaf3));}['drawStop'](_0x412639){if(this['hasStop']()){this['tramstop']['draw'](_0x412639);}}['setHover'](_0x48250){this['hover']['visible']=_0x48250;}['addStop'](){this['tramstop']=new TramStop(this);}['equals'](_0xb6265a){if(_0xb6265a===null){return![];}return this['hash']===_0xb6265a['hash'];}['equalsHash'](_0x52dbd3){return this['hash']==_0x52dbd3;}['update'](){this['vehicles']['forEach'](_0x22258a=>_0x22258a['update']());}['isGrass'](){return this['fileId']===config['Tile']['grass'];}['isStreet'](){return this['fileId']['startsWith'](config['Tile']['streetPrefix']);}['isHouse'](){return!this['isGrass']()&&!this['isStreet']();}['isStraight'](){return config['Street']['straights']['includes'](this['fileId']);}['isHighway'](){return config['Street']['highways']['includes'](this['fileId']);}['isCurve'](){return config['Street']['curves']['includes'](this['fileId']);}['isStraightOrCurve'](){return this['isStraight']()||this['isCurve']();}['isDeadEnd'](){return config['Street']['deadEnds']['includes'](this['fileId']);}['isStraightTrack'](){if(this['hasTracks']()){return this['tracks']['isStraight']();}return![];}['getStraightTracks'](){if(this['hasTracks']()){return this['tracks']['getStraights']();}return null;}['isNonIntersectingTrack'](){if(this['hasTracks']()){return this['tracks']['isNotIntersecting']();}return!![];}['isDeadEndOrJunctionOrCrossing'](){if(this['isDeadEnd']()){return!![];}if(!this['isStraightOrCurve']()&&!this['isGrass']()){return!![];}if(this['hasTracks']()){if(this['tracks']['isDeadEnd']()){return!![];}var _0x403a0c=this['lineSegments']['concat'](this['tracks']['getLineSegments']());if(this['linesIntersectInside'](_0x403a0c)){return!![];}}return![];}['linesIntersectInside'](_0x1ac48b){var _0x4c81c1=null;for(var _0x3dcc6d=0x0;_0x3dcc6d<_0x1ac48b['length'];_0x3dcc6d++){for(var _0x34da70=_0x3dcc6d+0x1;_0x34da70<_0x1ac48b['length'];_0x34da70++){if(!linesAreEqual(_0x1ac48b[_0x3dcc6d],_0x1ac48b[_0x34da70])){for(var _0x4af5dc of _0x1ac48b[_0x3dcc6d]){for(var _0x22c11a of _0x1ac48b[_0x34da70]){_0x4c81c1=Phaser['Line']['intersects'](_0x4af5dc,_0x22c11a);if(_0x4c81c1!==null&&this['inside'](_0x4c81c1['x'],_0x4c81c1['y'],0.99)){return!![];}}}}}}return![];}['hasStop'](){return this['tramstop']!==null;}['hasTracks'](){return this['tracks']['hasTracks']();}['generateHouse'](_0x575bad){if(!this['isGrass']()||this['hasTracks']()){return;}var _0x24dc35=![];for(var _0x9255a8 of this['neighbours']){if(_0x9255a8['isStreet']()&&!_0x9255a8['isHighway']()){_0x24dc35=!![];break;}}if(_0x24dc35&&Math['random']()<config['Tile']['probHouse']){var _0x292119=_0x575bad[Math['floor'](Math['random']()*_0x575bad['length'])];this['updateImage'](_0x292119);}}['generateTrees'](_0x2dd170){if(this['isGrass']()&&!this['hasTracks']()){this['trees']=new Trees(this,_0x2dd170);this['trees']['generateTrees']();}}['generateCars'](_0x573835){if(this['isStreet']()){var _0xcfea49=this['getStreetConnections']();var _0x7552ef=_0xcfea49[Math['floor'](Math['random']()*_0xcfea49['length'])];if(this['hasFreeParkingLot'](_0x7552ef)){if(Math['random']()<config['Tile']['probCar']){this['addVehicle'](new Car(this,_0x7552ef,_0x573835,config['Car']['numTypes'],null));}}}}['generateTrack'](_0x17adf2){this['tracks']['generate'](_0x17adf2);}['abortTrack'](){this['tracks']['abort']();}['finalizeTrack'](){this['tracks']['finalize']();if(this['hasStop']()&&!this['isStraightTrack']()){this['tramstop']['draw'](null);this['tramstop']=null;}}['getTrackHeadsFrom'](_0x1aaa2c){return this['tracks']['getHeadsFrom'](_0x1aaa2c);}['computeAllNeighbours'](_0x3c741d){var _0x2c95e6=0xa;for(var _0x160ca7 of _0x3c741d){if(!this['equals'](_0x160ca7)){if(this['x']+_0x2c95e6<_0x160ca7['x']&&_0x160ca7['x']<this['x']+config['Tile']['width']-_0x2c95e6&&this['y']-config['Tile']['height']+_0x2c95e6<_0x160ca7['y']&&_0x160ca7['y']<this['y']-_0x2c95e6){this['neighbours']['push'](_0x160ca7);}else if(this['x']+_0x2c95e6<_0x160ca7['x']&&_0x160ca7['x']<this['x']+config['Tile']['width']-_0x2c95e6&&this['y']+_0x2c95e6<_0x160ca7['y']&&_0x160ca7['y']<this['y']+config['Tile']['height']-_0x2c95e6){this['neighbours']['push'](_0x160ca7);}else if(this['x']-config['Tile']['width']+_0x2c95e6<_0x160ca7['x']&&_0x160ca7['x']<this['x']-_0x2c95e6&&this['y']+_0x2c95e6<_0x160ca7['y']&&_0x160ca7['y']<this['y']+config['Tile']['height']-_0x2c95e6){this['neighbours']['push'](_0x160ca7);}else if(this['x']-config['Tile']['width']+_0x2c95e6<_0x160ca7['x']&&_0x160ca7['x']<this['x']-_0x2c95e6&&this['y']-config['Tile']['height']+_0x2c95e6<_0x160ca7['y']&&_0x160ca7['y']<this['y']-_0x2c95e6){this['neighbours']['push'](_0x160ca7);}}}}['computeStreetNeighboursAndConnections'](){for(var _0x5b4c5c of this['neighbours']){if(!_0x5b4c5c['isHouse']()){var _0x1571a2=null;if(_0x5b4c5c['x']>this['x']&&_0x5b4c5c['y']<this['y']){_0x1571a2=0x3c;}else if(_0x5b4c5c['x']>this['x']&&_0x5b4c5c['y']>this['y']){_0x1571a2=0x78;}else if(_0x5b4c5c['x']<this['x']&&_0x5b4c5c['y']>this['y']){_0x1571a2=0xf0;}else if(_0x5b4c5c['x']<this['x']&&_0x5b4c5c['y']<this['y']){_0x1571a2=0x12c;}this['neighbourConnections'][_0x5b4c5c['hash']]=convertInt(_0x1571a2);if(_0x5b4c5c['isStreet']()&&this['isConnectedTo'](_0x1571a2)){if(!this['isStraightOrCurve']()&&!_0x5b4c5c['isStraightOrCurve']()){error('Cannot\x20handle\x20neighbouring\x20junctions,\x20crossings,\x20or\x20dead\x20ends.',this,null);}this['streetNeighbours']['push'](_0x5b4c5c);}}}}['computeLineSegments'](){var _0x5cd886=this['getStreetConnections']();if(_0x5cd886['length']===0x2){for(var _0x13da52=0x0;_0x13da52<0x2;_0x13da52++){var _0xcd363d=normalizeAngle(_0x5cd886[_0x13da52]+0xb4);var _0x127b3f=_0x5cd886[0x1-_0x13da52];var _0x5d9bef=this['getLaneStartPoint'](_0xcd363d,config['Street']['laneDrive'],0x1);var _0x4261a1=this['getLaneTargetPoint'](_0x127b3f,config['Street']['laneDrive'],0.24);var _0x320cd7=[];if(getTurnDirection(_0xcd363d,_0x127b3f)===-0x1){_0x320cd7['push'](new Phaser['Line'](Math['round'](_0x5d9bef['x']),Math['round'](_0x5d9bef['y']),Math['round'](this['x']),Math['round'](this['y'])));_0x320cd7['push'](new Phaser['Line'](Math['round'](this['x']),Math['round'](this['y']),Math['round'](_0x4261a1['x']),Math['round'](_0x4261a1['y'])));}else{_0x320cd7['push'](new Phaser['Line'](Math['round'](_0x5d9bef['x']),Math['round'](_0x5d9bef['y']),Math['round'](_0x4261a1['x']),Math['round'](_0x4261a1['y'])));}this['lineSegments']['push'](_0x320cd7);}}}['getNeighbourConnection'](_0x53d0e5){var _0x401e5e=_0x53d0e5;if(typeof _0x53d0e5!=='string'){_0x401e5e=_0x53d0e5['hash'];}if(!(_0x401e5e in this['neighbourConnections'])){return null;}return this['neighbourConnections'][_0x401e5e];}['getNeighbourAtHead'](_0x582a36){var _0x554d76=this['neighbours']['filter'](_0x5b9f84=>this['neighbourConnections'][_0x5b9f84['hash']]===_0x582a36);if(_0x554d76['length']!==0x1){return null;}return _0x554d76[0x0];}['isTrackNeighbourOf'](_0x4f859d){return this['neighbours']['includes'](_0x4f859d)&&!_0x4f859d['isHouse']();}['isConnectedTo'](_0x2b46e0){var _0x245e68=parseInt(this['fileId']['substring'](0x1,0x5));if([0x1,0x5,0x9,0x15,0x2d,0x31,0x35,0x4d,0x55]['includes'](_0x245e68)){if(convertInt(_0x2b46e0)===0x12c){return!![];}}if([0x5,0x9,0xd,0x11,0x2d,0x35,0x39,0x41,0x51]['includes'](_0x245e68)){if(convertInt(_0x2b46e0)===0x3c){return!![];}}if([0x1,0x9,0xd,0x15,0x2d,0x39,0x3d,0x45,0x55]['includes'](_0x245e68)){if(convertInt(_0x2b46e0)===0x78){return!![];}}if([0x1,0x5,0xd,0x11,0x2d,0x31,0x3d,0x49,0x51]['includes'](_0x245e68)){if(convertInt(_0x2b46e0)===0xf0){return!![];}}return![];}['getStreetConnections'](){var _0x2a6ff5=[0x3c,0x78,0xf0,0x12c];return _0x2a6ff5['filter'](_0x371c7f=>this['isConnectedTo'](_0x371c7f));}['inside'](_0x91c9ac,_0x462221,_0x1d37f4){_0x1d37f4=typeof _0x1d37f4==='undefined'?0x1:_0x1d37f4;var _0x4980f9=this['x']-_0x91c9ac;var _0x1a18d9=this['y']-_0x462221;var _0x4f66fc=config['Tile']['width']/config['Tile']['height'];return Math['abs'](_0x4980f9+_0x4f66fc*_0x1a18d9)<_0x1d37f4*config['Tile']['width']*0.5&&Math['abs'](_0x4980f9-_0x4f66fc*_0x1a18d9)<_0x1d37f4*config['Tile']['width']*0.5;}['nearCenter'](_0x5e91bb,_0x5d595e){return this['inside'](_0x5e91bb,_0x5d595e,config['Street']['centerSizeFactor']);}['centerAhead'](_0x391e60,_0x5e44b1){if(0x0<_0x5e44b1&&_0x5e44b1<0xb4){return _0x391e60<this['x'];}return _0x391e60>this['x'];}['getLane'](_0x3710f3,_0xf5c494){var _0x496d11=Math['cos'](_0x3710f3*Math['PI']/0xb4);var _0x5b3337=Math['sin'](_0x3710f3*Math['PI']/0xb4);var _0x24d750=this['x'];var _0x4e8094=this['y'];if(convertInt(_0x3710f3)===0x3c||convertInt(_0x3710f3)===0x78){_0x4e8094+=_0xf5c494;}else{_0x4e8094-=_0xf5c494;}return{'nx':_0x496d11,'ny':_0x5b3337,'px':_0x24d750,'py':_0x4e8094};}['getClosestPointInLane'](_0x1263d3,_0x2c6063,_0x1a279a,_0x2932cd){var _0x33165c=this['getLane'](_0x1a279a,_0x2932cd);var _0x4b2ea5=_0x33165c['nx']**0x2*_0x33165c['px']+_0x33165c['ny']**0x2*_0x1263d3+_0x33165c['nx']*_0x33165c['ny']*(_0x33165c['py']-_0x2c6063);var _0x5c1c93=_0x33165c['ny']**0x2*_0x33165c['py']+_0x33165c['nx']**0x2*_0x2c6063+_0x33165c['nx']*_0x33165c['ny']*(_0x33165c['px']-_0x1263d3);return new Point(_0x4b2ea5,_0x5c1c93);}['getDistanceToLane'](_0x417d95,_0x36c72d,_0x5118c4,_0x2e4ecf){var _0x43b9fc=this['getClosestPointInLane'](_0x417d95,_0x36c72d,_0x5118c4,_0x2e4ecf);return Math['sqrt']((_0x417d95-_0x43b9fc['x'])**0x2+(_0x36c72d-_0x43b9fc['y'])**0x2);}['getTileBoundaryPoint'](_0x51cadc,_0x46a06c,_0x2bf8d4,_0x28579d){var _0x372d8e=this['x'];var _0x1e5b8f=this['y'];if(convertInt(_0x2bf8d4)===0x3c||convertInt(_0x2bf8d4)===0x78){_0x1e5b8f+=_0x28579d;_0x46a06c+=_0x28579d;}else{_0x1e5b8f-=_0x28579d;_0x46a06c-=_0x28579d;}var _0x4350f1=new Phaser['Line'](_0x372d8e,_0x1e5b8f,_0x51cadc,_0x46a06c);var _0x3eb37b=null;for(var _0x2bf8d4 of[0x3c,0x78,0xf0,0x12c]){switch(_0x2bf8d4){case 0x3c:_0x3eb37b=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0x78:_0x3eb37b=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0xf0:_0x3eb37b=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;case 0x12c:_0x3eb37b=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;}var _0xfca98b=Phaser['Line']['intersects'](_0x4350f1,_0x3eb37b);if(_0xfca98b!==null){return _0xfca98b;}}return null;}['getLaneTargetPoint'](_0x593a0d,_0x1b8779,_0x5f4736){var _0xdfedba=_0x5f4736*config['Tile']['width'];var _0x4d2040=this['x']+Math['sin'](_0x593a0d*Math['PI']/0xb4)*_0xdfedba;var _0x3c8af7=this['y']-Math['cos'](_0x593a0d*Math['PI']/0xb4)*_0xdfedba;if(_0x5f4736>=0x1){return this['getTileBoundaryPoint'](_0x4d2040,_0x3c8af7,_0x593a0d,_0x1b8779);}return this['getClosestPointInLane'](_0x4d2040,_0x3c8af7,_0x593a0d,_0x1b8779);}['getLaneStartPoint'](_0x5e36ac,_0x58730b,_0x233126){var _0x2bc340=_0x233126*config['Tile']['width'];var _0x35d6be=this['x']-Math['sin'](_0x5e36ac*Math['PI']/0xb4)*_0x2bc340;var _0x33f588=this['y']+Math['cos'](_0x5e36ac*Math['PI']/0xb4)*_0x2bc340;if(_0x233126>=0x1){return this['getTileBoundaryPoint'](_0x35d6be,_0x33f588,_0x5e36ac,_0x58730b);}return this['getClosestPointInLane'](_0x35d6be,_0x33f588,_0x5e36ac,_0x58730b);}['addVehicle'](_0x2df3e7){this['vehicles']['push'](_0x2df3e7);this['vehicleHashes']['push'](_0x2df3e7['hash']);}['removeVehicle'](_0x3fcaf2){var _0x1ef0aa=this['vehicleHashes']['indexOf'](_0x3fcaf2['hash']);if(_0x1ef0aa>=0x0){this['vehicles']['splice'](_0x1ef0aa,0x1);this['vehicleHashes']['splice'](_0x1ef0aa,0x1);}}['clickVehicle'](_0x20816b,_0x331aad){for(var _0x5db875 of this['vehicles']){if(_0x5db875['isTram']()&&_0x5db875['click'](_0x20816b,_0x331aad)){TramLine['show'](_0x5db875['getLine']());return _0x5db875;}}return null;}['getVehicleIndex'](_0x3f5ce7){return this['vehicleHashes']['indexOf'](_0x3f5ce7['hash']);}['onlySameVehicleType'](){if(this['vehicles']['length']>0x0){for(var _0x529374=0x1;_0x529374<this['vehicles']['length'];_0x529374++){if(this['vehicles'][_0x529374]['isTram']()!==this['vehicles'][0x0]['isTram']()){return![];}}}return!![];}['hasFreeParkingLot'](_0x325ce7){if(!this['isStraight']()){return![];}if(this['isHighway']()){return![];}if(this['isDeadEndOrJunctionOrCrossing']()){return![];}if(this['hasStop']()){return![];}if(!this['isConnectedTo'](_0x325ce7)){return![];}for(var _0x57a508 of this['vehicles']){if(_0x57a508['isParking']()&&_0x57a508['getHead']()===convertInt(_0x325ce7)){return![];}}return!![];}};class Map{constructor(){this['tiles']=[];this['tileRowId']=[];this['masterGroup']=null;this['rowGroupsGround']=[];this['rowGroupsHouses']=[];this['nCols']=0x0;this['nRows']=0x0;this['newTrack']=[];this['newLine']=new TramLine();this['selectedVehicle']=null;this['tileHover']=null;}['loadMap'](_0x456a05){var _0x1db369=_0x456a05['trim']()['split']('\x0a');this['masterGroup']=game['add']['group']();for(var _0x504bf8=0x0;_0x504bf8<_0x1db369['length'];_0x504bf8++){if(_0x1db369[_0x504bf8]['includes'](',')){var _0x407a10=_0x1db369[_0x504bf8]['split'](',');this['nRows']++;this['nCols']=Math['max'](this['nCols'],_0x407a10['length']);var _0x411f80=game['add']['group']();var _0x57eb9d=game['add']['group']();_0x411f80['yz']=(_0x504bf8-0x1)*config['Tile']['dy'];_0x57eb9d['yz']=(_0x504bf8-0x1)*config['Tile']['dy']+config['Tile']['height'];this['rowGroupsGround']['push'](_0x411f80);this['rowGroupsHouses']['push'](_0x57eb9d);this['masterGroup']['add'](_0x411f80);this['masterGroup']['add'](_0x57eb9d);var _0x2383e0=-config['Tile']['dx']*(0x1-_0x504bf8%0x2);for(var _0x43e223=0x0;_0x43e223<_0x407a10['length'];_0x43e223++){var _0x1fd9d6=_0x407a10[_0x43e223]['trim']();if(_0x1fd9d6['length']>0x0){var _0x4cd2ea=_0x1fd9d6['substring'](0x0,0x4);var _0x3ce490=_0x1fd9d6['substring'](0x4);var _0xba9ca4=new Tile(_0x3ce490,_0x4cd2ea,_0x2383e0+0x2*_0x43e223*config['Tile']['dx'],(_0x504bf8-0x1)*config['Tile']['dy']);this['tiles']['push'](_0xba9ca4);this['tileRowId']['push'](this['nRows']-0x1);}}}}}['loadTracks'](_0x100e7b){var _0x49a53c=_0x100e7b['trim']()['split']('\x0a');for(var _0x1e1c22=0x0;_0x1e1c22<_0x49a53c['length'];_0x1e1c22++){if(_0x49a53c[_0x1e1c22]['includes'](',')){var _0x40b105=_0x49a53c[_0x1e1c22]['split'](',');for(var _0x155769 of _0x40b105){for(var _0x57333c of this['tiles']){if(_0x57333c['equalsHash'](_0x155769)){_0x57333c['generateTrack'](_0x40b105);_0x57333c['finalizeTrack']();}}}}}}['loadStops'](_0x1a41f0){var _0x577e12=_0x1a41f0['trim']();if(_0x577e12['includes'](',')){var _0x1ee1cc=_0x577e12['split'](',');for(var _0x4b3987 of _0x1ee1cc){for(var _0x2dc81e of this['tiles']){if(_0x2dc81e['equalsHash'](_0x4b3987)){_0x2dc81e['addStop']();}}}}}['loadTrams'](_0x40dcc4,_0x34b3ce){var _0xbba1e=_0x40dcc4['trim']()['split']('\x0a');for(var _0x2f0d0d=0x0;_0x2f0d0d<_0xbba1e['length'];_0x2f0d0d++){if(_0xbba1e[_0x2f0d0d]['includes'](',')){var _0x59c18f=_0xbba1e[_0x2f0d0d]['split'](',');var _0x19337a=[];for(var _0x571f35 of _0x59c18f){for(var _0x3d9254 of this['tiles']){if(_0x3d9254['equalsHash'](_0x571f35)){_0x19337a['push'](_0x3d9254);}}}if(_0x19337a['length']>0x1){var _0x591dea=Math['ceil'](_0x19337a['length']/config['Tram']['maxTilesPerTram']);var _0x1a0de3=getPermutations(_0x19337a,_0x591dea);_0x1a0de3['forEach'](function(_0x10eb27){_0x10eb27[0x0]['addVehicle'](new Tram(_0x10eb27[0x0],_0x10eb27[0x0]['getNeighbourConnection'](_0x10eb27[0x1]),_0x34b3ce,config['Tram']['numTypes'],_0x10eb27));});}}}}['getWidth'](){return 0x2*this['nCols']*config['Tile']['dx']-Math['floor'](config['Tile']['width']/0x2);}['getHeight'](_0x38dfed){return this['nRows']*config['Tile']['dy']-Math['floor'](config['Tile']['height']/0x2);}['initTiles'](){this['tiles']['forEach'](function(_0x59fa78,_0x4d751b,_0x412bd6){_0x59fa78['computeAllNeighbours'](_0x412bd6);});this['tiles']['forEach'](function(_0x392685){_0x392685['computeStreetNeighboursAndConnections']();_0x392685['computeLineSegments']();});}['generateItems'](_0x1d6156,_0x4e0589,_0xa89bf0){this['tiles']['forEach'](function(_0x949849){_0x949849['generateHouse'](_0x1d6156);_0x949849['generateTrees'](_0x4e0589);_0x949849['generateCars'](_0xa89bf0);});}['draw'](){for(var _0x28e58d=0x0;_0x28e58d<this['tiles']['length'];_0x28e58d++){this['tiles'][_0x28e58d]['draw'](this['rowGroupsGround'][this['tileRowId'][_0x28e58d]],this['rowGroupsHouses'][this['tileRowId'][_0x28e58d]]);}this['drawVehicles']();this['drawTracks']();}['drawTracks'](){for(var _0x5179d9=0x0;_0x5179d9<this['tiles']['length'];_0x5179d9++){this['tiles'][_0x5179d9]['drawTracks'](this['rowGroupsGround'][this['tileRowId'][_0x5179d9]]);}this['drawStops']();}['drawVehicles'](){for(var _0x2d739c of this['tiles']){_0x2d739c['drawVehicles'](this['masterGroup'],disableUI);}}['drawStops'](){for(var _0x5548bb=0x0;_0x5548bb<this['tiles']['length'];_0x5548bb++){this['tiles'][_0x5548bb]['drawStop'](this['rowGroupsGround'][this['tileRowId'][_0x5548bb]]);}}['update'](){this['tiles']['forEach'](_0x3f9920=>_0x3f9920['update']());this['masterGroup']['sort']('yz');}['disableTileHover'](){if(this['tileHover']!==null){this['tileHover']['setHover'](![]);}}['newTrackClick'](_0x1a2271,_0x1d2d5a,_0x8ccac8){for(var _0x13fec5 of this['tiles']){if(_0x13fec5['inside'](_0x1a2271,_0x1d2d5a)){this['disableTileHover']();if(!_0x13fec5['isHouse']()&&(this['newTrack']['length']===0x0||this['newTrack'][this['newTrack']['length']-0x1]['isTrackNeighbourOf'](_0x13fec5))){if(_0x8ccac8){this['tileHover']=_0x13fec5;this['tileHover']['setHover'](!![]);return!![];}this['newTrack']['push'](_0x13fec5);var _0x362dd4=this['newTrack']['map'](_0x1a2271=>_0x1a2271['hash']);_0x13fec5['generateTrack'](_0x362dd4);if(this['newTrack']['length']>0x1){this['newTrack'][0x0]['generateTrack'](_0x362dd4);this['newTrack'][this['newTrack']['length']-0x2]['generateTrack'](_0x362dd4);}this['drawTracks']();return!![];}return![];}}return![];}['newStopClick'](_0xd913a5,_0x5a07a1,_0x3f0108){for(var _0x5d2c99 of this['tiles']){if(_0x5d2c99['inside'](_0xd913a5,_0x5a07a1)){this['disableTileHover']();if(_0x5d2c99['hasTracks']()&&_0x5d2c99['isStraightTrack']()&&(_0x5d2c99['isStraight']()||_0x5d2c99['isGrass']())&&!_0x5d2c99['hasStop']()){if(_0x3f0108){this['tileHover']=_0x5d2c99;this['tileHover']['setHover'](!![]);return!![];}_0x5d2c99['addStop']();console['log'](_0x5d2c99['hash']);this['drawStops']();return!![];}return![];}}return![];}['newTramClick'](_0x2e0587,_0x55977d,_0x587014,_0x3966bf){for(var _0x5359b6 of this['tiles']){if(_0x5359b6['inside'](_0x2e0587,_0x55977d)){this['disableTileHover']();if(_0x5359b6['hasTracks']()&&(this['newLine']['isEmpty']()&&_0x5359b6['isStraightTrack']()||!this['newLine']['isEmpty']()&&this['newLine']['isAllowed'](_0x5359b6))){if(_0x587014){this['tileHover']=_0x5359b6;this['tileHover']['setHover'](!![]);return!![];}this['newLine']['proceed'](_0x5359b6);this['drawTracks']();if(this['newLine']['closed']){this['newTramFinalize'](_0x3966bf);}return!![];}return![];}}return![];}['showTramClick'](_0x546373,_0x23ba33){this['tiles']['forEach'](_0x3e390d=>_0x3e390d['abortTrack']());var _0x1ff54e=![];this['selectedVehicle']=null;for(var _0x5ddd13 of this['tiles']){var _0x4a1e1e=_0x5ddd13['clickVehicle'](_0x546373,_0x23ba33);if(_0x4a1e1e!==null){this['selectedVehicle']=_0x4a1e1e;_0x1ff54e=!![];}}this['drawTracks']();return _0x1ff54e;}['newTrackAbort'](){if(this['newTrack']['length']>0x0){this['newTrack']['forEach'](_0x4c1c54=>_0x4c1c54['abortTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramAbort'](){if(this['newLine']!==null){this['newLine']['abort']();this['drawTracks']();}this['disableTileHover']();}['newTrackFinalize'](){if(this['newTrack']['length']<0x2){this['newTrackAbort']();return;}if(this['newTrack']['length']>0x0){console['log'](this['newTrack']['map'](_0x40c56a=>_0x40c56a['hash'])['join']());this['newTrack']['forEach'](_0x465e97=>_0x465e97['finalizeTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramFinalize'](_0x5ce0d8){if(this['newLine']!==null){var _0x5903c3=this['newLine']['getTiles']();console['log'](_0x5903c3['map'](_0x345a09=>_0x345a09['hash'])['join']());_0x5903c3[0x0]['addVehicle'](new Tram(_0x5903c3[0x0],_0x5903c3[0x0]['getNeighbourConnection'](_0x5903c3[0x1]),_0x5ce0d8,config['Tram']['numTypes'],_0x5903c3));this['drawVehicles']();this['newTramAbort']();}}['removeSelectedTram'](){if(this['selectedVehicle']!==null){this['selectedVehicle']['disable']();this['selectedVehicle']=null;this['showTramClick'](-0x1,-0x1);}}};class Driver{};class CarDriver extends Driver{['leaveParkingLot'](){return Math['random']()<config['Driver']['probStepDrive'];}['parkNow'](){return Math['random']()<config['Driver']['probTilePark'];}['decideTurn'](_0x5b4a71){return _0x5b4a71[Math['floor'](Math['random']()*_0x5b4a71['length'])];}['getLine'](){return null;}};class TramDriver extends Driver{constructor(_0x2d05f0){super();this['tiles']=_0x2d05f0;this['line']=_0x2d05f0['map'](_0x5c533b=>_0x5c533b['hash']);this['lastLineIndex']=0x0;this['waitingTime']=0x0;}['leaveStop'](){this['waitingTime']+=0x1;if(this['waitingTime']>config['Driver']['waitAtStop']){this['waitingTime']=0x0;return!![];}return![];}['decideTurn'](_0x4b6f6e){var _0x18baa2=this['line']['indexOf'](_0x4b6f6e['hash'],this['lastLineIndex']);if(_0x18baa2<0x0){_0x18baa2=this['line']['indexOf'](_0x4b6f6e['hash']);if(_0x18baa2<0x0){return null;}}_0x18baa2+=0x1;if(_0x18baa2>this['line']['length']-0x1){_0x18baa2=0x0;}this['lastLineIndex']=_0x18baa2;return _0x4b6f6e['getNeighbourConnection'](this['line'][_0x18baa2]);}['getLine'](){return this['tiles'];}};class BezierCurve{constructor(_0x5f5542){this['anchorPoints']=_0x5f5542;}['get'](_0x584381){var _0x169932=this['anchorPoints']['length'];var _0xfd777e=Array(_0x169932);var _0x200e83=null;var _0x24c0bb=null;for(_0x200e83=0x0;_0x200e83<_0x169932;_0x200e83++){_0xfd777e[_0x200e83]=Array(_0x169932);}for(_0x200e83=0x0;_0x200e83<_0x169932;_0x200e83++){_0xfd777e[_0x200e83][0x0]=this['anchorPoints'][_0x200e83];}var _0x4f8dd8=0x0;var _0x6770a4=0x0;for(_0x24c0bb=0x1;_0x24c0bb<_0x169932;_0x24c0bb++){for(_0x200e83=0x0;_0x200e83<_0x169932-_0x24c0bb;_0x200e83++){_0x4f8dd8=(0x1-_0x584381)*_0xfd777e[_0x200e83][_0x24c0bb-0x1]['x']+_0x584381*_0xfd777e[_0x200e83+0x1][_0x24c0bb-0x1]['x'];_0x6770a4=(0x1-_0x584381)*_0xfd777e[_0x200e83][_0x24c0bb-0x1]['y']+_0x584381*_0xfd777e[_0x200e83+0x1][_0x24c0bb-0x1]['y'];_0xfd777e[_0x200e83][_0x24c0bb]=new Point(_0x4f8dd8,_0x6770a4);}}return _0xfd777e[0x0][_0x169932-0x1];}['getPath'](_0x84a50a){var _0x13b249=[];var _0x3e87f6=0x0;var _0x1708e0=this['anchorPoints'][0x0];var _0x5a94d4=null;var _0x2f392b=null;var _0x2b7f88=null;var _0x4b1457=null;var _0x57adb8=null;var _0x27a901=null;var _0x30b7d0=null;while(_0x3e87f6<0x1){_0x2f392b=_0x3e87f6;_0x2b7f88=0x0;_0x4b1457=0x0;_0x57adb8=0x0;while(_0x2b7f88<_0x84a50a){_0x2f392b+=0.005;_0x5a94d4=this['get'](_0x2f392b);_0x4b1457=_0x5a94d4['x']-_0x1708e0['x'];_0x57adb8=_0x5a94d4['y']-_0x1708e0['y'];_0x2b7f88=Math['sqrt'](_0x4b1457*_0x4b1457+_0x57adb8*_0x57adb8);}_0x27a901=Math['atan2'](_0x4b1457,-_0x57adb8)*0xb4/Math['PI'];if(_0x27a901<0x0){_0x27a901+=0x168;}_0x30b7d0=new Point((_0x1708e0['x']+_0x5a94d4['x'])/0x2,(_0x1708e0['y']+_0x5a94d4['y'])/0x2);_0x30b7d0['head']=_0x27a901;_0x13b249['push'](_0x30b7d0);_0x1708e0=new Point(_0x5a94d4['x'],_0x5a94d4['y']);_0x3e87f6=_0x2f392b;}return _0x13b249['slice'](0x0,_0x13b249['length']-0x1);}};class Vehicle{constructor(_0x4cb684,_0xcb1d0,_0x1497f1,_0x12d9f6){this['hash']=generateRandomId();this['colorId']=_0x1497f1[Math['floor'](Math['random']()*_0x1497f1['length'])];this['typeId']=Math['floor'](Math['random']()*_0x12d9f6);this['sprite']=null;this['bounds']={};this['tile']=_0x4cb684;this['oldTile']='null';this['v']=0x0;this['head']=_0xcb1d0;this['queue']=[];this['cachedHead']=null;this['cachedClosestHead']=null;this['cachedSpriteHead']=null;this['cachedSpritePosition']=new Point(null,null);this['start']();this['waitingTime']=0x0;this['collisionWith']=null;this['turnPath']=null;this['plannedHead']=null;this['error']=![];this['lastStop']=null;}['disable'](){this['y']=-0x64;this['error']=!![];this['tile']['removeVehicle'](this);this['sprite']['destroy']();this['queue']=[];}['equals'](_0x1717ef){return this['hash']===_0x1717ef['hash'];}['closeTo'](_0x20d8a0,_0x264953,_0x2b5247){return(_0x264953-_0x20d8a0['x'])**0x2+(_0x2b5247-_0x20d8a0['y'])**0x2<0.5*(this['sprite']['height']+_0x20d8a0['sprite']['height'])**0x2;}['startXY'](_0xd3ea42,_0x2fce59){this['x']=this['tile']['x'];if(_0xd3ea42===0x3c||_0xd3ea42===0x12c){this['x']+=config['Tile']['width']/0x4;}else{this['x']-=config['Tile']['width']/0x4;}this['y']=(_0x2fce59['nx']*(_0x2fce59['px']-this['x'])+_0x2fce59['ny']*_0x2fce59['py'])/_0x2fce59['ny'];}['draw'](_0x4b207e,_0x239d37){if(this['sprite']===null){this['sprite']=game['add']['sprite'](0x0,0x0,this['colorId']);this['updateSprite'](this['x'],this['y'],this['getHead']());_0x4b207e['add'](this['sprite']);this['createBounds']();if(!_0x239d37){this['setCursor']();}}}['createBounds'](){var _0x2934f5=this['sprite']['width'];var _0x5f30fc=document['getElementById']('vehicle-canvas');var _0x2060ab=this['sprite']['texture']['baseTexture']['source'];_0x5f30fc['getContext']('2d')['drawImage'](_0x2060ab,0x0,0x0,_0x2060ab['width'],_0x2060ab['height']);var _0x1a1c62=this['typeId']*_0x2934f5;for(var _0x4c7a5b=0x0;_0x4c7a5b<config['Vehicle']['headingOrder']['length'];_0x4c7a5b++){var _0x52b48d=[];var _0x15c0cc=_0x4c7a5b*_0x2934f5;for(var _0x2266c8=0x0;_0x2266c8<0x168;_0x2266c8+=config['Vehicle']['collisionSampling']){for(var _0x3eb235=0x0;_0x3eb235<_0x2934f5;_0x3eb235++){var _0xc4413f=Math['round'](_0x3eb235*Math['sin'](_0x2266c8*Math['PI']/0xb4));var _0x3a72cf=-Math['round'](_0x3eb235*Math['cos'](_0x2266c8*Math['PI']/0xb4));var _0x43fa30=_0x5f30fc['getContext']('2d')['getImageData'](_0xc4413f+_0x15c0cc+Math['round'](_0x2934f5/0x2),_0x3a72cf+_0x1a1c62+Math['round'](_0x2934f5/0x2),0x1,0x1)['data'][0x3];if(_0x43fa30<0xff){_0x52b48d['push'](_0xc4413f);_0x52b48d['push'](_0x3a72cf);break;}}}this['bounds'][config['Vehicle']['headingOrder'][_0x4c7a5b]]=new Phaser['Polygon'](_0x52b48d);}}['getBounds'](){return this['bounds'][this['getHead']()];}['updateSprite'](_0x30c41a,_0x7d020f,_0x3b5f03){if(this['sprite']!==null){this['updateSpritePosition'](_0x30c41a,_0x7d020f);this['updateSpriteFrame'](_0x3b5f03);}}['updateSpritePosition'](_0x59bc6f,_0x313efe){if(!this['cachedSpritePosition']['equals'](_0x59bc6f,_0x313efe)){this['sprite']['x']=_0x59bc6f-this['sprite']['width']/0x2;this['sprite']['y']=_0x313efe-this['sprite']['height']/0x2;this['sprite']['yz']=_0x313efe+this['sprite']['height']/0x2;this['cachedSpritePosition']=new Point(_0x59bc6f,_0x313efe);}}['updateSpriteFrame'](_0x5647d8){_0x5647d8=convertInt(_0x5647d8);if(this['cachedSpriteHead']!==_0x5647d8){var _0x28b74f=config['Vehicle']['headingOrder']['indexOf'](_0x5647d8);if(_0x28b74f===-0x1){error('Heading\x20not\x20in\x20vehicle\x20sprite',this,this['disable']);return null;}this['sprite']['frame']=this['typeId']*config['Vehicle']['headingOrder']['length']+_0x28b74f;this['cachedSpriteHead']=_0x5647d8;}}['click'](_0x52da2f,_0x2828bf){if(this['sprite']!==null){return Phaser['Rectangle']['containsPoint'](this['sprite']['getBounds'](),new Phaser['Point'](_0x52da2f,_0x2828bf));}return![];}['getLine'](){return this['driver']['getLine']();}['update'](){if(this['error']){return;}if(this['queue'][0x0]['call'](this)){this['queue']['shift']();}var _0xc8e6dc=0x1/config['World']['stepsPerSecond'];this['waitingTime']+=_0xc8e6dc;if(this['v']>0x0){var _0x29867b=this['getHead']();var _0x55dcb6=Math['sin'](_0x29867b*Math['PI']/0xb4)*this['v']*_0xc8e6dc;var _0x4bb5d0=-Math['cos'](_0x29867b*Math['PI']/0xb4)*this['v']*_0xc8e6dc;if(this['collision'](this['x']+_0x55dcb6,this['y']+_0x4bb5d0,_0x29867b)){this['queue']['splice'](0x0,0x0,this['callbackWait']);}else{this['waitingTime']=0x0;this['x']+=_0x55dcb6;this['y']+=_0x4bb5d0;this['enterNewTile']();if(!this['tile']['inside'](this['x'],this['y'])){error('Vehicle\x20has\x20left\x20its\x20tile',this,this['disable']);}this['updateSprite'](this['x'],this['y'],_0x29867b);}}if(this['waitingTime']>config['Vehicle']['waitForever']&&this['collisionWith']!==null){if(this['collisionWith']['collidingWith'](this)){error('Vehicle\x20is\x20in\x20a\x20collision\x20loop',this,this['disable']);}}}['enterNewTile'](){if(this['tile']['inside'](this['x'],this['y'])){return;}for(var _0x1fe6b8 of this['tile']['neighbours']){if(_0x1fe6b8['inside'](this['x'],this['y'])){if(this['getHead']()===convertInt(this['tile']['getNeighbourConnection'](_0x1fe6b8))){this['laneAssist']();if(this['tile']['inside'](this['x'],this['y'])){return;}}if(this['isInFront'](_0x1fe6b8,this['x'],this['y'],this['head'])){this['oldTile']=this['tile']['hash'];this['tile']['removeVehicle'](this);this['tile']=_0x1fe6b8;this['tile']['addVehicle'](this);this['plannedHead']=null;this['parkNow']();return;}}}}['getHead'](){if(this['cachedHead']!==this['head']){this['cachedHead']=this['head'];this['cachedClosestHead']=this['getClosestHead'](this['head'],![]);}return this['cachedClosestHead'];}['getNextHead'](_0x13b051){var _0x52606e=config['Vehicle']['headingOrder']['indexOf'](this['getHead']())+_0x13b051;if(_0x52606e<0x0){_0x52606e+=config['Vehicle']['headingOrder']['length'];}else if(_0x52606e>=config['Vehicle']['headingOrder']['length']){_0x52606e-=config['Vehicle']['headingOrder']['length'];}return config['Vehicle']['headingOrder'][_0x52606e];}['getClosestHead'](_0x293439,_0x3cfe72){if(_0x293439<0x0||0x168<=_0x293439){error('Heading\x20out\x20of\x20range',this,this['disable']);return null;}var _0x1e7d5d=config['Vehicle']['headingOrder']['slice'](0x0);if(_0x3cfe72){_0x1e7d5d['sort'](function(_0x3c702d,_0x1575d3){return _0x3c702d-_0x1575d3;});for(var _0x50af7d=0x0;_0x50af7d<_0x1e7d5d['length']-0x1;_0x50af7d++){if(_0x1e7d5d[_0x50af7d]<=_0x293439&&_0x293439<_0x1e7d5d[_0x50af7d+0x1]){return _0x1e7d5d[_0x50af7d];}}return _0x1e7d5d['reverse']()[0x0];}else{if(_0x293439>0x12c){_0x1e7d5d[config['Vehicle']['headingOrder']['indexOf'](0x0)]=0x168;}var _0x106482=_0x1e7d5d['reduce'](function(_0xf73767,_0xb84688){if(Math['abs'](_0xf73767-_0x293439)<Math['abs'](_0xb84688-_0x293439)){return _0xf73767;}return _0xb84688;});if(_0x106482===0x168){return 0x0;}return _0x106482;}}['getTurnPath'](_0x304cfa){var _0x5d9cb8=new Point(this['x'],this['y']);var _0x20459b=this['tile']['getLaneTargetPoint'](_0x304cfa,config['Street']['laneDrive'],config['Street']['lanePointFactor']);var _0x10e052=getCurve(_0x5d9cb8,_0x20459b,this['getHead'](),_0x304cfa,config['Street']['bezierFactor']);return _0x10e052['getPath'](config['Vehicle']['velocityTurn']/config['World']['stepsPerSecond']);}['laneAssist'](){var _0x3c744c=this['tile']['getClosestPointInLane'](this['x'],this['y'],this['getHead'](),config['Street']['laneDrive']);this['x']=_0x3c744c['x'];this['y']=_0x3c744c['y'];}['isInFront'](_0x27b3ca,_0x42b700,_0x59dd6b,_0x136064){var _0x54e288=_0x27b3ca['x']-_0x42b700;var _0x40b390=_0x27b3ca['y']-_0x59dd6b;var _0x56a93a=this['getHeadFromDxDy'](_0x54e288,_0x40b390);if(_0x136064+0x3c<_0x56a93a&&_0x56a93a<_0x136064+0x12c||_0x136064+0x3c<_0x56a93a+0x168&&_0x56a93a+0x168<_0x136064+0x12c){return![];}return!![];}['getHeadFromDxDy'](_0x13ffa1,_0x41eba5){var _0xc2f3e1=Math['atan2'](_0x13ffa1,-_0x41eba5)*0xb4/Math['PI'];if(_0xc2f3e1<0x0){_0xc2f3e1+=0x168;}return _0xc2f3e1;}['getMaxDistancePerStep'](){return Math['ceil'](this['v']/config['World']['stepsPerSecond']);}['collidingWith'](_0x4ec927){if(this['collisionWith']===null){return![];}return this['collisionWith']['equals'](_0x4ec927);}['collision'](_0xebe253,_0x240d74,_0x1ec276){var _0x2caf7c=null;for(_0x2caf7c of this['tile']['vehicles']){if(this['collideWith'](_0x2caf7c,_0xebe253,_0x240d74,_0x1ec276)){this['collisionWith']=_0x2caf7c;return!![];}}for(var _0xc6ca1 of this['tile']['neighbours']){for(_0x2caf7c of _0xc6ca1['vehicles']){if(this['collideWith'](_0x2caf7c,_0xebe253,_0x240d74,_0x1ec276)){this['collisionWith']=_0x2caf7c;return!![];}}}this['collisionWith']=null;return![];}['collideWith'](_0x51049c,_0x184c4d,_0x64c70f,_0x21f4bf){if(this['equals'](_0x51049c)){return![];}if(_0x51049c['error']){return![];}if(!this['closeTo'](_0x51049c,_0x184c4d,_0x64c70f)){return![];}if(_0x51049c['isParking']()){return![];}if(!this['isInFront'](_0x51049c,_0x184c4d,_0x64c70f,_0x21f4bf)){return![];}for(var _0x55ae1f=0x4;_0x55ae1f<0xd;_0x55ae1f++){if(_0x51049c['getNextHead'](_0x55ae1f)===_0x21f4bf){return![];}}var _0x3a4b93=_0x51049c['x']-_0x184c4d;var _0x3a641a=_0x51049c['y']-_0x64c70f;var _0x36ed44=_0x51049c['getBounds']()['points'];for(var _0x1cb093 of _0x36ed44){if(this['bounds'][_0x21f4bf]['contains'](_0x1cb093['x']+_0x3a4b93,_0x1cb093['y']+_0x3a641a)){return!![];}}return![];}['parkNow'](){}['callbackProceedToTargetLane'](_0x286ca2,_0x27b6bc){if(_0x286ca2===null){_0x286ca2=this['plannedHead'];}this['v']=config['Vehicle']['velocityTurn'];var _0x13547a=this['tile']['getDistanceToLane'](this['x'],this['y'],_0x286ca2,_0x27b6bc);if(_0x13547a<this['getMaxDistancePerStep']()){if(this['collision'](this['x'],this['y'],_0x286ca2)){this['v']=0x0;return![];}this['head']=_0x286ca2;return!![];}return![];}['callbackDrive'](){if(this['queue']['length']!==0x1){error('Callback\x20queue\x20corrupted',this,this['disable']);return!![];}if(this['tile']['isHighway']()||this['tile']['isGrass']()){this['v']=config['Vehicle']['velocityHighway'];}else{this['v']=config['Vehicle']['velocityCity'];}if(this['tile']['hasStop']()&&this['isOnStraight']()&&this['tile']['inside'](this['x'],this['y'],config['Vehicle']['centerSizeFactor'])){this['queue']['push'](this['callbackAtStop']);return!![];}if(this['tile']['isDeadEndOrJunctionOrCrossing']()){if(!(this['isOnNonIntersectingWay']()&&this['tile']['onlySameVehicleType']())){var _0x1cf90e=this['tile']['getVehicleIndex'](this);for(var _0x27bfd1=0x0;_0x27bfd1<_0x1cf90e;_0x27bfd1++){if(!this['tile']['vehicles'][_0x27bfd1]['isParking']()&&this['tile']['vehicles'][_0x27bfd1]['waitingTime']<=config['Vehicle']['waitBlocked']){this['v']=0x0;this['waitingTime']=0x0;return![];}}}}if(this['plannedHead']===null){if(!this['isOnStraight']()&&this['tile']['nearCenter'](this['x'],this['y'])){this['plannedHead']=this['getNextTurn']();if(this['plannedHead']===null){return!![];}if(this['plannedHead']===this['getHead']()){this['queue']['push'](this['callbackDrive']);}else{this['queue']['push'](this['callbackTurn']);this['queue']['push'](function(){return this['callbackProceedToTargetLane'](null,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);}return!![];}}return![];}['callbackWait'](){return!![];}['callbackTurn'](){this['v']=0.01;var _0x5995f9=this['tile']['getDistanceToLane'](this['x'],this['y'],this['plannedHead'],config['Street']['laneDrive']);if(_0x5995f9<this['getMaxDistancePerStep']()){this['turnPath']=null;return!![];}if(this['turnPath']===null){this['turnPath']=this['getTurnPath'](this['plannedHead']);}var _0x24f932=this['turnPath'][0x0]['head'];var _0x3a4616=this['turnPath'][0x0]['x'];var _0x2fbc56=this['turnPath'][0x0]['y'];var _0x27930d=this['getClosestHead'](_0x24f932,!![]);if(this['collision'](_0x3a4616,_0x2fbc56,_0x27930d)){this['v']=0x0;return![];}this['head']=_0x24f932;this['x']=_0x3a4616;this['y']=_0x2fbc56;this['turnPath']['splice'](0x0,0x1);if(this['turnPath']['length']===0x0){this['turnPath']=null;return!![];}return![];}};class Car extends Vehicle{constructor(..._0x1bc83a){super(..._0x1bc83a);this['driver']=new CarDriver();}['isTram'](){return![];}['setCursor'](){}['start'](){var _0x363c56=this['getHead']();var _0x254923=this['tile']['getLane'](_0x363c56,config['Street']['lanePark']);this['startXY'](_0x363c56,_0x254923);this['queue']=[this['callbackPark']];}['getNextTurn'](){var _0x5d2a60=this['tile']['getStreetConnections']()['slice'](0x0);if(!this['tile']['isDeadEnd']()){var _0x2b5801=this['tile']['streetNeighbours']['map'](_0x2a487a=>_0x2a487a['hash']);if(_0x2b5801['includes'](this['oldTile'])){var _0x35c1ac=this['tile']['neighbourConnections'][this['oldTile']];if(_0x5d2a60['includes'](_0x35c1ac)){_0x5d2a60['splice'](_0x5d2a60['indexOf'](_0x35c1ac),0x1);}}}if(_0x5d2a60['length']===0x0){error('Empty\x20connection\x20list',this,this['disable']);return null;}var _0x36186d=this['tile']['getVehicleIndex'](this);for(var _0x324846=0x0;_0x324846<_0x36186d;_0x324846++){var _0x43e5a5=this['tile']['vehicles'][_0x324846];if(_0x43e5a5['waitingTime']>config['Vehicle']['waitBlocked']&&_0x5d2a60['length']>0x1){if(_0x5d2a60['includes'](_0x43e5a5['getHead']())){_0x5d2a60['splice'](_0x5d2a60['indexOf'](_0x43e5a5['getHead']()),0x1);}else if(_0x5d2a60['includes'](_0x43e5a5['plannedHead'])){_0x5d2a60['splice'](_0x5d2a60['indexOf'](_0x43e5a5['plannedHead']),0x1);}}}return this['driver']['decideTurn'](_0x5d2a60);}['parkNow'](){if(this['queue'][0x0]===this['callbackDrive']&&this['driver']['parkNow']()&&this['tile']['hasFreeParkingLot'](this['getHead']())){this['queue']=[this['callbackEnterParkingLot']];}}['isOnStraight'](){return this['tile']['isStraight']();}['isOnNonIntersectingWay'](){return this['tile']['isStraight']()||this['tile']['isCurve']();}['isParking'](){return convertInt(this['v'])===0x0&&[this['callbackPark'],this['callbackLeaveParkingLot']]['includes'](this['queue'][0x0]);}['callbackEnterParkingLot'](){this['queue']['push'](function(){return this['callbackChangeLane'](0x1);});this['queue']['push'](function(){var _0x945d15=this['getNextHead'](-0x2);return this['callbackProceedToTargetLane'](_0x945d15,config['Street']['lanePark']);});this['queue']['push'](this['callbackPark']);return!![];}['callbackPark'](){this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveParkingLot']()){this['queue']['push'](this['callbackLeaveParkingLot']);return!![];}return![];}['callbackLeaveParkingLot'](){if(!this['tile']['onlySameVehicleType']()){return![];}for(var _0x1d2089 of this['tile']['vehicles']){if(!this['equals'](_0x1d2089)&&!_0x1d2089['isParking']()&&_0x1d2089['getHead']()===this['getHead']()){return![];}}this['queue']['push'](function(){return this['callbackChangeLane'](-0x1);});this['queue']['push'](function(){var _0x442768=this['getNextHead'](0x2);return this['callbackProceedToTargetLane'](_0x442768,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);return!![];}['callbackChangeLane'](_0x26f5b1){this['head']=this['getNextHead'](0x2*_0x26f5b1);return!![];}['callbackAtStop'](){this['queue']['push'](this['callbackDrive']);return!![];}};class Tram extends Vehicle{constructor(_0x5349ca,_0x1969b9,_0x5b29a0,_0x159903,_0x1d4bf1){super(_0x5349ca,_0x1969b9,_0x5b29a0,_0x159903);this['driver']=new TramDriver(_0x1d4bf1);}['isTram'](){return!![];}['setCursor'](){if(this['sprite']!==null){this['sprite']['inputEnabled']=!![];this['sprite']['events']['onInputOver']['add'](function(){UI['setCursorInfo']();});this['sprite']['events']['onInputOut']['add'](function(){UI['unsetCursorInfo']();});}}['start'](){var _0x582d30=this['getHead']();var _0x379f2e=this['tile']['getLane'](_0x582d30,config['Street']['laneDrive']);this['startXY'](_0x582d30,_0x379f2e);this['queue']=[this['callbackDrive']];}['getNextTurn'](){var _0x10b578=this['driver']['decideTurn'](this['tile']);if(_0x10b578===null){error('Tram\x20does\x20not\x20find\x20a\x20way',this,this['disable']);return null;}return _0x10b578;}['isOnStraight'](){return this['tile']['isStraightTrack']();}['isOnNonIntersectingWay'](){return this['tile']['isNonIntersectingTrack']();}['isParking'](){return![];}['callbackAtStop'](){if(this['tile']['equals'](this['lastStop'])){this['queue']['push'](this['callbackDrive']);return!![];}this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveStop']()){this['lastStop']=this['tile'];this['queue']['push'](this['callbackDrive']);return!![];}return![];}};class UI{static['disableSpinner'](){document['getElementById']('spinner')['style']['display']='none';}static['buttonNewTrack'](_0x25649e,_0x39b73b){if(_0x25649e){document['getElementById']('button-track')['classList']['remove']('button-disabled');}else{document['getElementById']('button-track')['classList']['add']('button-disabled');}if(_0x39b73b){document['getElementById']('button-track')['classList']['add']('button-active');}else{document['getElementById']('button-track')['classList']['remove']('button-active');}}static['buttonNewStop'](_0x1657da,_0x2a3e8b){if(_0x1657da){document['getElementById']('button-stop')['classList']['remove']('button-disabled');}else{document['getElementById']('button-stop')['classList']['add']('button-disabled');}if(_0x2a3e8b){document['getElementById']('button-stop')['classList']['add']('button-active');}else{document['getElementById']('button-stop')['classList']['remove']('button-active');}}static['buttonNewTram'](_0x5c3ded,_0x691985){if(_0x5c3ded){document['getElementById']('button-tram')['classList']['remove']('button-disabled');}else{document['getElementById']('button-tram')['classList']['add']('button-disabled');}if(_0x691985){document['getElementById']('button-tram')['classList']['add']('button-active');}else{document['getElementById']('button-tram')['classList']['remove']('button-active');}}static['buttonAbort'](_0x12e8d4){if(_0x12e8d4){document['getElementById']('button-abort')['classList']['remove']('button-disabled');}else{document['getElementById']('button-abort')['classList']['add']('button-disabled');}}static['buttonFinish'](_0x2be482){if(_0x2be482){document['getElementById']('button-finish')['classList']['remove']('button-disabled');}else{document['getElementById']('button-finish')['classList']['add']('button-disabled');}}static['setCursorDefault'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorOk'](){document['getElementById']('canvas')['classList']['add']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorNok'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['add']('nok');}static['setCursorInfo'](){if(state['isClickable']()){document['getElementById']('canvas')['classList']['add']('info');}}static['unsetCursorInfo'](){document['getElementById']('canvas')['classList']['remove']('info');}};class State{['abort'](_0x277734){}['finish'](_0x5c9185){}['click'](_0x3c031c,_0x5f50e1,_0x3800f4){return this;}['hover'](_0x5a9d28,_0x1610de,_0x2e958e){}['isClickable'](){return![];}};class StateDefault extends State{static['change'](){return new StateDefault();}['setButtons'](){UI['buttonNewTrack'](!![],![]);UI['buttonNewStop'](!![],![]);UI['buttonNewTram'](!![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](![]);}['setCursor'](){UI['setCursorDefault']();}['click'](_0x415d91,_0x45d95a,_0x5164b4){if(_0x5164b4['showTramClick'](_0x415d91-game['camera']['x'],_0x45d95a-game['camera']['y'])){return StateTramInfo['change']();}return this;}['isClickable'](){return!![];}};class StateNewTrack extends State{static['change'](){return new StateNewTrack();}['setButtons'](){UI['buttonNewTrack'](!![],!![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x4ba582){_0x4ba582['newTrackAbort']();}['finish'](_0x50ddc0){_0x50ddc0['newTrackFinalize']();}['click'](_0x40c740,_0x20a303,_0x5bc7fa){_0x5bc7fa['newTrackClick'](_0x40c740,_0x20a303,![]);return this;}['hover'](_0x59e8fe,_0x1b1af4,_0x1eec5b){if(_0x1eec5b['newTrackClick'](_0x59e8fe,_0x1b1af4,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewStop extends State{static['change'](){return new StateNewStop();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](!![],!![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['click'](_0x32b8c9,_0x10d0f1,_0x5cdd72){_0x5cdd72['newStopClick'](_0x32b8c9,_0x10d0f1,![]);return this;}['hover'](_0x3c972d,_0x3b6a7d,_0xb2db44){if(_0xb2db44['newStopClick'](_0x3c972d,_0x3b6a7d,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewTram extends State{static['change'](){return new StateNewTram();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](!![],!![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x462cd3){_0x462cd3['newTramAbort']();}['finish'](_0x17884c){this['abort'](_0x17884c);}['click'](_0x5b85a9,_0x2a1cc9,_0x2b7484){_0x2b7484['newTramClick'](_0x5b85a9,_0x2a1cc9,![],loader['trams']);return this;}['hover'](_0x737dd2,_0x38da1f,_0x2cf5c4){if(_0x2cf5c4['newTramClick'](_0x737dd2,_0x38da1f,!![],loader['trams'])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateTramInfo extends State{static['change'](){return new StateTramInfo();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorDefault']();}['abort'](_0x2b122e){_0x2b122e['removeSelectedTram']();}['finish'](_0x139ce1){_0x139ce1['showTramClick'](-0x1,-0x1);}['click'](_0x4848e3,_0x52ab04,_0x39ddd2){return StateDefault['change']()['click'](_0x4848e3,_0x52ab04,_0x39ddd2);}['isClickable'](){return!![];}};var game=new Phaser['Game']('100','100',Phaser['CANVAS'],'canvas',{'preload':preload,'create':create,'update':update});var loader=new Loader();var map=new Map();var state=StateDefault['change']();var config;var cursors;var mouseDown=![];var disableUI=!![];function loadConfig(_0x43608a,_0xf678c1,_0x40f92e,_0x16a8f7,_0x4cbc83){if(_0xf678c1==='config'){config=game['cache']['getJSON']('config');loader['load']();}}function step(){map['update']();}function preload(){game['load']['onFileComplete']['add'](loadConfig,this);game['load']['text']('world','city/world.dat');game['load']['text']('tracks','city/tracks.dat');game['load']['text']('stops','city/stops.dat');game['load']['text']('trams','city/trams.dat');game['load']['json']('config','city/config.json');}function updateUI(){state['setButtons']();state['setCursor']();}function create(){cursors=game['input']['keyboard']['createCursorKeys']();game['kineticScrolling']=game['plugins']['add'](Phaser['Plugin']['KineticScrolling']);game['kineticScrolling']['configure']({'kineticMovement':!![],'timeConstantScroll':0x145,'horizontalScroll':!![],'verticalScroll':!![],'horizontalWheel':![],'verticalWheel':![]});game['kineticScrolling']['start']();game['stage']['backgroundColor']=config['Street']['color'];map['loadMap'](game['cache']['getText']('world'));map['initTiles']();map['loadTracks'](game['cache']['getText']('tracks'));map['loadStops'](game['cache']['getText']('stops'));map['generateItems'](loader['houses'],loader['trees'],loader['cars']);map['loadTrams'](game['cache']['getText']('trams'),loader['trams']);game['world']['resize'](map['getWidth'](),map['getHeight']());document['getElementById']('vehicle-canvas')['width']=config['Tram']['imgSize']*config['Vehicle']['headingOrder']['length'];document['getElementById']('vehicle-canvas')['height']=config['Tram']['imgSize']*config['Vehicle']['headingOrder']['length'];map['draw']();var _0x156910=0x3e8/config['World']['stepsPerSecond'];game['time']['events']['loop'](_0x156910,step);var _0xcf6250=Math['max'](0x1,window['devicePixelRatio']*0.6);game['camera']['scale']['setTo'](_0xcf6250,_0xcf6250);if(disableUI){document['getElementById']('button-track')['style']['display']='none';document['getElementById']('button-stop')['style']['display']='none';document['getElementById']('button-tram')['style']['display']='none';document['getElementById']('button-abort')['style']['display']='none';document['getElementById']('button-finish')['style']['display']='none';}else{document['getElementById']('button-track')['addEventListener']('click',onButtonTrack);document['getElementById']('button-stop')['addEventListener']('click',onButtonStop);document['getElementById']('button-tram')['addEventListener']('click',onButtonTram);document['getElementById']('button-abort')['addEventListener']('click',onButtonAbort);document['getElementById']('button-finish')['addEventListener']('click',onButtonFinish);}UI['disableSpinner']();updateUI();}function onButtonTrack(){state=StateNewTrack['change']();updateUI();}function onButtonStop(){state=StateNewStop['change']();updateUI();}function onButtonTram(){state=StateNewTram['change']();updateUI();}function onTramInfo(){state=StateTramInfo['change']();updateUI();}function onButtonAbort(){state['abort'](map);state=StateDefault['change']();updateUI();}function onButtonFinish(){state['finish'](map);state=StateDefault['change']();updateUI();}function update(){if(cursors['up']['isDown']){game['camera']['y']-=0x14;}else if(cursors['down']['isDown']){game['camera']['y']+=0x14;}if(cursors['left']['isDown']){game['camera']['x']-=0x14;}else if(cursors['right']['isDown']){game['camera']['x']+=0x14;}if(!disableUI){if(game['input']['mousePointer']['leftButton']['isDown']){mouseDown=!![];}if(game['input']['mousePointer']['leftButton']['isUp']&&mouseDown){mouseDown=![];state=state['click'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);updateUI();}else{state['hover'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);}}}