'use strict';function error(_0x2993cb,_0x11c28a,_0x4b21cb){console['error'](_0x2993cb);if(_0x4b21cb===null){throw new Error(_0x2993cb);}else{_0x4b21cb['call'](_0x11c28a);}}function convertInt(_0xb6ff57){return parseInt(_0xb6ff57,0xa);}function getPermutations(_0x188e96,_0x401d65){var _0x47c744=[];for(var _0x27ee20=0x0;_0x27ee20<_0x401d65;_0x27ee20++){var _0x2fd78a=Math['floor'](_0x188e96['length']*_0x27ee20/_0x401d65);var _0x164445=_0x188e96['slice'](_0x2fd78a);var _0x5422a1=_0x188e96['slice'](0x0,_0x2fd78a);_0x47c744['push'](_0x164445['concat'](_0x5422a1));}return _0x47c744;}function normalizeAngle(_0x1f0d2a){if(_0x1f0d2a>=0x168){_0x1f0d2a-=0x168;}return _0x1f0d2a;}function generateRandomId(){var _0x185945='';_0x185945+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x185945+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x185945+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);return _0x185945;}function getTurnDirection(_0x312829,_0x54d5b1){if(0x0<_0x54d5b1-_0x312829&&_0x54d5b1-_0x312829<0xb4){return 0x1;}else if(-0xb4<=_0x54d5b1-_0x312829&&_0x54d5b1-_0x312829<0x0){return-0x1;}else if(_0x54d5b1-_0x312829>=0xb4){return-0x1;}else if(-0xb4>_0x54d5b1-_0x312829){return 0x1;}return 0x0;}function getDeltaHead(_0x485c51,_0x586904){var _0x17a6eb=getTurnDirection(_0x485c51,_0x586904);var _0x4b1716=0x0;if(_0x17a6eb<0x0){if(_0x586904>_0x485c51){_0x4b1716=_0x485c51-(_0x586904-0x168);}else{_0x4b1716=_0x485c51-_0x586904;}}else if(_0x17a6eb>0x0){if(_0x586904<_0x485c51){_0x4b1716=_0x586904+0x168-_0x485c51;}else{_0x4b1716=_0x586904-_0x485c51;}}return _0x4b1716;}function getCurve(_0x1d0361,_0x3e0692,_0x34a4ae,_0x414b1c,_0x21103c){var _0x19dd42=Math['sin'](_0x34a4ae*Math['PI']/0xb4);var _0xad0734=-Math['cos'](_0x34a4ae*Math['PI']/0xb4);var _0x331df9=Math['sin'](_0x414b1c*Math['PI']/0xb4);var _0x5d172e=-Math['cos'](_0x414b1c*Math['PI']/0xb4);var _0x51523b=getDeltaHead(_0x34a4ae,_0x414b1c);var _0x21103c=_0x21103c*_0x51523b;if(_0x51523b===0x0){return new BezierCurve([_0x1d0361,_0x3e0692]);}return new BezierCurve([_0x1d0361,new Point(_0x1d0361['x']+_0x21103c*_0x19dd42,_0x1d0361['y']+_0x21103c*_0xad0734),new Point(_0x3e0692['x']-_0x21103c*_0x331df9,_0x3e0692['y']-_0x21103c*_0x5d172e),_0x3e0692]);}function linesAreEqual(_0x404522,_0x4471ca){if(_0x404522['length']!==_0x4471ca['length']){return![];}for(var _0x5043cf=0x0;_0x5043cf<_0x404522['length'];_0x5043cf++){if(_0x404522[_0x5043cf]['start']['x']!==_0x4471ca[_0x5043cf]['start']['x']||_0x404522[_0x5043cf]['start']['y']!==_0x4471ca[_0x5043cf]['start']['y']){return![];}if(_0x404522[_0x5043cf]['end']['x']!==_0x4471ca[_0x5043cf]['end']['x']||_0x404522[_0x5043cf]['end']['y']!==_0x4471ca[_0x5043cf]['end']['y']){return![];}}return!![];}class Point{constructor(_0x91c431,_0x5b6095){this['x']=_0x91c431;this['y']=_0x5b6095;}['equals'](_0x55760a,_0x5e904f){return this['x']===_0x55760a&&this['y']===_0x5e904f;}};class Loader{['load'](){this['streets']=['g0000','r0001','r0005','r0009','r0013','r0017','r0021','r0045','r0049','r0053','r0057','r0061','r0065','r0069','r0073','r0077','r0081','r0085'];this['houses']=['h0001','h0005','h0009','h0013','h0017','h0021','h0025','h0029','h0033','h0037','h0041','h0045','h0049','h0053','h0057','h0061','h0065','h0069','h0073','h0077','h0081','h0085','h0089','h0093','h0097','h0101','h0105','h0109','h0113','h0117','h0121','h0125','h0129','h0133','h0137','h0141','h0145','h0149','h0153','h0157','h0161','h0165','h0169','h0173','h0177','h0181','h0185','h0189','h0193','h0197','h0201','h0205','h0209','h0213','h0217','h0221','h0225','h0229','h0233','h0237','h0241','h0245','h0249','h0253'];this['trees']=['t01','t02','t03','t04','t05','t06','t07','t08','t09','t10','t11'];this['cars']=['v01','v02','v03','v04','v05','v06','v07','v08','v09','v10','v11','v12'];this['trams']=['v00'];this['streets']['forEach'](function(_0x444bd3){game['load']['image'](_0x444bd3,'city/img/'+_0x444bd3+'.png');});this['houses']['forEach'](function(_0x22cf05){game['load']['image'](_0x22cf05,'city/img/'+_0x22cf05+'.png');});this['trees']['forEach'](function(_0x4fb039){game['load']['image'](_0x4fb039,'city/img/'+_0x4fb039+'.png');});this['cars']['forEach'](function(_0x4b94fb){game['load']['spritesheet'](_0x4b94fb,'city/img/'+_0x4b94fb+'.png',config['Car']['imgSize'],config['Car']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Car']['numTypes']);});this['trams']['forEach'](function(_0x4dad68){game['load']['spritesheet'](_0x4dad68,'city/img/'+_0x4dad68+'.png',config['Tram']['imgSize'],config['Tram']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Tram']['numTypes']);});}};class Trees{constructor(_0xadd47f,_0x48ad0c){this['tile']=_0xadd47f;this['treeImages']=_0x48ad0c;this['trees']=[];this['sprites']=[];}['generateTrees'](){for(var _0x2c488b=0x0;_0x2c488b<config['Tree']['numTrees'];_0x2c488b++){var _0x226689=this['newTree']();if(_0x226689!==null){this['trees']['push'](_0x226689);}}this['trees']['sort'](function(_0x4dfa32,_0x17e7ef){return _0x4dfa32['y']-_0x17e7ef['y'];});}['newTree'](){var _0x562c09=this['treeImages'][Math['floor'](Math['random']()*this['treeImages']['length'])];var _0x47a5de=game['cache']['getImage'](_0x562c09);var _0x182f30=this['tile']['imgX']+Math['floor'](Math['random']()*(config['Tile']['width']-_0x47a5de['width']));var _0x1b4860=this['tile']['imgY']+Math['floor'](Math['random']()*config['Tile']['height'])-_0x47a5de['height'];var _0x25f291=_0x182f30+Math['floor'](_0x47a5de['width']/0x2);var _0x46752c=_0x1b4860+_0x47a5de['height'];if(this['tile']['inside'](_0x25f291,_0x46752c,config['Tree']['insideFactor'])){return{'y':_0x46752c,'tree':_0x562c09,'imgX':_0x182f30,'imgY':_0x1b4860};}return null;}['draw'](_0x573489){for(var _0xeb8a9e of this['trees']){this['sprites']['push'](game['add']['image'](_0xeb8a9e['imgX'],_0xeb8a9e['imgY'],_0xeb8a9e['tree']));}this['sprites']['forEach'](_0x3e79a7=>_0x573489['add'](_0x3e79a7));}['remove'](){this['sprites']['forEach'](_0xe7e692=>_0xe7e692['destroy']());}};class Tracks{constructor(_0x138b38){this['tile']=_0x138b38;this['track']={};this['newTrack']={};this['trackPoints']=null;this['headsFrom']=[];this['headsTo']=[];this['lineSegments']=[];}['generate'](_0x42037c){if(this['tile']['isHouse']()){return;}this['newTrack']={};if(_0x42037c['length']===0x1&&_0x42037c[0x0]===this['tile']['hash']){this['newTrack'][0x3c]=[0xf0];this['newTrack'][0x78]=[0x12c];this['newTrack'][0xf0]=[0x3c];this['newTrack'][0x12c]=[0x78];return;}var _0x29b98f=[];var _0x44cfb5=_0x42037c['indexOf'](this['tile']['hash']);while(_0x44cfb5!=-0x1){_0x29b98f['push'](_0x44cfb5);_0x44cfb5=_0x42037c['indexOf'](this['tile']['hash'],_0x44cfb5+0x1);}for(_0x44cfb5 of _0x29b98f){var _0x52f524=_0x44cfb5+0x1;var _0x783c9f=_0x44cfb5-0x1;if(_0x52f524===_0x42037c['length']){_0x52f524=0x0;}if(_0x783c9f===-0x1){_0x783c9f=_0x42037c['length']-0x1;}var _0x229668=null;var _0x23e87a=null;if(_0x42037c[_0x783c9f]in this['tile']['neighbourConnections']&&_0x42037c[_0x52f524]in this['tile']['neighbourConnections']){_0x229668=this['tile']['neighbourConnections'][_0x42037c[_0x783c9f]];_0x23e87a=this['tile']['neighbourConnections'][_0x42037c[_0x52f524]];}else if(_0x42037c[_0x783c9f]in this['tile']['neighbourConnections']){_0x229668=this['tile']['neighbourConnections'][_0x42037c[_0x783c9f]];_0x23e87a=normalizeAngle(_0x229668+0xb4);}else if(_0x42037c[_0x52f524]in this['tile']['neighbourConnections']){_0x23e87a=this['tile']['neighbourConnections'][_0x42037c[_0x52f524]];_0x229668=normalizeAngle(_0x23e87a+0xb4);}if(_0x23e87a!==null){if(_0x229668 in this['newTrack']){this['newTrack'][_0x229668]['push'](_0x23e87a);}else{this['newTrack'][_0x229668]=[_0x23e87a];}}}}['finalize'](){var _0x321729=null;for(var _0x4bd977 in this['newTrack']){if(_0x4bd977 in this['track']){for(_0x321729=0x0;_0x321729<this['newTrack'][_0x4bd977]['length'];_0x321729++){this['track'][_0x4bd977]['push'](this['newTrack'][_0x4bd977][_0x321729]);}}else{this['track'][_0x4bd977]=this['newTrack'][_0x4bd977];}}for(var _0x572565 in this['track']){var _0x19d875=[];for(_0x321729=0x0;_0x321729<this['track'][_0x572565]['length'];_0x321729++){if(!_0x19d875['includes'](this['track'][_0x572565][_0x321729])){_0x19d875['push'](this['track'][_0x572565][_0x321729]);}}this['track'][_0x572565]=_0x19d875;}this['headsFrom']=Object['keys'](this['track']);this['headsTo']=Object['values'](this['track']);this['newTrack']={};this['lineSegments']=[];for(var _0x27d8d7 in this['track']){var _0x572565=normalizeAngle(convertInt(_0x27d8d7)+0xb4);for(var _0x3636c6 of this['track'][_0x27d8d7]){var _0x50dec4=this['tile']['getLaneStartPoint'](_0x572565,config['Street']['laneDrive'],0x1);var _0x25d221=this['tile']['getLaneTargetPoint'](_0x3636c6,config['Street']['laneDrive'],0.24);var _0x344a3b=[];if(getTurnDirection(_0x572565,_0x3636c6)===-0x1){_0x344a3b['push'](new Phaser['Line'](Math['round'](_0x50dec4['x']),Math['round'](_0x50dec4['y']),Math['round'](this['tile']['x']),Math['round'](this['tile']['y'])));_0x344a3b['push'](new Phaser['Line'](Math['round'](this['tile']['x']),Math['round'](this['tile']['y']),Math['round'](_0x25d221['x']),Math['round'](_0x25d221['y'])));}else{_0x344a3b['push'](new Phaser['Line'](Math['round'](_0x50dec4['x']),Math['round'](_0x50dec4['y']),Math['round'](_0x25d221['x']),Math['round'](_0x25d221['y'])));}this['lineSegments']['push'](_0x344a3b);}}}['abort'](){this['newTrack']={};}['addSingleTrack'](_0x24c9a8,_0x3e7602){var _0x29e85d=normalizeAngle(convertInt(_0x24c9a8)+0xb4);for(var _0x2f2bb6=-0x1;_0x2f2bb6<=0x1;_0x2f2bb6+=0x2){var _0x21a29f=this['tile']['getLaneStartPoint'](_0x29e85d,config['Street']['laneDrive']+_0x2f2bb6*config['Track']['width']/0x2,0x1);var _0x3f6ce9=this['tile']['getLaneStartPoint'](_0x29e85d,config['Street']['laneDrive']+_0x2f2bb6*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x3eef6e=this['tile']['getLaneTargetPoint'](_0x3e7602,config['Street']['laneDrive']+_0x2f2bb6*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x2518e8=this['tile']['getLaneTargetPoint'](_0x3e7602,config['Street']['laneDrive']+_0x2f2bb6*config['Track']['width']/0x2,0x1);if(_0x29e85d===_0x3e7602){this['trackPoints']['moveTo'](_0x21a29f['x'],_0x21a29f['y']);this['trackPoints']['lineTo'](_0x2518e8['x'],_0x2518e8['y']);}else{var _0x192c2f=getCurve(_0x3f6ce9,_0x3eef6e,_0x29e85d,_0x3e7602,config['Track']['bezierFactor'])['getPath'](config['Track']['curveFactor']);this['trackPoints']['moveTo'](_0x21a29f['x'],_0x21a29f['y']);this['trackPoints']['lineTo'](_0x192c2f[0x0]['x'],_0x192c2f[0x0]['y']);for(var _0x40b4a4 of _0x192c2f){this['trackPoints']['lineTo'](_0x40b4a4['x'],_0x40b4a4['y']);}this['trackPoints']['lineTo'](_0x2518e8['x'],_0x2518e8['y']);}}}['getRandomConnection'](){return this['headsTo'][Math['floor'](Math['random']()*this['headsTo']['length'])];}['hasTracks'](){return this['headsFrom']['length']>0x0;}['getTrackKeys'](){return Object['keys'](this['track']);}['getLineSegments'](){return this['lineSegments'];}['isNotIntersecting'](){if(this['isDeadEnd']()){return![];}if(this['tile']['linesIntersectInside'](this['lineSegments'])){return![];}return!![];}['isDeadEnd'](){for(var _0x305106 in this['track']){for(var _0x438fd9 of this['track'][_0x305106]){if(_0x438fd9===convertInt(_0x305106)){return!![];}}}return![];}['isStraight'](){var _0x1cfbcd=this['headsFrom']['map'](_0x505573=>convertInt(_0x505573));if(_0x1cfbcd['length']>0x2){return![];}for(var _0x23d8ef in this['track']){if(this['track'][_0x23d8ef]['length']>0x1){return![];}if(normalizeAngle(convertInt(_0x23d8ef)+0xb4)!==convertInt(this['track'][_0x23d8ef])){return![];}if(_0x1cfbcd['length']===0x2&&!_0x1cfbcd['includes'](this['track'][_0x23d8ef][0x0])){return![];}}return!![];}['getStraights'](){if(this['isStraight']()){return Object['keys'](this['track'])['map'](_0x4265de=>normalizeAngle(convertInt(_0x4265de)+0xb4));}return null;}['getHeadsFrom'](_0xdc6e07){if(_0xdc6e07 in this['track']){return this['track'][_0xdc6e07];}return null;}['draw'](_0x759bd7){if(this['trackPoints']!==null){_0x759bd7['removeChild'](this['trackPoints']);this['trackPoints']['destroy']();}if(this['hasTracks']()||Object['keys'](this['newTrack'])['length']>0x0){this['trackPoints']=new Phaser['Graphics'](game,0x0,0x0);var _0x3a8181=null;var _0x556530=null;var _0x308470=null;this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['color']),0x1);for(_0x3a8181 in this['track']){_0x308470=this['track'][_0x3a8181];for(_0x556530 of _0x308470){this['addSingleTrack'](_0x3a8181,_0x556530);}}this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['activeColor']),0x1);for(_0x3a8181 in this['newTrack']){_0x308470=this['newTrack'][_0x3a8181];for(_0x556530 of _0x308470){this['addSingleTrack'](_0x3a8181,_0x556530);}}_0x759bd7['add'](this['trackPoints']);}}['highlight'](_0x27a094,_0x418469){if(_0x27a094===null&&_0x418469===null){for(var _0x46d934 in this['track']){this['newTrack'][_0x46d934]=this['track'][_0x46d934]['slice'](0x0);}}else if(_0x418469===null){this['newTrack'][_0x27a094]=this['track'][_0x27a094]['slice'](0x0);}else{var _0x3dd923=[_0x418469];if(_0x27a094 in this['newTrack']){_0x3dd923=_0x3dd923['concat'](this['newTrack'][_0x27a094]);}this['newTrack'][_0x27a094]=_0x3dd923;}}};class TramStop{constructor(_0x2d9739){this['tile']=_0x2d9739;this['canvas']=null;}['draw'](_0xe7a04f){if(this['canvas']!==null){_0xe7a04f['removeChild'](this['canvas']);this['canvas']['destroy']();}if(_0xe7a04f!==null){this['canvas']=new Phaser['Graphics'](game,this['tile']['imgX'],this['tile']['imgY']);var _0x5681eb=this['tile']['getStraightTracks']();for(var _0x828e22 of _0x5681eb){var _0x120946=this['tile']['getClosestPointInLane'](this['tile']['x'],this['tile']['y'],_0x828e22,config['Stop']['lane']);_0x120946['x']-=this['tile']['imgX'];_0x120946['y']-=this['tile']['imgY'];var _0x281229=Math['sin'](_0x828e22*Math['PI']/0xb4)*0x14;var _0x49fdbc=-Math['cos'](_0x828e22*Math['PI']/0xb4)*0x14;if(_0x828e22===0x78||_0x828e22===0x12c){_0x120946['x']-=_0x281229;_0x120946['y']-=_0x49fdbc;}_0x281229=Math['sin'](_0x828e22*Math['PI']/0xb4)*config['Stop']['length'];_0x49fdbc=-Math['cos'](_0x828e22*Math['PI']/0xb4)*config['Stop']['length'];var _0x24dc05=Math['sin']((0xb4-_0x828e22)*Math['PI']/0xb4)*config['Stop']['width'];var _0x1aceb5=-Math['cos']((0xb4-_0x828e22)*Math['PI']/0xb4)*config['Stop']['width'];this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color1']));var _0x590278=new Phaser['Point'](_0x120946['x']+_0x24dc05-_0x281229,_0x120946['y']+0x1+_0x1aceb5-_0x49fdbc);var _0x4d24d8=new Phaser['Point'](_0x120946['x']+_0x24dc05+_0x281229,_0x120946['y']+0x1+_0x1aceb5+_0x49fdbc);var _0x130c06=new Phaser['Point'](_0x120946['x']-_0x24dc05+_0x281229,_0x120946['y']+0x1-_0x1aceb5+_0x49fdbc);var _0xca61e0=new Phaser['Point'](_0x120946['x']-_0x24dc05-_0x281229,_0x120946['y']+0x1-_0x1aceb5-_0x49fdbc);this['canvas']['drawPolygon']([_0x590278,_0x4d24d8,_0x130c06,_0xca61e0]);this['canvas']['endFill']();this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color2']));_0x590278=new Phaser['Point'](_0x120946['x']+_0x24dc05-_0x281229,_0x120946['y']-0x1+_0x1aceb5-_0x49fdbc);_0x4d24d8=new Phaser['Point'](_0x120946['x']+_0x24dc05+_0x281229,_0x120946['y']-0x1+_0x1aceb5+_0x49fdbc);_0x130c06=new Phaser['Point'](_0x120946['x']-_0x24dc05+_0x281229,_0x120946['y']-0x1-_0x1aceb5+_0x49fdbc);_0xca61e0=new Phaser['Point'](_0x120946['x']-_0x24dc05-_0x281229,_0x120946['y']-0x1-_0x1aceb5-_0x49fdbc);this['canvas']['drawPolygon']([_0x590278,_0x4d24d8,_0x130c06,_0xca61e0]);this['canvas']['endFill']();}_0xe7a04f['add'](this['canvas']);}}};class TramLine{constructor(){this['NEIGHBOUR_STATUS']={'MULTIPLE_PATHS':0x0,'NO_NEIGHBOUR':0x1};this['tiles']=[];this['closed']=![];}['isEmpty'](){return this['tiles']['length']===0x0;}['isAllowed'](_0x1e4992){if(!_0x1e4992['hasTracks']()){return![];}var _0x320738=this['tiles']['length'];var _0x2e2968=null;if(_0x320738>0x1){_0x2e2968=this['tiles'][_0x320738-0x1]['getNeighbourConnection'](this['tiles'][_0x320738-0x2]);}else{_0x2e2968=_0x1e4992['getNeighbourConnection'](this['tiles'][_0x320738-0x1]);}var _0x247dc3=this['tiles'][_0x320738-0x1]['getNeighbourConnection'](_0x1e4992);if(_0x247dc3===null){return![];}var _0x1ce06a=this['tiles'][_0x320738-0x1]['getTrackHeadsFrom'](_0x2e2968);if(_0x1ce06a===null){return![];}if(!_0x1ce06a['includes'](_0x247dc3)){return![];}if(_0x1e4992['getTrackHeadsFrom'](normalizeAngle(_0x247dc3+0xb4))===null){return![];}return!![];}['getNextUniqueNeighbour'](){var _0x547a75=this['tiles']['length'];var _0x1594f2=null;if(_0x547a75>0x1){_0x1594f2=this['tiles'][_0x547a75-0x1]['getNeighbourConnection'](this['tiles'][_0x547a75-0x2]);}else{var _0x3140b9=this['tiles'][_0x547a75-0x1]['tracks']['getTrackKeys']();if(_0x3140b9['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}_0x1594f2=_0x3140b9[0x0];}var _0x5d3343=this['tiles'][_0x547a75-0x1]['getTrackHeadsFrom'](_0x1594f2);if(_0x5d3343===null){return this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR'];}if(_0x5d3343['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}return this['tiles'][_0x547a75-0x1]['getNeighbourAtHead'](_0x5d3343[0x0]);}['getTiles'](){return this['tiles'];}['abort'](){this['tiles']['forEach'](_0x17b129=>_0x17b129['abortTrack']());this['tiles']=[];this['closed']=![];}['proceed'](_0x3665f1){if(this['isEmpty']()){this['tiles']=[_0x3665f1];this['tiles'][0x0]['tracks']['highlight'](null,null);var _0x8ddd85=this['getNextUniqueNeighbour']();if(_0x8ddd85!==this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){this['proceed'](_0x8ddd85);}return;}var _0x3a774f=this['tiles']['length'];this['tiles'][_0x3a774f-0x1]['abortTrack']();if(_0x3a774f>0x1){this['tiles'][_0x3a774f-0x1]['tracks']['highlight'](this['tiles'][_0x3a774f-0x1]['getNeighbourConnection'](this['tiles'][_0x3a774f-0x2]),this['tiles'][_0x3a774f-0x1]['getNeighbourConnection'](_0x3665f1));}else{this['tiles'][_0x3a774f-0x1]['tracks']['highlight'](_0x3665f1['getNeighbourConnection'](this['tiles'][_0x3a774f-0x1]),this['tiles'][_0x3a774f-0x1]['getNeighbourConnection'](_0x3665f1));}this['tiles']['push'](_0x3665f1);while(!![]){var _0x8ddd85=this['getNextUniqueNeighbour']();_0x3a774f=this['tiles']['length'];if(_0x8ddd85===this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR']||_0x8ddd85===null){this['abort']();break;}else if(_0x8ddd85===this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){if(this['isAllowed'](this['tiles'][0x0])){this['closed']=!![];}else{this['tiles'][_0x3a774f-0x1]['tracks']['highlight'](this['tiles'][_0x3a774f-0x1]['getNeighbourConnection'](this['tiles'][_0x3a774f-0x2]),null);}break;}this['tiles'][_0x3a774f-0x1]['tracks']['highlight'](this['tiles'][_0x3a774f-0x1]['getNeighbourConnection'](this['tiles'][_0x3a774f-0x2]),this['tiles'][_0x3a774f-0x1]['getNeighbourConnection'](_0x8ddd85));if(_0x8ddd85['equals'](this['tiles'][0x1])&&this['tiles'][_0x3a774f-0x1]['equals'](this['tiles'][0x0])){this['tiles']['pop']();this['closed']=!![];break;}if(this['tiles']['length']>config['Tram']['maxLineLength']){this['abort']();break;}this['tiles']['push'](_0x8ddd85);}}static['show'](_0x5c2e85){for(var _0x29eced=0x0;_0x29eced<_0x5c2e85['length'];_0x29eced++){var _0x3ddf67=_0x29eced-0x1;var _0x10c6c9=_0x29eced+0x1;if(_0x3ddf67<0x0){_0x3ddf67=_0x5c2e85['length']-0x1;}if(_0x10c6c9>_0x5c2e85['length']-0x1){_0x10c6c9=0x0;}_0x5c2e85[_0x29eced]['tracks']['highlight'](_0x5c2e85[_0x29eced]['getNeighbourConnection'](_0x5c2e85[_0x3ddf67]),_0x5c2e85[_0x29eced]['getNeighbourConnection'](_0x5c2e85[_0x10c6c9]));}}}class Tile{constructor(_0xd473e5,_0x275573,_0x2fdc80,_0x23f633){this['fileId']=_0xd473e5;this['hash']=_0x275573;this['imgX']=_0x2fdc80;this['imgY']=_0x23f633;this['x']=this['imgX']+Math['floor'](config['Tile']['width']/0x2);this['y']=this['imgY']+Math['floor'](config['Tile']['height']/0x2);this['neighbours']=[];this['streetNeighbours']=[];this['neighbourConnections']={};this['lineSegments']=[];this['tracks']=new Tracks(this);this['tramstop']=null;this['hover']=null;this['trees']=null;this['vehicles']=[];this['vehicleHashes']=[];}['updateImage'](_0x5a47e0){this['fileId']=_0x5a47e0;var _0x376c4d=game['cache']['getImage'](this['fileId']);this['imgY']=this['imgY']+config['Tile']['height']-_0x376c4d['height'];}['draw'](_0x285930,_0x247510){if(this['isGrass']()||this['isStreet']()){_0x285930['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}else{_0x247510['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}if(this['trees']!==null){this['trees']['draw'](_0x247510);}this['hover']=new Phaser['Graphics'](game,this['imgX'],this['imgY']);this['hover']['beginFill'](Phaser['Color']['hexToRGB'](config['Tile']['hoverColor']));this['hover']['fillAlpha']=0.5;this['hover']['drawPolygon'](new Phaser['Point'](config['Tile']['width']/0x2,0x0),new Phaser['Point'](config['Tile']['width'],config['Tile']['height']/0x2),new Phaser['Point'](config['Tile']['width']/0x2,config['Tile']['height']),new Phaser['Point'](0x0,config['Tile']['height']/0x2));this['hover']['endFill']();this['hover']['visible']=![];_0x285930['add'](this['hover']);}['drawTracks'](_0x4be625){this['tracks']['draw'](_0x4be625);if(this['hasTracks']()&&this['trees']!==null){this['trees']['remove']();}}['drawVehicles'](_0x4b0bf5,_0x4c6ae3){this['vehicles']['forEach'](_0x26aa0f=>_0x26aa0f['draw'](_0x4b0bf5,_0x4c6ae3));}['drawStop'](_0x28b644){if(this['hasStop']()){this['tramstop']['draw'](_0x28b644);}}['setHover'](_0x1f18ac){this['hover']['visible']=_0x1f18ac;}['addStop'](){this['tramstop']=new TramStop(this);}['equals'](_0x2e89bf){if(_0x2e89bf===null){return![];}return this['hash']===_0x2e89bf['hash'];}['equalsHash'](_0x2f785d){return this['hash']==_0x2f785d;}['update'](){this['vehicles']['forEach'](_0x3cf734=>_0x3cf734['update']());}['isGrass'](){return this['fileId']===config['Tile']['grass'];}['isStreet'](){return this['fileId']['startsWith'](config['Tile']['streetPrefix']);}['isHouse'](){return!this['isGrass']()&&!this['isStreet']();}['isStraight'](){return config['Street']['straights']['includes'](this['fileId']);}['isHighway'](){return config['Street']['highways']['includes'](this['fileId']);}['isCurve'](){return config['Street']['curves']['includes'](this['fileId']);}['isStraightOrCurve'](){return this['isStraight']()||this['isCurve']();}['isDeadEnd'](){return config['Street']['deadEnds']['includes'](this['fileId']);}['isStraightTrack'](){if(this['hasTracks']()){return this['tracks']['isStraight']();}return![];}['getStraightTracks'](){if(this['hasTracks']()){return this['tracks']['getStraights']();}return null;}['isNonIntersectingTrack'](){if(this['hasTracks']()){return this['tracks']['isNotIntersecting']();}return!![];}['isDeadEndOrJunctionOrCrossing'](){if(this['isDeadEnd']()){return!![];}if(!this['isStraightOrCurve']()&&!this['isGrass']()){return!![];}if(this['hasTracks']()){if(this['tracks']['isDeadEnd']()){return!![];}var _0x411a40=this['lineSegments']['concat'](this['tracks']['getLineSegments']());if(this['linesIntersectInside'](_0x411a40)){return!![];}}return![];}['linesIntersectInside'](_0x34e27d){var _0xd26bea=null;for(var _0x39dec4=0x0;_0x39dec4<_0x34e27d['length'];_0x39dec4++){for(var _0x5eb025=_0x39dec4+0x1;_0x5eb025<_0x34e27d['length'];_0x5eb025++){if(!linesAreEqual(_0x34e27d[_0x39dec4],_0x34e27d[_0x5eb025])){for(var _0x41ae49 of _0x34e27d[_0x39dec4]){for(var _0x486c59 of _0x34e27d[_0x5eb025]){_0xd26bea=Phaser['Line']['intersects'](_0x41ae49,_0x486c59);if(_0xd26bea!==null&&this['inside'](_0xd26bea['x'],_0xd26bea['y'],0.99)){return!![];}}}}}}return![];}['hasStop'](){return this['tramstop']!==null;}['hasTracks'](){return this['tracks']['hasTracks']();}['generateHouse'](_0x263747){if(!this['isGrass']()||this['hasTracks']()){return;}var _0x1277cc=![];for(var _0x5d5806 of this['neighbours']){if(_0x5d5806['isStreet']()&&!_0x5d5806['isHighway']()){_0x1277cc=!![];break;}}if(_0x1277cc&&Math['random']()<config['Tile']['probHouse']){var _0x50e56c=_0x263747[Math['floor'](Math['random']()*_0x263747['length'])];this['updateImage'](_0x50e56c);}}['generateTrees'](_0x42be61){if(this['isGrass']()&&!this['hasTracks']()){this['trees']=new Trees(this,_0x42be61);this['trees']['generateTrees']();}}['generateCars'](_0x50b8c4){if(this['isStreet']()){var _0x5521a4=this['getStreetConnections']();var _0x160e0e=_0x5521a4[Math['floor'](Math['random']()*_0x5521a4['length'])];if(this['hasFreeParkingLot'](_0x160e0e)){if(Math['random']()<config['Tile']['probCar']){this['addVehicle'](new Car(this,_0x160e0e,_0x50b8c4,config['Car']['numTypes'],null));}}}}['generateTrack'](_0x5b4686){this['tracks']['generate'](_0x5b4686);}['abortTrack'](){this['tracks']['abort']();}['finalizeTrack'](){this['tracks']['finalize']();if(this['hasStop']()&&!this['isStraightTrack']()){this['tramstop']['draw'](null);this['tramstop']=null;}}['getTrackHeadsFrom'](_0x3aa498){return this['tracks']['getHeadsFrom'](_0x3aa498);}['computeAllNeighbours'](_0xb6069a){var _0x4d8289=0xa;for(var _0x3570ba of _0xb6069a){if(!this['equals'](_0x3570ba)){if(this['x']+_0x4d8289<_0x3570ba['x']&&_0x3570ba['x']<this['x']+config['Tile']['width']-_0x4d8289&&this['y']-config['Tile']['height']+_0x4d8289<_0x3570ba['y']&&_0x3570ba['y']<this['y']-_0x4d8289){this['neighbours']['push'](_0x3570ba);}else if(this['x']+_0x4d8289<_0x3570ba['x']&&_0x3570ba['x']<this['x']+config['Tile']['width']-_0x4d8289&&this['y']+_0x4d8289<_0x3570ba['y']&&_0x3570ba['y']<this['y']+config['Tile']['height']-_0x4d8289){this['neighbours']['push'](_0x3570ba);}else if(this['x']-config['Tile']['width']+_0x4d8289<_0x3570ba['x']&&_0x3570ba['x']<this['x']-_0x4d8289&&this['y']+_0x4d8289<_0x3570ba['y']&&_0x3570ba['y']<this['y']+config['Tile']['height']-_0x4d8289){this['neighbours']['push'](_0x3570ba);}else if(this['x']-config['Tile']['width']+_0x4d8289<_0x3570ba['x']&&_0x3570ba['x']<this['x']-_0x4d8289&&this['y']-config['Tile']['height']+_0x4d8289<_0x3570ba['y']&&_0x3570ba['y']<this['y']-_0x4d8289){this['neighbours']['push'](_0x3570ba);}}}}['computeStreetNeighboursAndConnections'](){for(var _0x3001cf of this['neighbours']){if(!_0x3001cf['isHouse']()){var _0xd11efa=null;if(_0x3001cf['x']>this['x']&&_0x3001cf['y']<this['y']){_0xd11efa=0x3c;}else if(_0x3001cf['x']>this['x']&&_0x3001cf['y']>this['y']){_0xd11efa=0x78;}else if(_0x3001cf['x']<this['x']&&_0x3001cf['y']>this['y']){_0xd11efa=0xf0;}else if(_0x3001cf['x']<this['x']&&_0x3001cf['y']<this['y']){_0xd11efa=0x12c;}this['neighbourConnections'][_0x3001cf['hash']]=convertInt(_0xd11efa);if(_0x3001cf['isStreet']()&&this['isConnectedTo'](_0xd11efa)){if(!this['isStraightOrCurve']()&&!_0x3001cf['isStraightOrCurve']()){error('Cannot\x20handle\x20neighbouring\x20junctions,\x20crossings,\x20or\x20dead\x20ends.',this,null);}this['streetNeighbours']['push'](_0x3001cf);}}}}['computeLineSegments'](){var _0x3e9176=this['getStreetConnections']();if(_0x3e9176['length']===0x2){for(var _0x5a1ab4=0x0;_0x5a1ab4<0x2;_0x5a1ab4++){var _0xcebb21=normalizeAngle(_0x3e9176[_0x5a1ab4]+0xb4);var _0x4cc757=_0x3e9176[0x1-_0x5a1ab4];var _0x165418=this['getLaneStartPoint'](_0xcebb21,config['Street']['laneDrive'],0x1);var _0x7840e3=this['getLaneTargetPoint'](_0x4cc757,config['Street']['laneDrive'],0.24);var _0x12ee08=[];if(getTurnDirection(_0xcebb21,_0x4cc757)===-0x1){_0x12ee08['push'](new Phaser['Line'](Math['round'](_0x165418['x']),Math['round'](_0x165418['y']),Math['round'](this['x']),Math['round'](this['y'])));_0x12ee08['push'](new Phaser['Line'](Math['round'](this['x']),Math['round'](this['y']),Math['round'](_0x7840e3['x']),Math['round'](_0x7840e3['y'])));}else{_0x12ee08['push'](new Phaser['Line'](Math['round'](_0x165418['x']),Math['round'](_0x165418['y']),Math['round'](_0x7840e3['x']),Math['round'](_0x7840e3['y'])));}this['lineSegments']['push'](_0x12ee08);}}}['getNeighbourConnection'](_0x1db7cc){var _0x8403c=_0x1db7cc;if(typeof _0x1db7cc!=='string'){_0x8403c=_0x1db7cc['hash'];}if(!(_0x8403c in this['neighbourConnections'])){return null;}return this['neighbourConnections'][_0x8403c];}['getNeighbourAtHead'](_0x552910){var _0x23b1e0=this['neighbours']['filter'](_0x4d711d=>this['neighbourConnections'][_0x4d711d['hash']]===_0x552910);if(_0x23b1e0['length']!==0x1){return null;}return _0x23b1e0[0x0];}['isTrackNeighbourOf'](_0x22cacc){return this['neighbours']['includes'](_0x22cacc)&&!_0x22cacc['isHouse']();}['isConnectedTo'](_0x1727ce){var _0x135c90=parseInt(this['fileId']['substring'](0x1,0x5));if([0x1,0x5,0x9,0x15,0x2d,0x31,0x35,0x4d,0x55]['includes'](_0x135c90)){if(convertInt(_0x1727ce)===0x12c){return!![];}}if([0x5,0x9,0xd,0x11,0x2d,0x35,0x39,0x41,0x51]['includes'](_0x135c90)){if(convertInt(_0x1727ce)===0x3c){return!![];}}if([0x1,0x9,0xd,0x15,0x2d,0x39,0x3d,0x45,0x55]['includes'](_0x135c90)){if(convertInt(_0x1727ce)===0x78){return!![];}}if([0x1,0x5,0xd,0x11,0x2d,0x31,0x3d,0x49,0x51]['includes'](_0x135c90)){if(convertInt(_0x1727ce)===0xf0){return!![];}}return![];}['getStreetConnections'](){var _0x52b62a=[0x3c,0x78,0xf0,0x12c];return _0x52b62a['filter'](_0x433312=>this['isConnectedTo'](_0x433312));}['inside'](_0x5e3c94,_0x2164ac,_0x515a73){_0x515a73=typeof _0x515a73==='undefined'?0x1:_0x515a73;var _0x4abc49=this['x']-_0x5e3c94;var _0x56c1c1=this['y']-_0x2164ac;var _0x3cf6ed=config['Tile']['width']/config['Tile']['height'];return Math['abs'](_0x4abc49+_0x3cf6ed*_0x56c1c1)<_0x515a73*config['Tile']['width']*0.5&&Math['abs'](_0x4abc49-_0x3cf6ed*_0x56c1c1)<_0x515a73*config['Tile']['width']*0.5;}['nearCenter'](_0x9fa7f9,_0x5b87ba){return this['inside'](_0x9fa7f9,_0x5b87ba,config['Street']['centerSizeFactor']);}['centerAhead'](_0x42d23a,_0x215b70){if(0x0<_0x215b70&&_0x215b70<0xb4){return _0x42d23a<this['x'];}return _0x42d23a>this['x'];}['getLane'](_0x33f662,_0x5a460c){var _0x314336=Math['cos'](_0x33f662*Math['PI']/0xb4);var _0xa5eac6=Math['sin'](_0x33f662*Math['PI']/0xb4);var _0x58da32=this['x'];var _0x26bafd=this['y'];if(convertInt(_0x33f662)===0x3c||convertInt(_0x33f662)===0x78){_0x26bafd+=_0x5a460c;}else{_0x26bafd-=_0x5a460c;}return{'nx':_0x314336,'ny':_0xa5eac6,'px':_0x58da32,'py':_0x26bafd};}['getClosestPointInLane'](_0x56a88f,_0x55d806,_0x39fb34,_0x13ad30){var _0xd00ed0=this['getLane'](_0x39fb34,_0x13ad30);var _0xf08ea0=_0xd00ed0['nx']**0x2*_0xd00ed0['px']+_0xd00ed0['ny']**0x2*_0x56a88f+_0xd00ed0['nx']*_0xd00ed0['ny']*(_0xd00ed0['py']-_0x55d806);var _0x250ac2=_0xd00ed0['ny']**0x2*_0xd00ed0['py']+_0xd00ed0['nx']**0x2*_0x55d806+_0xd00ed0['nx']*_0xd00ed0['ny']*(_0xd00ed0['px']-_0x56a88f);return new Point(_0xf08ea0,_0x250ac2);}['getDistanceToLane'](_0x269e91,_0x52fdef,_0x53534e,_0x5dc5e7){var _0x25bc0a=this['getClosestPointInLane'](_0x269e91,_0x52fdef,_0x53534e,_0x5dc5e7);return Math['sqrt']((_0x269e91-_0x25bc0a['x'])**0x2+(_0x52fdef-_0x25bc0a['y'])**0x2);}['getTileBoundaryPoint'](_0x16e2f8,_0x17ab64,_0x3bfe74,_0x2524bd){var _0x3addac=this['x'];var _0x53cd2c=this['y'];if(convertInt(_0x3bfe74)===0x3c||convertInt(_0x3bfe74)===0x78){_0x53cd2c+=_0x2524bd;_0x17ab64+=_0x2524bd;}else{_0x53cd2c-=_0x2524bd;_0x17ab64-=_0x2524bd;}var _0x3930e7=new Phaser['Line'](_0x3addac,_0x53cd2c,_0x16e2f8,_0x17ab64);var _0x5c42e2=null;for(var _0x3bfe74 of[0x3c,0x78,0xf0,0x12c]){switch(_0x3bfe74){case 0x3c:_0x5c42e2=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0x78:_0x5c42e2=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0xf0:_0x5c42e2=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;case 0x12c:_0x5c42e2=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;}var _0xe9524e=Phaser['Line']['intersects'](_0x3930e7,_0x5c42e2);if(_0xe9524e!==null){return _0xe9524e;}}return null;}['getLaneTargetPoint'](_0x504769,_0x38bf71,_0x2afe1a){var _0x48cc14=_0x2afe1a*config['Tile']['width'];var _0x1eb7ed=this['x']+Math['sin'](_0x504769*Math['PI']/0xb4)*_0x48cc14;var _0xb896a0=this['y']-Math['cos'](_0x504769*Math['PI']/0xb4)*_0x48cc14;if(_0x2afe1a>=0x1){return this['getTileBoundaryPoint'](_0x1eb7ed,_0xb896a0,_0x504769,_0x38bf71);}return this['getClosestPointInLane'](_0x1eb7ed,_0xb896a0,_0x504769,_0x38bf71);}['getLaneStartPoint'](_0x4dffda,_0xece83c,_0x17b213){var _0x5ac96c=_0x17b213*config['Tile']['width'];var _0x2269b5=this['x']-Math['sin'](_0x4dffda*Math['PI']/0xb4)*_0x5ac96c;var _0x32bb1b=this['y']+Math['cos'](_0x4dffda*Math['PI']/0xb4)*_0x5ac96c;if(_0x17b213>=0x1){return this['getTileBoundaryPoint'](_0x2269b5,_0x32bb1b,_0x4dffda,_0xece83c);}return this['getClosestPointInLane'](_0x2269b5,_0x32bb1b,_0x4dffda,_0xece83c);}['addVehicle'](_0x26177a){this['vehicles']['push'](_0x26177a);this['vehicleHashes']['push'](_0x26177a['hash']);}['removeVehicle'](_0x167583){var _0x51e479=this['vehicleHashes']['indexOf'](_0x167583['hash']);if(_0x51e479>=0x0){this['vehicles']['splice'](_0x51e479,0x1);this['vehicleHashes']['splice'](_0x51e479,0x1);}}['clickVehicle'](_0x1fe637,_0x9961c3){for(var _0x139213 of this['vehicles']){if(_0x139213['isTram']()&&_0x139213['click'](_0x1fe637,_0x9961c3)){TramLine['show'](_0x139213['getLine']());return _0x139213;}}return null;}['getVehicleIndex'](_0x4e6f1a){return this['vehicleHashes']['indexOf'](_0x4e6f1a['hash']);}['onlySameVehicleType'](){if(this['vehicles']['length']>0x0){for(var _0x3fcec0=0x1;_0x3fcec0<this['vehicles']['length'];_0x3fcec0++){if(this['vehicles'][_0x3fcec0]['isTram']()!==this['vehicles'][0x0]['isTram']()){return![];}}}return!![];}['hasFreeParkingLot'](_0x32a415){if(!this['isStraight']()){return![];}if(this['isHighway']()){return![];}if(this['isDeadEndOrJunctionOrCrossing']()){return![];}if(this['hasStop']()){return![];}if(!this['isConnectedTo'](_0x32a415)){return![];}for(var _0x445fa6 of this['vehicles']){if(_0x445fa6['isParking']()&&_0x445fa6['getHead']()===convertInt(_0x32a415)){return![];}}return!![];}};class Map{constructor(){this['tiles']=[];this['tileRowId']=[];this['masterGroup']=null;this['rowGroupsGround']=[];this['rowGroupsHouses']=[];this['nCols']=0x0;this['nRows']=0x0;this['newTrack']=[];this['newLine']=new TramLine();this['selectedVehicle']=null;this['tileHover']=null;}['loadMap'](_0x39e1bc){var _0x4adae4=_0x39e1bc['trim']()['split']('\x0a');this['masterGroup']=game['add']['group']();for(var _0x2707c8=0x0;_0x2707c8<_0x4adae4['length'];_0x2707c8++){if(_0x4adae4[_0x2707c8]['includes'](',')){var _0x391950=_0x4adae4[_0x2707c8]['split'](',');this['nRows']++;this['nCols']=Math['max'](this['nCols'],_0x391950['length']);var _0x27b86e=game['add']['group']();var _0x1cae7f=game['add']['group']();_0x27b86e['yz']=(_0x2707c8-0x1)*config['Tile']['dy'];_0x1cae7f['yz']=(_0x2707c8-0x1)*config['Tile']['dy']+config['Tile']['height'];this['rowGroupsGround']['push'](_0x27b86e);this['rowGroupsHouses']['push'](_0x1cae7f);this['masterGroup']['add'](_0x27b86e);this['masterGroup']['add'](_0x1cae7f);var _0x39f1a3=-config['Tile']['dx']*(0x1-_0x2707c8%0x2);for(var _0x1b089a=0x0;_0x1b089a<_0x391950['length'];_0x1b089a++){var _0x3092d2=_0x391950[_0x1b089a]['trim']();if(_0x3092d2['length']>0x0){var _0x282501=_0x3092d2['substring'](0x0,0x4);var _0x1f6947=_0x3092d2['substring'](0x4);var _0x490659=new Tile(_0x1f6947,_0x282501,_0x39f1a3+0x2*_0x1b089a*config['Tile']['dx'],(_0x2707c8-0x1)*config['Tile']['dy']);this['tiles']['push'](_0x490659);this['tileRowId']['push'](this['nRows']-0x1);}}}}}['loadTracks'](_0x42a4b9){var _0x35a7b7=_0x42a4b9['trim']()['split']('\x0a');for(var _0x4eecaf=0x0;_0x4eecaf<_0x35a7b7['length'];_0x4eecaf++){if(_0x35a7b7[_0x4eecaf]['includes'](',')){var _0xb7a34e=_0x35a7b7[_0x4eecaf]['split'](',');for(var _0x431cfe of _0xb7a34e){for(var _0x575c19 of this['tiles']){if(_0x575c19['equalsHash'](_0x431cfe)){_0x575c19['generateTrack'](_0xb7a34e);_0x575c19['finalizeTrack']();}}}}}}['loadStops'](_0x2f79f3){var _0x177dbb=_0x2f79f3['trim']();if(_0x177dbb['includes'](',')){var _0x3bd53f=_0x177dbb['split'](',');for(var _0x352858 of _0x3bd53f){for(var _0x1176a5 of this['tiles']){if(_0x1176a5['equalsHash'](_0x352858)){_0x1176a5['addStop']();}}}}}['loadTrams'](_0x30345f,_0x581a6d){var _0x4f4fc9=_0x30345f['trim']()['split']('\x0a');for(var _0xffc75d=0x0;_0xffc75d<_0x4f4fc9['length'];_0xffc75d++){if(_0x4f4fc9[_0xffc75d]['includes'](',')){var _0x14df2b=_0x4f4fc9[_0xffc75d]['split'](',');var _0x537d9e=[];for(var _0x791d9e of _0x14df2b){for(var _0x5423d5 of this['tiles']){if(_0x5423d5['equalsHash'](_0x791d9e)){_0x537d9e['push'](_0x5423d5);}}}if(_0x537d9e['length']>0x1){var _0x8e8281=Math['ceil'](_0x537d9e['length']/config['Tram']['maxTilesPerTram']);var _0x2c9cd6=getPermutations(_0x537d9e,_0x8e8281);_0x2c9cd6['forEach'](function(_0x2ef2fe){_0x2ef2fe[0x0]['addVehicle'](new Tram(_0x2ef2fe[0x0],_0x2ef2fe[0x0]['getNeighbourConnection'](_0x2ef2fe[0x1]),_0x581a6d,config['Tram']['numTypes'],_0x2ef2fe));});}}}}['getWidth'](){return 0x2*this['nCols']*config['Tile']['dx']-Math['floor'](config['Tile']['width']/0x2);}['getHeight'](_0x20de16){return this['nRows']*config['Tile']['dy']-Math['floor'](config['Tile']['height']/0x2);}['initTiles'](){this['tiles']['forEach'](function(_0x276a7f,_0x19a151,_0x2573f7){_0x276a7f['computeAllNeighbours'](_0x2573f7);});this['tiles']['forEach'](function(_0x1283fd){_0x1283fd['computeStreetNeighboursAndConnections']();_0x1283fd['computeLineSegments']();});}['generateItems'](_0x5dd304,_0x111c1e,_0x4cca78){this['tiles']['forEach'](function(_0x55ed53){_0x55ed53['generateHouse'](_0x5dd304);_0x55ed53['generateTrees'](_0x111c1e);_0x55ed53['generateCars'](_0x4cca78);});}['draw'](){for(var _0x15f15f=0x0;_0x15f15f<this['tiles']['length'];_0x15f15f++){this['tiles'][_0x15f15f]['draw'](this['rowGroupsGround'][this['tileRowId'][_0x15f15f]],this['rowGroupsHouses'][this['tileRowId'][_0x15f15f]]);}this['drawVehicles']();this['drawTracks']();}['drawTracks'](){for(var _0x58489a=0x0;_0x58489a<this['tiles']['length'];_0x58489a++){this['tiles'][_0x58489a]['drawTracks'](this['rowGroupsGround'][this['tileRowId'][_0x58489a]]);}this['drawStops']();}['drawVehicles'](){for(var _0x480dc1 of this['tiles']){_0x480dc1['drawVehicles'](this['masterGroup'],disableUI);}}['drawStops'](){for(var _0xac4f2c=0x0;_0xac4f2c<this['tiles']['length'];_0xac4f2c++){this['tiles'][_0xac4f2c]['drawStop'](this['rowGroupsGround'][this['tileRowId'][_0xac4f2c]]);}}['update'](){this['tiles']['forEach'](_0x425117=>_0x425117['update']());this['masterGroup']['sort']('yz');}['disableTileHover'](){if(this['tileHover']!==null){this['tileHover']['setHover'](![]);}}['newTrackClick'](_0x193528,_0x63fc3a,_0x2a3e39){for(var _0x26386d of this['tiles']){if(_0x26386d['inside'](_0x193528,_0x63fc3a)){this['disableTileHover']();if(!_0x26386d['isHouse']()&&(this['newTrack']['length']===0x0||this['newTrack'][this['newTrack']['length']-0x1]['isTrackNeighbourOf'](_0x26386d))){if(_0x2a3e39){this['tileHover']=_0x26386d;this['tileHover']['setHover'](!![]);return!![];}this['newTrack']['push'](_0x26386d);var _0x27a309=this['newTrack']['map'](_0x193528=>_0x193528['hash']);_0x26386d['generateTrack'](_0x27a309);if(this['newTrack']['length']>0x1){this['newTrack'][0x0]['generateTrack'](_0x27a309);this['newTrack'][this['newTrack']['length']-0x2]['generateTrack'](_0x27a309);}this['drawTracks']();return!![];}return![];}}return![];}['newStopClick'](_0x36dc69,_0x32be82,_0xd9cb1c){for(var _0x5c5649 of this['tiles']){if(_0x5c5649['inside'](_0x36dc69,_0x32be82)){this['disableTileHover']();if(_0x5c5649['hasTracks']()&&_0x5c5649['isStraightTrack']()&&(_0x5c5649['isStraight']()||_0x5c5649['isGrass']())&&!_0x5c5649['hasStop']()){if(_0xd9cb1c){this['tileHover']=_0x5c5649;this['tileHover']['setHover'](!![]);return!![];}_0x5c5649['addStop']();console['log'](_0x5c5649['hash']);this['drawStops']();return!![];}return![];}}return![];}['newTramClick'](_0x3cb716,_0x460f76,_0x2962df,_0x334767){for(var _0x52e301 of this['tiles']){if(_0x52e301['inside'](_0x3cb716,_0x460f76)){this['disableTileHover']();if(_0x52e301['hasTracks']()&&(this['newLine']['isEmpty']()&&_0x52e301['isStraightTrack']()||!this['newLine']['isEmpty']()&&this['newLine']['isAllowed'](_0x52e301))){if(_0x2962df){this['tileHover']=_0x52e301;this['tileHover']['setHover'](!![]);return!![];}this['newLine']['proceed'](_0x52e301);this['drawTracks']();if(this['newLine']['closed']){this['newTramFinalize'](_0x334767);}return!![];}return![];}}return![];}['showTramClick'](_0x55137b,_0x321f7c){this['tiles']['forEach'](_0x1a5874=>_0x1a5874['abortTrack']());var _0x3ac2b9=![];this['selectedVehicle']=null;for(var _0x39de0d of this['tiles']){var _0x2f3700=_0x39de0d['clickVehicle'](_0x55137b,_0x321f7c);if(_0x2f3700!==null){this['selectedVehicle']=_0x2f3700;_0x3ac2b9=!![];}}this['drawTracks']();return _0x3ac2b9;}['newTrackAbort'](){if(this['newTrack']['length']>0x0){this['newTrack']['forEach'](_0x410d65=>_0x410d65['abortTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramAbort'](){if(this['newLine']!==null){this['newLine']['abort']();this['drawTracks']();}this['disableTileHover']();}['newTrackFinalize'](){if(this['newTrack']['length']<0x2){this['newTrackAbort']();return;}if(this['newTrack']['length']>0x0){console['log'](this['newTrack']['map'](_0x4803f1=>_0x4803f1['hash'])['join']());this['newTrack']['forEach'](_0x2d5918=>_0x2d5918['finalizeTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramFinalize'](_0xac5f68){if(this['newLine']!==null){var _0x2ab91e=this['newLine']['getTiles']();console['log'](_0x2ab91e['map'](_0x3d662c=>_0x3d662c['hash'])['join']());_0x2ab91e[0x0]['addVehicle'](new Tram(_0x2ab91e[0x0],_0x2ab91e[0x0]['getNeighbourConnection'](_0x2ab91e[0x1]),_0xac5f68,config['Tram']['numTypes'],_0x2ab91e));this['drawVehicles']();this['newTramAbort']();}}['removeSelectedTram'](){if(this['selectedVehicle']!==null){this['selectedVehicle']['disable']();this['selectedVehicle']=null;this['showTramClick'](-0x1,-0x1);}}};class Driver{};class CarDriver extends Driver{['leaveParkingLot'](){return Math['random']()<config['Driver']['probStepDrive'];}['parkNow'](){return Math['random']()<config['Driver']['probTilePark'];}['decideTurn'](_0x291276){return _0x291276[Math['floor'](Math['random']()*_0x291276['length'])];}['getLine'](){return null;}};class TramDriver extends Driver{constructor(_0x1b5cb2){super();this['tiles']=_0x1b5cb2;this['line']=_0x1b5cb2['map'](_0x22ddb0=>_0x22ddb0['hash']);this['lastLineIndex']=0x0;this['waitingTime']=0x0;}['leaveStop'](){this['waitingTime']+=0x1;if(this['waitingTime']>config['Driver']['waitAtStop']){this['waitingTime']=0x0;return!![];}return![];}['decideTurn'](_0x3ae125){var _0x2e0a79=this['line']['indexOf'](_0x3ae125['hash'],this['lastLineIndex']);if(_0x2e0a79<0x0){_0x2e0a79=this['line']['indexOf'](_0x3ae125['hash']);if(_0x2e0a79<0x0){return null;}}_0x2e0a79+=0x1;if(_0x2e0a79>this['line']['length']-0x1){_0x2e0a79=0x0;}this['lastLineIndex']=_0x2e0a79;return _0x3ae125['getNeighbourConnection'](this['line'][_0x2e0a79]);}['getLine'](){return this['tiles'];}};class BezierCurve{constructor(_0x59c62b){this['anchorPoints']=_0x59c62b;}['get'](_0x39f5f0){var _0x145b97=this['anchorPoints']['length'];var _0x470ba0=Array(_0x145b97);var _0x39f4fb=null;var _0x552eec=null;for(_0x39f4fb=0x0;_0x39f4fb<_0x145b97;_0x39f4fb++){_0x470ba0[_0x39f4fb]=Array(_0x145b97);}for(_0x39f4fb=0x0;_0x39f4fb<_0x145b97;_0x39f4fb++){_0x470ba0[_0x39f4fb][0x0]=this['anchorPoints'][_0x39f4fb];}var _0x46eaff=0x0;var _0x469bd0=0x0;for(_0x552eec=0x1;_0x552eec<_0x145b97;_0x552eec++){for(_0x39f4fb=0x0;_0x39f4fb<_0x145b97-_0x552eec;_0x39f4fb++){_0x46eaff=(0x1-_0x39f5f0)*_0x470ba0[_0x39f4fb][_0x552eec-0x1]['x']+_0x39f5f0*_0x470ba0[_0x39f4fb+0x1][_0x552eec-0x1]['x'];_0x469bd0=(0x1-_0x39f5f0)*_0x470ba0[_0x39f4fb][_0x552eec-0x1]['y']+_0x39f5f0*_0x470ba0[_0x39f4fb+0x1][_0x552eec-0x1]['y'];_0x470ba0[_0x39f4fb][_0x552eec]=new Point(_0x46eaff,_0x469bd0);}}return _0x470ba0[0x0][_0x145b97-0x1];}['getPath'](_0x588478){var _0x3fc79b=[];var _0x53674a=0x0;var _0x47ef01=this['anchorPoints'][0x0];var _0x5a6979=null;var _0x25007b=null;var _0x24c667=null;var _0x3ea195=null;var _0x3c9fed=null;var _0x497f9c=null;var _0x155a42=null;while(_0x53674a<0x1){_0x25007b=_0x53674a;_0x24c667=0x0;_0x3ea195=0x0;_0x3c9fed=0x0;while(_0x24c667<_0x588478){_0x25007b+=0.005;_0x5a6979=this['get'](_0x25007b);_0x3ea195=_0x5a6979['x']-_0x47ef01['x'];_0x3c9fed=_0x5a6979['y']-_0x47ef01['y'];_0x24c667=Math['sqrt'](_0x3ea195*_0x3ea195+_0x3c9fed*_0x3c9fed);}_0x497f9c=Math['atan2'](_0x3ea195,-_0x3c9fed)*0xb4/Math['PI'];if(_0x497f9c<0x0){_0x497f9c+=0x168;}_0x155a42=new Point((_0x47ef01['x']+_0x5a6979['x'])/0x2,(_0x47ef01['y']+_0x5a6979['y'])/0x2);_0x155a42['head']=_0x497f9c;_0x3fc79b['push'](_0x155a42);_0x47ef01=new Point(_0x5a6979['x'],_0x5a6979['y']);_0x53674a=_0x25007b;}return _0x3fc79b['slice'](0x0,_0x3fc79b['length']-0x1);}};class Vehicle{constructor(_0x445887,_0x23b7c6,_0x52d76f,_0x101ccb){this['hash']=generateRandomId();this['colorId']=_0x52d76f[Math['floor'](Math['random']()*_0x52d76f['length'])];this['typeId']=Math['floor'](Math['random']()*_0x101ccb);this['sprite']=null;this['bounds']={};this['tile']=_0x445887;this['oldTile']='null';this['v']=0x0;this['head']=_0x23b7c6;this['queue']=[];this['cachedHead']=null;this['cachedClosestHead']=null;this['cachedSpriteHead']=null;this['cachedSpritePosition']=new Point(null,null);this['start']();this['waitingTime']=0x0;this['collisionWith']=null;this['turnPath']=null;this['plannedHead']=null;this['error']=![];this['lastStop']=null;}['disable'](){this['y']=-0x64;this['error']=!![];this['tile']['removeVehicle'](this);this['sprite']['destroy']();this['queue']=[];}['equals'](_0x47bbec){return this['hash']===_0x47bbec['hash'];}['closeTo'](_0x4bf3d5,_0x206e0e,_0x398aae){return(_0x206e0e-_0x4bf3d5['x'])**0x2+(_0x398aae-_0x4bf3d5['y'])**0x2<0.5*(this['sprite']['height']+_0x4bf3d5['sprite']['height'])**0x2;}['startXY'](_0xb17743,_0x3c2a2d){this['x']=this['tile']['x'];if(_0xb17743===0x3c||_0xb17743===0x12c){this['x']+=config['Tile']['width']/0x4;}else{this['x']-=config['Tile']['width']/0x4;}this['y']=(_0x3c2a2d['nx']*(_0x3c2a2d['px']-this['x'])+_0x3c2a2d['ny']*_0x3c2a2d['py'])/_0x3c2a2d['ny'];}['draw'](_0x22d723,_0x5defe8){if(this['sprite']===null){this['sprite']=game['add']['sprite'](0x0,0x0,this['colorId']);this['updateSprite'](this['x'],this['y'],this['getHead']());_0x22d723['add'](this['sprite']);this['createBounds']();if(!_0x5defe8){this['setCursor']();}}}['createBounds'](){var _0x3a979a=this['sprite']['width'];var _0x2ebaf5=document['getElementById']('vehicle-canvas');var _0x364e18=this['sprite']['texture']['baseTexture']['source'];_0x2ebaf5['getContext']('2d')['drawImage'](_0x364e18,0x0,0x0,_0x364e18['width'],_0x364e18['height']);var _0x3a0056=this['typeId']*_0x3a979a;for(var _0x1c578c=0x0;_0x1c578c<config['Vehicle']['headingOrder']['length'];_0x1c578c++){var _0x301f1a=[];var _0x20c8a7=_0x1c578c*_0x3a979a;for(var _0x46d28f=0x0;_0x46d28f<0x168;_0x46d28f+=config['Vehicle']['collisionSampling']){for(var _0x3c9e0f=0x0;_0x3c9e0f<_0x3a979a;_0x3c9e0f++){var _0x2fcb5f=Math['round'](_0x3c9e0f*Math['sin'](_0x46d28f*Math['PI']/0xb4));var _0x2f475f=-Math['round'](_0x3c9e0f*Math['cos'](_0x46d28f*Math['PI']/0xb4));var _0x47e565=_0x2ebaf5['getContext']('2d')['getImageData'](_0x2fcb5f+_0x20c8a7+Math['round'](_0x3a979a/0x2),_0x2f475f+_0x3a0056+Math['round'](_0x3a979a/0x2),0x1,0x1)['data'][0x3];if(_0x47e565<0xff){_0x301f1a['push'](_0x2fcb5f);_0x301f1a['push'](_0x2f475f);break;}}}this['bounds'][config['Vehicle']['headingOrder'][_0x1c578c]]=new Phaser['Polygon'](_0x301f1a);}}['getBounds'](){return this['bounds'][this['getHead']()];}['updateSprite'](_0x2e78dc,_0x1521c5,_0x294b5f){if(this['sprite']!==null){this['updateSpritePosition'](_0x2e78dc,_0x1521c5);this['updateSpriteFrame'](_0x294b5f);}}['updateSpritePosition'](_0x123ca4,_0x4b4639){if(!this['cachedSpritePosition']['equals'](_0x123ca4,_0x4b4639)){this['sprite']['x']=_0x123ca4-this['sprite']['width']/0x2;this['sprite']['y']=_0x4b4639-this['sprite']['height']/0x2;this['sprite']['yz']=_0x4b4639+this['sprite']['height']/0x2;this['cachedSpritePosition']=new Point(_0x123ca4,_0x4b4639);}}['updateSpriteFrame'](_0x38c0a9){_0x38c0a9=convertInt(_0x38c0a9);if(this['cachedSpriteHead']!==_0x38c0a9){var _0x15c1cc=config['Vehicle']['headingOrder']['indexOf'](_0x38c0a9);if(_0x15c1cc===-0x1){error('Heading\x20not\x20in\x20vehicle\x20sprite',this,this['disable']);return null;}this['sprite']['frame']=this['typeId']*config['Vehicle']['headingOrder']['length']+_0x15c1cc;this['cachedSpriteHead']=_0x38c0a9;}}['click'](_0x4aa3ee,_0x305e61){if(this['sprite']!==null){return Phaser['Rectangle']['containsPoint'](this['sprite']['getBounds'](),new Phaser['Point'](_0x4aa3ee,_0x305e61));}return![];}['getLine'](){return this['driver']['getLine']();}['update'](){if(this['error']){return;}if(this['queue'][0x0]['call'](this)){this['queue']['shift']();}var _0x574dbd=0x1/config['World']['stepsPerSecond'];this['waitingTime']+=_0x574dbd;if(this['v']>0x0){var _0x16cff5=this['getHead']();var _0xe10cd3=Math['sin'](_0x16cff5*Math['PI']/0xb4)*this['v']*_0x574dbd;var _0x23ae54=-Math['cos'](_0x16cff5*Math['PI']/0xb4)*this['v']*_0x574dbd;if(this['collision'](this['x']+_0xe10cd3,this['y']+_0x23ae54,_0x16cff5)){this['queue']['splice'](0x0,0x0,this['callbackWait']);}else{this['waitingTime']=0x0;this['x']+=_0xe10cd3;this['y']+=_0x23ae54;this['enterNewTile']();if(!this['tile']['inside'](this['x'],this['y'])){error('Vehicle\x20has\x20left\x20its\x20tile',this,this['disable']);}this['updateSprite'](this['x'],this['y'],_0x16cff5);}}if(this['waitingTime']>config['Vehicle']['waitForever']&&this['collisionWith']!==null){if(this['collisionWith']['collidingWith'](this)){error('Vehicle\x20is\x20in\x20a\x20collision\x20loop',this,this['disable']);}}}['enterNewTile'](){if(this['tile']['inside'](this['x'],this['y'])){return;}for(var _0x2a0684 of this['tile']['neighbours']){if(_0x2a0684['inside'](this['x'],this['y'])){if(this['getHead']()===convertInt(this['tile']['getNeighbourConnection'](_0x2a0684))){this['laneAssist']();if(this['tile']['inside'](this['x'],this['y'])){return;}}if(this['isInFront'](_0x2a0684,this['x'],this['y'],this['head'])){this['oldTile']=this['tile']['hash'];this['tile']['removeVehicle'](this);this['tile']=_0x2a0684;this['tile']['addVehicle'](this);this['plannedHead']=null;this['parkNow']();return;}}}}['getHead'](){if(this['cachedHead']!==this['head']){this['cachedHead']=this['head'];this['cachedClosestHead']=this['getClosestHead'](this['head'],![]);}return this['cachedClosestHead'];}['getNextHead'](_0x465386){var _0x1b314d=config['Vehicle']['headingOrder']['indexOf'](this['getHead']())+_0x465386;if(_0x1b314d<0x0){_0x1b314d+=config['Vehicle']['headingOrder']['length'];}else if(_0x1b314d>=config['Vehicle']['headingOrder']['length']){_0x1b314d-=config['Vehicle']['headingOrder']['length'];}return config['Vehicle']['headingOrder'][_0x1b314d];}['getClosestHead'](_0x5f3be8,_0x50c8d5){if(_0x5f3be8<0x0||0x168<=_0x5f3be8){error('Heading\x20out\x20of\x20range',this,this['disable']);return null;}var _0x5ce7ce=config['Vehicle']['headingOrder']['slice'](0x0);if(_0x50c8d5){_0x5ce7ce['sort'](function(_0x40ef88,_0x146383){return _0x40ef88-_0x146383;});for(var _0x263b35=0x0;_0x263b35<_0x5ce7ce['length']-0x1;_0x263b35++){if(_0x5ce7ce[_0x263b35]<=_0x5f3be8&&_0x5f3be8<_0x5ce7ce[_0x263b35+0x1]){return _0x5ce7ce[_0x263b35];}}return _0x5ce7ce['reverse']()[0x0];}else{if(_0x5f3be8>0x12c){_0x5ce7ce[config['Vehicle']['headingOrder']['indexOf'](0x0)]=0x168;}var _0x50d98d=_0x5ce7ce['reduce'](function(_0x4753df,_0x22af0d){if(Math['abs'](_0x4753df-_0x5f3be8)<Math['abs'](_0x22af0d-_0x5f3be8)){return _0x4753df;}return _0x22af0d;});if(_0x50d98d===0x168){return 0x0;}return _0x50d98d;}}['getTurnPath'](_0x595939){var _0x2207b1=new Point(this['x'],this['y']);var _0x226b55=this['tile']['getLaneTargetPoint'](_0x595939,config['Street']['laneDrive'],config['Street']['lanePointFactor']);var _0x34ff72=getCurve(_0x2207b1,_0x226b55,this['getHead'](),_0x595939,config['Street']['bezierFactor']);return _0x34ff72['getPath'](config['Vehicle']['velocityTurn']/config['World']['stepsPerSecond']);}['laneAssist'](){var _0x2f421f=this['tile']['getClosestPointInLane'](this['x'],this['y'],this['getHead'](),config['Street']['laneDrive']);this['x']=_0x2f421f['x'];this['y']=_0x2f421f['y'];}['isInFront'](_0x2bdbb2,_0x3ff9ba,_0xa7a931,_0x1cfb76){var _0xd66d63=_0x2bdbb2['x']-_0x3ff9ba;var _0x44a1e1=_0x2bdbb2['y']-_0xa7a931;var _0xd2a0b9=this['getHeadFromDxDy'](_0xd66d63,_0x44a1e1);if(_0x1cfb76+0x3c<_0xd2a0b9&&_0xd2a0b9<_0x1cfb76+0x12c||_0x1cfb76+0x3c<_0xd2a0b9+0x168&&_0xd2a0b9+0x168<_0x1cfb76+0x12c){return![];}return!![];}['getHeadFromDxDy'](_0x2b4bbf,_0x1e3efc){var _0x2dcdfa=Math['atan2'](_0x2b4bbf,-_0x1e3efc)*0xb4/Math['PI'];if(_0x2dcdfa<0x0){_0x2dcdfa+=0x168;}return _0x2dcdfa;}['getMaxDistancePerStep'](){return Math['ceil'](this['v']/config['World']['stepsPerSecond']);}['collidingWith'](_0x4a39ec){if(this['collisionWith']===null){return![];}return this['collisionWith']['equals'](_0x4a39ec);}['collision'](_0x2940c0,_0x44d20a,_0x511927){var _0x2b2365=null;for(_0x2b2365 of this['tile']['vehicles']){if(this['collideWith'](_0x2b2365,_0x2940c0,_0x44d20a,_0x511927)){this['collisionWith']=_0x2b2365;return!![];}}for(var _0x18aa93 of this['tile']['neighbours']){for(_0x2b2365 of _0x18aa93['vehicles']){if(this['collideWith'](_0x2b2365,_0x2940c0,_0x44d20a,_0x511927)){this['collisionWith']=_0x2b2365;return!![];}}}this['collisionWith']=null;return![];}['collideWith'](_0x49342e,_0x11d7db,_0x1401ce,_0x2d45ad){if(this['equals'](_0x49342e)){return![];}if(_0x49342e['error']){return![];}if(!this['closeTo'](_0x49342e,_0x11d7db,_0x1401ce)){return![];}if(_0x49342e['isParking']()){return![];}if(!this['isInFront'](_0x49342e,_0x11d7db,_0x1401ce,_0x2d45ad)){return![];}for(var _0x25e796=0x4;_0x25e796<0xd;_0x25e796++){if(_0x49342e['getNextHead'](_0x25e796)===_0x2d45ad){return![];}}var _0x5f356b=_0x49342e['x']-_0x11d7db;var _0x1730a5=_0x49342e['y']-_0x1401ce;var _0x25dd56=_0x49342e['getBounds']()['points'];for(var _0x3be25d of _0x25dd56){if(this['bounds'][_0x2d45ad]['contains'](_0x3be25d['x']+_0x5f356b,_0x3be25d['y']+_0x1730a5)){return!![];}}return![];}['parkNow'](){}['callbackProceedToTargetLane'](_0x1b19b8,_0x1c1eb5){if(_0x1b19b8===null){_0x1b19b8=this['plannedHead'];}this['v']=config['Vehicle']['velocityTurn'];var _0x3ede39=this['tile']['getDistanceToLane'](this['x'],this['y'],_0x1b19b8,_0x1c1eb5);if(_0x3ede39<this['getMaxDistancePerStep']()){if(this['collision'](this['x'],this['y'],_0x1b19b8)){this['v']=0x0;return![];}this['head']=_0x1b19b8;return!![];}return![];}['callbackDrive'](){if(this['queue']['length']!==0x1){error('Callback\x20queue\x20corrupted',this,this['disable']);return!![];}if(this['tile']['isHighway']()||this['tile']['isGrass']()){this['v']=config['Vehicle']['velocityHighway'];}else{this['v']=config['Vehicle']['velocityCity'];}if(this['tile']['hasStop']()&&this['isOnStraight']()&&this['tile']['inside'](this['x'],this['y'],config['Vehicle']['centerSizeFactor'])){this['queue']['push'](this['callbackAtStop']);return!![];}if(this['tile']['isDeadEndOrJunctionOrCrossing']()){if(!(this['isOnNonIntersectingWay']()&&this['tile']['onlySameVehicleType']())){var _0x26b524=this['tile']['getVehicleIndex'](this);for(var _0x26f018=0x0;_0x26f018<_0x26b524;_0x26f018++){if(!this['tile']['vehicles'][_0x26f018]['isParking']()&&this['tile']['vehicles'][_0x26f018]['waitingTime']<=config['Vehicle']['waitBlocked']){this['v']=0x0;this['waitingTime']=0x0;return![];}}}}if(this['plannedHead']===null){if(!this['isOnStraight']()&&this['tile']['nearCenter'](this['x'],this['y'])){this['plannedHead']=this['getNextTurn']();if(this['plannedHead']===null){return!![];}if(this['plannedHead']===this['getHead']()){this['queue']['push'](this['callbackDrive']);}else{this['queue']['push'](this['callbackTurn']);this['queue']['push'](function(){return this['callbackProceedToTargetLane'](null,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);}return!![];}}return![];}['callbackWait'](){return!![];}['callbackTurn'](){this['v']=0.01;var _0x4ad58e=this['tile']['getDistanceToLane'](this['x'],this['y'],this['plannedHead'],config['Street']['laneDrive']);if(_0x4ad58e<this['getMaxDistancePerStep']()){this['turnPath']=null;return!![];}if(this['turnPath']===null){this['turnPath']=this['getTurnPath'](this['plannedHead']);}var _0x4aabb3=this['turnPath'][0x0]['head'];var _0x48f741=this['turnPath'][0x0]['x'];var _0x5b3b26=this['turnPath'][0x0]['y'];var _0x590b27=this['getClosestHead'](_0x4aabb3,!![]);if(this['collision'](_0x48f741,_0x5b3b26,_0x590b27)){this['v']=0x0;return![];}this['head']=_0x4aabb3;this['x']=_0x48f741;this['y']=_0x5b3b26;this['turnPath']['splice'](0x0,0x1);if(this['turnPath']['length']===0x0){this['turnPath']=null;return!![];}return![];}};class Car extends Vehicle{constructor(..._0x5799c7){super(..._0x5799c7);this['driver']=new CarDriver();}['isTram'](){return![];}['setCursor'](){}['start'](){var _0x3f893a=this['getHead']();var _0xe41504=this['tile']['getLane'](_0x3f893a,config['Street']['lanePark']);this['startXY'](_0x3f893a,_0xe41504);this['queue']=[this['callbackPark']];}['getNextTurn'](){var _0x37647b=this['tile']['getStreetConnections']()['slice'](0x0);if(!this['tile']['isDeadEnd']()){var _0x45dcbf=this['tile']['streetNeighbours']['map'](_0x24a055=>_0x24a055['hash']);if(_0x45dcbf['includes'](this['oldTile'])){var _0x4876a4=this['tile']['neighbourConnections'][this['oldTile']];if(_0x37647b['includes'](_0x4876a4)){_0x37647b['splice'](_0x37647b['indexOf'](_0x4876a4),0x1);}}}if(_0x37647b['length']===0x0){error('Empty\x20connection\x20list',this,this['disable']);return null;}var _0x2f2c84=this['tile']['getVehicleIndex'](this);for(var _0x7791b7=0x0;_0x7791b7<_0x2f2c84;_0x7791b7++){var _0x363ac6=this['tile']['vehicles'][_0x7791b7];if(_0x363ac6['waitingTime']>config['Vehicle']['waitBlocked']&&_0x37647b['length']>0x1){if(_0x37647b['includes'](_0x363ac6['getHead']())){_0x37647b['splice'](_0x37647b['indexOf'](_0x363ac6['getHead']()),0x1);}else if(_0x37647b['includes'](_0x363ac6['plannedHead'])){_0x37647b['splice'](_0x37647b['indexOf'](_0x363ac6['plannedHead']),0x1);}}}return this['driver']['decideTurn'](_0x37647b);}['parkNow'](){if(this['queue'][0x0]===this['callbackDrive']&&this['driver']['parkNow']()&&this['tile']['hasFreeParkingLot'](this['getHead']())){this['queue']=[this['callbackEnterParkingLot']];}}['isOnStraight'](){return this['tile']['isStraight']();}['isOnNonIntersectingWay'](){return this['tile']['isStraight']()||this['tile']['isCurve']();}['isParking'](){return convertInt(this['v'])===0x0&&[this['callbackPark'],this['callbackLeaveParkingLot']]['includes'](this['queue'][0x0]);}['callbackEnterParkingLot'](){this['queue']['push'](function(){return this['callbackChangeLane'](0x1);});this['queue']['push'](function(){var _0x340b48=this['getNextHead'](-0x2);return this['callbackProceedToTargetLane'](_0x340b48,config['Street']['lanePark']);});this['queue']['push'](this['callbackPark']);return!![];}['callbackPark'](){this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveParkingLot']()){this['queue']['push'](this['callbackLeaveParkingLot']);return!![];}return![];}['callbackLeaveParkingLot'](){if(!this['tile']['onlySameVehicleType']()){return![];}for(var _0x468fd9 of this['tile']['vehicles']){if(!this['equals'](_0x468fd9)&&!_0x468fd9['isParking']()&&_0x468fd9['getHead']()===this['getHead']()){return![];}}this['queue']['push'](function(){return this['callbackChangeLane'](-0x1);});this['queue']['push'](function(){var _0x525ce6=this['getNextHead'](0x2);return this['callbackProceedToTargetLane'](_0x525ce6,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);return!![];}['callbackChangeLane'](_0x2d7cf5){this['head']=this['getNextHead'](0x2*_0x2d7cf5);return!![];}['callbackAtStop'](){this['queue']['push'](this['callbackDrive']);return!![];}};class Tram extends Vehicle{constructor(_0x40473a,_0x18bf28,_0x25288e,_0x8c117e,_0x137a60){super(_0x40473a,_0x18bf28,_0x25288e,_0x8c117e);this['driver']=new TramDriver(_0x137a60);}['isTram'](){return!![];}['setCursor'](){if(this['sprite']!==null){this['sprite']['inputEnabled']=!![];this['sprite']['events']['onInputOver']['add'](function(){UI['setCursorInfo']();});this['sprite']['events']['onInputOut']['add'](function(){UI['unsetCursorInfo']();});}}['start'](){var _0x44791d=this['getHead']();var _0x49f09f=this['tile']['getLane'](_0x44791d,config['Street']['laneDrive']);this['startXY'](_0x44791d,_0x49f09f);this['queue']=[this['callbackDrive']];}['getNextTurn'](){var _0x289a97=this['driver']['decideTurn'](this['tile']);if(_0x289a97===null){error('Tram\x20does\x20not\x20find\x20a\x20way',this,this['disable']);return null;}return _0x289a97;}['isOnStraight'](){return this['tile']['isStraightTrack']();}['isOnNonIntersectingWay'](){return this['tile']['isNonIntersectingTrack']();}['isParking'](){return![];}['callbackAtStop'](){if(this['tile']['equals'](this['lastStop'])){this['queue']['push'](this['callbackDrive']);return!![];}this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveStop']()){this['lastStop']=this['tile'];this['queue']['push'](this['callbackDrive']);return!![];}return![];}};class UI{static['disableSpinner'](){document['getElementById']('spinner')['style']['display']='none';}static['buttonNewTrack'](_0x340170,_0x44bd0f){if(_0x340170){document['getElementById']('button-track')['classList']['remove']('button-disabled');}else{document['getElementById']('button-track')['classList']['add']('button-disabled');}if(_0x44bd0f){document['getElementById']('button-track')['classList']['add']('button-active');}else{document['getElementById']('button-track')['classList']['remove']('button-active');}}static['buttonNewStop'](_0x47c357,_0x370b1e){if(_0x47c357){document['getElementById']('button-stop')['classList']['remove']('button-disabled');}else{document['getElementById']('button-stop')['classList']['add']('button-disabled');}if(_0x370b1e){document['getElementById']('button-stop')['classList']['add']('button-active');}else{document['getElementById']('button-stop')['classList']['remove']('button-active');}}static['buttonNewTram'](_0x566daf,_0x131826){if(_0x566daf){document['getElementById']('button-tram')['classList']['remove']('button-disabled');}else{document['getElementById']('button-tram')['classList']['add']('button-disabled');}if(_0x131826){document['getElementById']('button-tram')['classList']['add']('button-active');}else{document['getElementById']('button-tram')['classList']['remove']('button-active');}}static['buttonAbort'](_0x43b689){if(_0x43b689){document['getElementById']('button-abort')['classList']['remove']('button-disabled');}else{document['getElementById']('button-abort')['classList']['add']('button-disabled');}}static['buttonFinish'](_0x476337){if(_0x476337){document['getElementById']('button-finish')['classList']['remove']('button-disabled');}else{document['getElementById']('button-finish')['classList']['add']('button-disabled');}}static['setCursorDefault'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorOk'](){document['getElementById']('canvas')['classList']['add']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorNok'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['add']('nok');}static['setCursorInfo'](){if(state['isClickable']()){document['getElementById']('canvas')['classList']['add']('info');}}static['unsetCursorInfo'](){document['getElementById']('canvas')['classList']['remove']('info');}};class State{['abort'](_0x4c6248){}['finish'](_0x2092ff){}['click'](_0x38bffa,_0x4329df,_0x1112c9){return this;}['hover'](_0x9e0230,_0x41fccf,_0x56b253){}['isClickable'](){return![];}};class StateDefault extends State{static['change'](){return new StateDefault();}['setButtons'](){UI['buttonNewTrack'](!![],![]);UI['buttonNewStop'](!![],![]);UI['buttonNewTram'](!![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](![]);}['setCursor'](){UI['setCursorDefault']();}['click'](_0x4d013f,_0xa14b26,_0xcec45c){if(_0xcec45c['showTramClick'](_0x4d013f-game['camera']['x'],_0xa14b26-game['camera']['y'])){return StateTramInfo['change']();}return this;}['isClickable'](){return!![];}};class StateNewTrack extends State{static['change'](){return new StateNewTrack();}['setButtons'](){UI['buttonNewTrack'](!![],!![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x1b03fd){_0x1b03fd['newTrackAbort']();}['finish'](_0x299936){_0x299936['newTrackFinalize']();}['click'](_0x27caf1,_0x171f0b,_0x35caf2){_0x35caf2['newTrackClick'](_0x27caf1,_0x171f0b,![]);return this;}['hover'](_0x3e01d2,_0xdec64c,_0x5458ac){if(_0x5458ac['newTrackClick'](_0x3e01d2,_0xdec64c,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewStop extends State{static['change'](){return new StateNewStop();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](!![],!![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['click'](_0x8b04d1,_0x260115,_0x528133){_0x528133['newStopClick'](_0x8b04d1,_0x260115,![]);return this;}['hover'](_0x4830e1,_0x3258e2,_0x195dbd){if(_0x195dbd['newStopClick'](_0x4830e1,_0x3258e2,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewTram extends State{static['change'](){return new StateNewTram();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](!![],!![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x364edd){_0x364edd['newTramAbort']();}['finish'](_0x3dd18e){this['abort'](_0x3dd18e);}['click'](_0x26bf7f,_0x304540,_0x5eb47c){_0x5eb47c['newTramClick'](_0x26bf7f,_0x304540,![],loader['trams']);return this;}['hover'](_0x331123,_0x30a5ad,_0x664347){if(_0x664347['newTramClick'](_0x331123,_0x30a5ad,!![],loader['trams'])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateTramInfo extends State{static['change'](){return new StateTramInfo();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorDefault']();}['abort'](_0x4df1b9){_0x4df1b9['removeSelectedTram']();}['finish'](_0x554d61){_0x554d61['showTramClick'](-0x1,-0x1);}['click'](_0x2c5d10,_0x173741,_0x477a6c){return StateDefault['change']()['click'](_0x2c5d10,_0x173741,_0x477a6c);}['isClickable'](){return!![];}};var game=new Phaser['Game']('100','100',Phaser['CANVAS'],'canvas',{'preload':preload,'create':create,'update':update});var loader=new Loader();var map=new Map();var state=StateDefault['change']();var config;var cursors;var mouseDown=![];var disableUI=!![];function loadConfig(_0x1d0a35,_0x42e019,_0x53fdd2,_0x1ea61a,_0x2c7ba9){if(_0x42e019==='config'){config=game['cache']['getJSON']('config');loader['load']();}}function step(){map['update']();}function preload(){game['load']['onFileComplete']['add'](loadConfig,this);game['load']['text']('world','city/world.dat');game['load']['text']('tracks','city/tracks.dat');game['load']['text']('stops','city/stops.dat');game['load']['text']('trams','city/trams.dat');game['load']['json']('config','city/config.json');}function updateUI(){state['setButtons']();state['setCursor']();}function create(){cursors=game['input']['keyboard']['createCursorKeys']();game['kineticScrolling']=game['plugins']['add'](Phaser['Plugin']['KineticScrolling']);game['kineticScrolling']['configure']({'kineticMovement':!![],'timeConstantScroll':0x3e8,'horizontalScroll':!![],'verticalScroll':!![],'horizontalWheel':![],'verticalWheel':![]});game['kineticScrolling']['start']();game['stage']['backgroundColor']=config['Street']['color'];map['loadMap'](game['cache']['getText']('world'));map['initTiles']();map['loadTracks'](game['cache']['getText']('tracks'));map['loadStops'](game['cache']['getText']('stops'));map['generateItems'](loader['houses'],loader['trees'],loader['cars']);map['loadTrams'](game['cache']['getText']('trams'),loader['trams']);game['world']['resize'](map['getWidth'](),map['getHeight']());map['draw']();var _0x3204b2=0x1/config['World']['stepsPerSecond'];game['time']['events']['loop'](_0x3204b2,step);var _0x3914c5=Math['max'](0x1,window['devicePixelRatio']*0.6);game['camera']['scale']['setTo'](_0x3914c5,_0x3914c5);if(disableUI){document['getElementById']('button-track')['style']['display']='none';document['getElementById']('button-stop')['style']['display']='none';document['getElementById']('button-tram')['style']['display']='none';document['getElementById']('button-abort')['style']['display']='none';document['getElementById']('button-finish')['style']['display']='none';}else{document['getElementById']('button-track')['addEventListener']('click',onButtonTrack);document['getElementById']('button-stop')['addEventListener']('click',onButtonStop);document['getElementById']('button-tram')['addEventListener']('click',onButtonTram);document['getElementById']('button-abort')['addEventListener']('click',onButtonAbort);document['getElementById']('button-finish')['addEventListener']('click',onButtonFinish);}UI['disableSpinner']();updateUI();}function onButtonTrack(){state=StateNewTrack['change']();updateUI();}function onButtonStop(){state=StateNewStop['change']();updateUI();}function onButtonTram(){state=StateNewTram['change']();updateUI();}function onTramInfo(){state=StateTramInfo['change']();updateUI();}function onButtonAbort(){state['abort'](map);state=StateDefault['change']();updateUI();}function onButtonFinish(){state['finish'](map);state=StateDefault['change']();updateUI();}function update(){if(cursors['up']['isDown']){game['camera']['y']-=0x14;}else if(cursors['down']['isDown']){game['camera']['y']+=0x14;}if(cursors['left']['isDown']){game['camera']['x']-=0x14;}else if(cursors['right']['isDown']){game['camera']['x']+=0x14;}if(!disableUI){if(game['input']['mousePointer']['leftButton']['isDown']){mouseDown=!![];}if(game['input']['mousePointer']['leftButton']['isUp']&&mouseDown){mouseDown=![];state=state['click'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);updateUI();}else{state['hover'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);}}}