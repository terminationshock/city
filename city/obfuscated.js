'use strict';function error(_0x4be2a7,_0x7902f1,_0x22ce49){console['error'](_0x4be2a7);if(_0x22ce49===null){throw new Error(_0x4be2a7);}else{_0x22ce49['call'](_0x7902f1);}}function convertInt(_0x4b0a21){return parseInt(_0x4b0a21,0xa);}function getPermutations(_0x127bb8,_0x407d46){var _0x1d4f33=[];for(var _0x3c7dcc=0x0;_0x3c7dcc<_0x407d46;_0x3c7dcc++){var _0x3a6426=Math['floor'](_0x127bb8['length']*_0x3c7dcc/_0x407d46);var _0x10064c=_0x127bb8['slice'](_0x3a6426);var _0x52ebd8=_0x127bb8['slice'](0x0,_0x3a6426);_0x1d4f33['push'](_0x10064c['concat'](_0x52ebd8));}return _0x1d4f33;}function normalizeAngle(_0x39ae28){if(_0x39ae28>=0x168){_0x39ae28-=0x168;}return _0x39ae28;}function generateRandomId(){var _0x7d0892='';_0x7d0892+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x7d0892+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x7d0892+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);return _0x7d0892;}function getTurnDirection(_0x59d39f,_0x36d831){if(0x0<_0x36d831-_0x59d39f&&_0x36d831-_0x59d39f<0xb4){return 0x1;}else if(-0xb4<=_0x36d831-_0x59d39f&&_0x36d831-_0x59d39f<0x0){return-0x1;}else if(_0x36d831-_0x59d39f>=0xb4){return-0x1;}else if(-0xb4>_0x36d831-_0x59d39f){return 0x1;}return 0x0;}function getDeltaHead(_0x77c6c6,_0x5ec01d){var _0xe13cb=getTurnDirection(_0x77c6c6,_0x5ec01d);var _0x1855dd=0x0;if(_0xe13cb<0x0){if(_0x5ec01d>_0x77c6c6){_0x1855dd=_0x77c6c6-(_0x5ec01d-0x168);}else{_0x1855dd=_0x77c6c6-_0x5ec01d;}}else if(_0xe13cb>0x0){if(_0x5ec01d<_0x77c6c6){_0x1855dd=_0x5ec01d+0x168-_0x77c6c6;}else{_0x1855dd=_0x5ec01d-_0x77c6c6;}}return _0x1855dd;}function getCurve(_0x59021,_0x4cc6e0,_0x3d197f,_0x401aeb,_0x7ee9ea){var _0x16a1fc=Math['sin'](_0x3d197f*Math['PI']/0xb4);var _0x4c6fff=-Math['cos'](_0x3d197f*Math['PI']/0xb4);var _0x58247b=Math['sin'](_0x401aeb*Math['PI']/0xb4);var _0x2581a7=-Math['cos'](_0x401aeb*Math['PI']/0xb4);var _0x3d297c=getDeltaHead(_0x3d197f,_0x401aeb);var _0x7ee9ea=_0x7ee9ea*_0x3d297c;if(_0x3d297c===0x0){return new BezierCurve([_0x59021,_0x4cc6e0]);}return new BezierCurve([_0x59021,new Point(_0x59021['x']+_0x7ee9ea*_0x16a1fc,_0x59021['y']+_0x7ee9ea*_0x4c6fff),new Point(_0x4cc6e0['x']-_0x7ee9ea*_0x58247b,_0x4cc6e0['y']-_0x7ee9ea*_0x2581a7),_0x4cc6e0]);}function linesAreEqual(_0x5b08cc,_0x23c665){if(_0x5b08cc['length']!==_0x23c665['length']){return![];}for(var _0x2b81d3=0x0;_0x2b81d3<_0x5b08cc['length'];_0x2b81d3++){if(_0x5b08cc[_0x2b81d3]['start']['x']!==_0x23c665[_0x2b81d3]['start']['x']||_0x5b08cc[_0x2b81d3]['start']['y']!==_0x23c665[_0x2b81d3]['start']['y']){return![];}if(_0x5b08cc[_0x2b81d3]['end']['x']!==_0x23c665[_0x2b81d3]['end']['x']||_0x5b08cc[_0x2b81d3]['end']['y']!==_0x23c665[_0x2b81d3]['end']['y']){return![];}}return!![];}class Point{constructor(_0x2d1c80,_0x1ab858){this['x']=_0x2d1c80;this['y']=_0x1ab858;}['equals'](_0x321b19,_0x26c156){return this['x']===_0x321b19&&this['y']===_0x26c156;}};class Loader{['load'](){this['streets']=['g0000','r0001','r0005','r0009','r0013','r0017','r0021','r0045','r0049','r0053','r0057','r0061','r0065','r0069','r0073','r0077','r0081','r0085'];this['houses']=['h0001','h0005','h0009','h0013','h0017','h0021','h0025','h0029','h0033','h0037','h0041','h0045','h0049','h0053','h0057','h0061','h0065','h0069','h0073','h0077','h0081','h0085','h0089','h0093','h0097','h0101','h0105','h0109','h0113','h0117','h0121','h0125','h0129','h0133','h0137','h0141','h0145','h0149','h0153','h0157','h0161','h0165','h0169','h0173','h0177','h0181','h0185','h0189','h0193','h0197','h0201','h0205','h0209','h0213','h0217','h0221','h0225','h0229','h0233','h0237','h0241','h0245','h0249','h0253'];this['trees']=['t01','t02','t03','t04','t05','t06','t07','t08','t09','t10','t11'];this['cars']=['v01','v02','v03','v04','v05','v06','v07','v08','v09','v10','v11','v12'];this['trams']=['v00'];this['streets']['forEach'](function(_0x5e69e5){game['load']['image'](_0x5e69e5,'city/img/'+_0x5e69e5+'.png');});this['houses']['forEach'](function(_0x2203a4){game['load']['image'](_0x2203a4,'city/img/'+_0x2203a4+'.png');});this['trees']['forEach'](function(_0x244ef9){game['load']['image'](_0x244ef9,'city/img/'+_0x244ef9+'.png');});this['cars']['forEach'](function(_0x53dc42){game['load']['spritesheet'](_0x53dc42,'city/img/'+_0x53dc42+'.png',config['Car']['imgSize'],config['Car']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Car']['numTypes']);});this['trams']['forEach'](function(_0x5aa7dc){game['load']['spritesheet'](_0x5aa7dc,'city/img/'+_0x5aa7dc+'.png',config['Tram']['imgSize'],config['Tram']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Tram']['numTypes']);});}};class Trees{constructor(_0x119316,_0x50a48d){this['tile']=_0x119316;this['treeImages']=_0x50a48d;this['trees']=[];this['sprites']=[];}['generateTrees'](){for(var _0x2652e9=0x0;_0x2652e9<config['Tree']['numTrees'];_0x2652e9++){var _0x19316b=this['newTree']();if(_0x19316b!==null){this['trees']['push'](_0x19316b);}}this['trees']['sort'](function(_0x36cd43,_0x5ef9e6){return _0x36cd43['y']-_0x5ef9e6['y'];});}['newTree'](){var _0x42eea8=this['treeImages'][Math['floor'](Math['random']()*this['treeImages']['length'])];var _0x13b8b4=game['cache']['getImage'](_0x42eea8);var _0x46fe4f=this['tile']['imgX']+Math['floor'](Math['random']()*(config['Tile']['width']-_0x13b8b4['width']));var _0x26e709=this['tile']['imgY']+Math['floor'](Math['random']()*config['Tile']['height'])-_0x13b8b4['height'];var _0x212603=_0x46fe4f+Math['floor'](_0x13b8b4['width']/0x2);var _0x35ee5a=_0x26e709+_0x13b8b4['height'];if(this['tile']['inside'](_0x212603,_0x35ee5a,config['Tree']['insideFactor'])){return{'y':_0x35ee5a,'tree':_0x42eea8,'imgX':_0x46fe4f,'imgY':_0x26e709};}return null;}['draw'](_0x5de8af){for(var _0x2ad032 of this['trees']){this['sprites']['push'](game['add']['image'](_0x2ad032['imgX'],_0x2ad032['imgY'],_0x2ad032['tree']));}this['sprites']['forEach'](_0x90ffd7=>_0x5de8af['add'](_0x90ffd7));}['remove'](){this['sprites']['forEach'](_0x55d017=>_0x55d017['destroy']());}};class Tracks{constructor(_0x29a05b){this['tile']=_0x29a05b;this['track']={};this['newTrack']={};this['trackPoints']=null;this['headsFrom']=[];this['headsTo']=[];this['lineSegments']=[];}['generate'](_0x52c057){if(this['tile']['isHouse']()){return;}this['newTrack']={};if(_0x52c057['length']===0x1&&_0x52c057[0x0]===this['tile']['hash']){this['newTrack'][0x3c]=[0xf0];this['newTrack'][0x78]=[0x12c];this['newTrack'][0xf0]=[0x3c];this['newTrack'][0x12c]=[0x78];return;}var _0x423ca4=[];var _0x45656d=_0x52c057['indexOf'](this['tile']['hash']);while(_0x45656d!=-0x1){_0x423ca4['push'](_0x45656d);_0x45656d=_0x52c057['indexOf'](this['tile']['hash'],_0x45656d+0x1);}for(_0x45656d of _0x423ca4){var _0x199a9a=_0x45656d+0x1;var _0xce53fb=_0x45656d-0x1;if(_0x199a9a===_0x52c057['length']){_0x199a9a=0x0;}if(_0xce53fb===-0x1){_0xce53fb=_0x52c057['length']-0x1;}var _0xb7d66f=null;var _0x5d4777=null;if(_0x52c057[_0xce53fb]in this['tile']['neighbourConnections']&&_0x52c057[_0x199a9a]in this['tile']['neighbourConnections']){_0xb7d66f=this['tile']['neighbourConnections'][_0x52c057[_0xce53fb]];_0x5d4777=this['tile']['neighbourConnections'][_0x52c057[_0x199a9a]];}else if(_0x52c057[_0xce53fb]in this['tile']['neighbourConnections']){_0xb7d66f=this['tile']['neighbourConnections'][_0x52c057[_0xce53fb]];_0x5d4777=normalizeAngle(_0xb7d66f+0xb4);}else if(_0x52c057[_0x199a9a]in this['tile']['neighbourConnections']){_0x5d4777=this['tile']['neighbourConnections'][_0x52c057[_0x199a9a]];_0xb7d66f=normalizeAngle(_0x5d4777+0xb4);}if(_0x5d4777!==null){if(_0xb7d66f in this['newTrack']){this['newTrack'][_0xb7d66f]['push'](_0x5d4777);}else{this['newTrack'][_0xb7d66f]=[_0x5d4777];}}}}['finalize'](){var _0x575f5c=null;for(var _0x305d66 in this['newTrack']){if(_0x305d66 in this['track']){for(_0x575f5c=0x0;_0x575f5c<this['newTrack'][_0x305d66]['length'];_0x575f5c++){this['track'][_0x305d66]['push'](this['newTrack'][_0x305d66][_0x575f5c]);}}else{this['track'][_0x305d66]=this['newTrack'][_0x305d66];}}for(var _0x2a941c in this['track']){var _0x1bdb58=[];for(_0x575f5c=0x0;_0x575f5c<this['track'][_0x2a941c]['length'];_0x575f5c++){if(!_0x1bdb58['includes'](this['track'][_0x2a941c][_0x575f5c])){_0x1bdb58['push'](this['track'][_0x2a941c][_0x575f5c]);}}this['track'][_0x2a941c]=_0x1bdb58;}this['headsFrom']=Object['keys'](this['track']);this['headsTo']=Object['values'](this['track']);this['newTrack']={};this['lineSegments']=[];for(var _0x2cde81 in this['track']){var _0x2a941c=normalizeAngle(convertInt(_0x2cde81)+0xb4);for(var _0x2eea25 of this['track'][_0x2cde81]){var _0x32a4d=this['tile']['getLaneStartPoint'](_0x2a941c,config['Street']['laneDrive'],0x1);var _0x2e611d=this['tile']['getLaneTargetPoint'](_0x2eea25,config['Street']['laneDrive'],0.24);var _0x47ec30=[];if(getTurnDirection(_0x2a941c,_0x2eea25)===-0x1){_0x47ec30['push'](new Phaser['Line'](Math['round'](_0x32a4d['x']),Math['round'](_0x32a4d['y']),Math['round'](this['tile']['x']),Math['round'](this['tile']['y'])));_0x47ec30['push'](new Phaser['Line'](Math['round'](this['tile']['x']),Math['round'](this['tile']['y']),Math['round'](_0x2e611d['x']),Math['round'](_0x2e611d['y'])));}else{_0x47ec30['push'](new Phaser['Line'](Math['round'](_0x32a4d['x']),Math['round'](_0x32a4d['y']),Math['round'](_0x2e611d['x']),Math['round'](_0x2e611d['y'])));}this['lineSegments']['push'](_0x47ec30);}}}['abort'](){this['newTrack']={};}['addSingleTrack'](_0x58bdc4,_0x48f2e9){var _0x4035c7=normalizeAngle(convertInt(_0x58bdc4)+0xb4);for(var _0x2701e4=-0x1;_0x2701e4<=0x1;_0x2701e4+=0x2){var _0x4857b4=this['tile']['getLaneStartPoint'](_0x4035c7,config['Street']['laneDrive']+_0x2701e4*config['Track']['width']/0x2,0x1);var _0x26a2c3=this['tile']['getLaneStartPoint'](_0x4035c7,config['Street']['laneDrive']+_0x2701e4*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x165cb4=this['tile']['getLaneTargetPoint'](_0x48f2e9,config['Street']['laneDrive']+_0x2701e4*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x2ca74e=this['tile']['getLaneTargetPoint'](_0x48f2e9,config['Street']['laneDrive']+_0x2701e4*config['Track']['width']/0x2,0x1);if(_0x4035c7===_0x48f2e9){this['trackPoints']['moveTo'](_0x4857b4['x'],_0x4857b4['y']);this['trackPoints']['lineTo'](_0x2ca74e['x'],_0x2ca74e['y']);}else{var _0x1ec53e=getCurve(_0x26a2c3,_0x165cb4,_0x4035c7,_0x48f2e9,config['Track']['bezierFactor'])['getPath'](config['Track']['curveFactor']);this['trackPoints']['moveTo'](_0x4857b4['x'],_0x4857b4['y']);this['trackPoints']['lineTo'](_0x1ec53e[0x0]['x'],_0x1ec53e[0x0]['y']);for(var _0x593d72 of _0x1ec53e){this['trackPoints']['lineTo'](_0x593d72['x'],_0x593d72['y']);}this['trackPoints']['lineTo'](_0x2ca74e['x'],_0x2ca74e['y']);}}}['getRandomConnection'](){return this['headsTo'][Math['floor'](Math['random']()*this['headsTo']['length'])];}['hasTracks'](){return this['headsFrom']['length']>0x0;}['getTrackKeys'](){return Object['keys'](this['track']);}['getLineSegments'](){return this['lineSegments'];}['isNotIntersecting'](){if(this['isDeadEnd']()){return![];}if(this['tile']['linesIntersectInside'](this['lineSegments'])){return![];}return!![];}['isDeadEnd'](){for(var _0x4e679c in this['track']){for(var _0x4c6465 of this['track'][_0x4e679c]){if(_0x4c6465===convertInt(_0x4e679c)){return!![];}}}return![];}['isStraight'](){var _0x3621ab=this['headsFrom']['map'](_0x642420=>convertInt(_0x642420));if(_0x3621ab['length']>0x2){return![];}for(var _0x36553b in this['track']){if(this['track'][_0x36553b]['length']>0x1){return![];}if(normalizeAngle(convertInt(_0x36553b)+0xb4)!==convertInt(this['track'][_0x36553b])){return![];}if(_0x3621ab['length']===0x2&&!_0x3621ab['includes'](this['track'][_0x36553b][0x0])){return![];}}return!![];}['getStraights'](){if(this['isStraight']()){return Object['keys'](this['track'])['map'](_0x3c2dbb=>normalizeAngle(convertInt(_0x3c2dbb)+0xb4));}return null;}['getHeadsFrom'](_0x33d960){if(_0x33d960 in this['track']){return this['track'][_0x33d960];}return null;}['draw'](_0x2758ad){if(this['trackPoints']!==null){_0x2758ad['removeChild'](this['trackPoints']);this['trackPoints']['destroy']();}if(this['hasTracks']()||Object['keys'](this['newTrack'])['length']>0x0){this['trackPoints']=new Phaser['Graphics'](game,0x0,0x0);var _0x10abef=null;var _0x4c5eba=null;var _0x36eed0=null;this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['color']),0x1);for(_0x10abef in this['track']){_0x36eed0=this['track'][_0x10abef];for(_0x4c5eba of _0x36eed0){this['addSingleTrack'](_0x10abef,_0x4c5eba);}}this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['activeColor']),0x1);for(_0x10abef in this['newTrack']){_0x36eed0=this['newTrack'][_0x10abef];for(_0x4c5eba of _0x36eed0){this['addSingleTrack'](_0x10abef,_0x4c5eba);}}_0x2758ad['add'](this['trackPoints']);}}['highlight'](_0x2431aa,_0xbfbcd4){if(_0x2431aa===null&&_0xbfbcd4===null){for(var _0x5b9481 in this['track']){this['newTrack'][_0x5b9481]=this['track'][_0x5b9481]['slice'](0x0);}}else if(_0xbfbcd4===null){this['newTrack'][_0x2431aa]=this['track'][_0x2431aa]['slice'](0x0);}else{var _0xe0df80=[_0xbfbcd4];if(_0x2431aa in this['newTrack']){_0xe0df80=_0xe0df80['concat'](this['newTrack'][_0x2431aa]);}this['newTrack'][_0x2431aa]=_0xe0df80;}}};class TramStop{constructor(_0x44cf6b){this['tile']=_0x44cf6b;this['canvas']=null;}['draw'](_0x2f609b){if(this['canvas']!==null){_0x2f609b['removeChild'](this['canvas']);this['canvas']['destroy']();}if(_0x2f609b!==null){this['canvas']=new Phaser['Graphics'](game,this['tile']['imgX'],this['tile']['imgY']);var _0x30d201=this['tile']['getStraightTracks']();for(var _0xccabe2 of _0x30d201){var _0x209bf2=this['tile']['getClosestPointInLane'](this['tile']['x'],this['tile']['y'],_0xccabe2,config['Stop']['lane']);_0x209bf2['x']-=this['tile']['imgX'];_0x209bf2['y']-=this['tile']['imgY'];var _0x5a8b40=Math['sin'](_0xccabe2*Math['PI']/0xb4)*0x14;var _0x3ebe15=-Math['cos'](_0xccabe2*Math['PI']/0xb4)*0x14;if(_0xccabe2===0x78||_0xccabe2===0x12c){_0x209bf2['x']-=_0x5a8b40;_0x209bf2['y']-=_0x3ebe15;}_0x5a8b40=Math['sin'](_0xccabe2*Math['PI']/0xb4)*config['Stop']['length'];_0x3ebe15=-Math['cos'](_0xccabe2*Math['PI']/0xb4)*config['Stop']['length'];var _0x2794cc=Math['sin']((0xb4-_0xccabe2)*Math['PI']/0xb4)*config['Stop']['width'];var _0x21feca=-Math['cos']((0xb4-_0xccabe2)*Math['PI']/0xb4)*config['Stop']['width'];this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color1']));var _0x5bcf2f=new Phaser['Point'](_0x209bf2['x']+_0x2794cc-_0x5a8b40,_0x209bf2['y']+0x1+_0x21feca-_0x3ebe15);var _0xabf780=new Phaser['Point'](_0x209bf2['x']+_0x2794cc+_0x5a8b40,_0x209bf2['y']+0x1+_0x21feca+_0x3ebe15);var _0x2eb2c0=new Phaser['Point'](_0x209bf2['x']-_0x2794cc+_0x5a8b40,_0x209bf2['y']+0x1-_0x21feca+_0x3ebe15);var _0x33e9a8=new Phaser['Point'](_0x209bf2['x']-_0x2794cc-_0x5a8b40,_0x209bf2['y']+0x1-_0x21feca-_0x3ebe15);this['canvas']['drawPolygon']([_0x5bcf2f,_0xabf780,_0x2eb2c0,_0x33e9a8]);this['canvas']['endFill']();this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color2']));_0x5bcf2f=new Phaser['Point'](_0x209bf2['x']+_0x2794cc-_0x5a8b40,_0x209bf2['y']-0x1+_0x21feca-_0x3ebe15);_0xabf780=new Phaser['Point'](_0x209bf2['x']+_0x2794cc+_0x5a8b40,_0x209bf2['y']-0x1+_0x21feca+_0x3ebe15);_0x2eb2c0=new Phaser['Point'](_0x209bf2['x']-_0x2794cc+_0x5a8b40,_0x209bf2['y']-0x1-_0x21feca+_0x3ebe15);_0x33e9a8=new Phaser['Point'](_0x209bf2['x']-_0x2794cc-_0x5a8b40,_0x209bf2['y']-0x1-_0x21feca-_0x3ebe15);this['canvas']['drawPolygon']([_0x5bcf2f,_0xabf780,_0x2eb2c0,_0x33e9a8]);this['canvas']['endFill']();}_0x2f609b['add'](this['canvas']);}}};class TramLine{constructor(){this['NEIGHBOUR_STATUS']={'MULTIPLE_PATHS':0x0,'NO_NEIGHBOUR':0x1};this['tiles']=[];this['closed']=![];}['isEmpty'](){return this['tiles']['length']===0x0;}['isAllowed'](_0x3ff837){if(!_0x3ff837['hasTracks']()){return![];}var _0x2fbda4=this['tiles']['length'];var _0x27cf44=null;if(_0x2fbda4>0x1){_0x27cf44=this['tiles'][_0x2fbda4-0x1]['getNeighbourConnection'](this['tiles'][_0x2fbda4-0x2]);}else{_0x27cf44=_0x3ff837['getNeighbourConnection'](this['tiles'][_0x2fbda4-0x1]);}var _0x36a544=this['tiles'][_0x2fbda4-0x1]['getNeighbourConnection'](_0x3ff837);if(_0x36a544===null){return![];}var _0x52cf19=this['tiles'][_0x2fbda4-0x1]['getTrackHeadsFrom'](_0x27cf44);if(_0x52cf19===null){return![];}if(!_0x52cf19['includes'](_0x36a544)){return![];}if(_0x3ff837['getTrackHeadsFrom'](normalizeAngle(_0x36a544+0xb4))===null){return![];}return!![];}['getNextUniqueNeighbour'](){var _0x53a77c=this['tiles']['length'];var _0x580585=null;if(_0x53a77c>0x1){_0x580585=this['tiles'][_0x53a77c-0x1]['getNeighbourConnection'](this['tiles'][_0x53a77c-0x2]);}else{var _0x5ec6b4=this['tiles'][_0x53a77c-0x1]['tracks']['getTrackKeys']();if(_0x5ec6b4['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}_0x580585=_0x5ec6b4[0x0];}var _0x34ded8=this['tiles'][_0x53a77c-0x1]['getTrackHeadsFrom'](_0x580585);if(_0x34ded8===null){return this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR'];}if(_0x34ded8['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}return this['tiles'][_0x53a77c-0x1]['getNeighbourAtHead'](_0x34ded8[0x0]);}['getTiles'](){return this['tiles'];}['abort'](){this['tiles']['forEach'](_0x3f5ee5=>_0x3f5ee5['abortTrack']());this['tiles']=[];this['closed']=![];}['proceed'](_0x4a4c72){if(this['isEmpty']()){this['tiles']=[_0x4a4c72];this['tiles'][0x0]['tracks']['highlight'](null,null);var _0x58e0e8=this['getNextUniqueNeighbour']();if(_0x58e0e8!==this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){this['proceed'](_0x58e0e8);}return;}var _0x2cd095=this['tiles']['length'];this['tiles'][_0x2cd095-0x1]['abortTrack']();if(_0x2cd095>0x1){this['tiles'][_0x2cd095-0x1]['tracks']['highlight'](this['tiles'][_0x2cd095-0x1]['getNeighbourConnection'](this['tiles'][_0x2cd095-0x2]),this['tiles'][_0x2cd095-0x1]['getNeighbourConnection'](_0x4a4c72));}else{this['tiles'][_0x2cd095-0x1]['tracks']['highlight'](_0x4a4c72['getNeighbourConnection'](this['tiles'][_0x2cd095-0x1]),this['tiles'][_0x2cd095-0x1]['getNeighbourConnection'](_0x4a4c72));}this['tiles']['push'](_0x4a4c72);while(!![]){var _0x58e0e8=this['getNextUniqueNeighbour']();_0x2cd095=this['tiles']['length'];if(_0x58e0e8===this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR']||_0x58e0e8===null){this['abort']();break;}else if(_0x58e0e8===this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){if(this['isAllowed'](this['tiles'][0x0])){this['closed']=!![];}else{this['tiles'][_0x2cd095-0x1]['tracks']['highlight'](this['tiles'][_0x2cd095-0x1]['getNeighbourConnection'](this['tiles'][_0x2cd095-0x2]),null);}break;}this['tiles'][_0x2cd095-0x1]['tracks']['highlight'](this['tiles'][_0x2cd095-0x1]['getNeighbourConnection'](this['tiles'][_0x2cd095-0x2]),this['tiles'][_0x2cd095-0x1]['getNeighbourConnection'](_0x58e0e8));if(_0x58e0e8['equals'](this['tiles'][0x1])&&this['tiles'][_0x2cd095-0x1]['equals'](this['tiles'][0x0])){this['tiles']['pop']();this['closed']=!![];break;}if(this['tiles']['length']>config['Tram']['maxLineLength']){this['abort']();break;}this['tiles']['push'](_0x58e0e8);}}static['show'](_0x3ba246){for(var _0x23ca77=0x0;_0x23ca77<_0x3ba246['length'];_0x23ca77++){var _0x368515=_0x23ca77-0x1;var _0xb71738=_0x23ca77+0x1;if(_0x368515<0x0){_0x368515=_0x3ba246['length']-0x1;}if(_0xb71738>_0x3ba246['length']-0x1){_0xb71738=0x0;}_0x3ba246[_0x23ca77]['tracks']['highlight'](_0x3ba246[_0x23ca77]['getNeighbourConnection'](_0x3ba246[_0x368515]),_0x3ba246[_0x23ca77]['getNeighbourConnection'](_0x3ba246[_0xb71738]));}}}class Tile{constructor(_0x45822a,_0x3e9a2f,_0x42d7de,_0x27e7a1){this['fileId']=_0x45822a;this['hash']=_0x3e9a2f;this['imgX']=_0x42d7de;this['imgY']=_0x27e7a1;this['x']=this['imgX']+Math['floor'](config['Tile']['width']/0x2);this['y']=this['imgY']+Math['floor'](config['Tile']['height']/0x2);this['neighbours']=[];this['streetNeighbours']=[];this['neighbourConnections']={};this['lineSegments']=[];this['tracks']=new Tracks(this);this['tramstop']=null;this['hover']=null;this['trees']=null;this['vehicles']=[];this['vehicleHashes']=[];}['updateImage'](_0x2b6519){this['fileId']=_0x2b6519;var _0xd257b5=game['cache']['getImage'](this['fileId']);this['imgY']=this['imgY']+config['Tile']['height']-_0xd257b5['height'];}['draw'](_0x40c497,_0x3f3efe){if(this['isGrass']()||this['isStreet']()){_0x40c497['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}else{_0x3f3efe['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}if(this['trees']!==null){this['trees']['draw'](_0x3f3efe);}this['hover']=new Phaser['Graphics'](game,this['imgX'],this['imgY']);this['hover']['beginFill'](Phaser['Color']['hexToRGB'](config['Tile']['hoverColor']));this['hover']['fillAlpha']=0.5;this['hover']['drawPolygon'](new Phaser['Point'](config['Tile']['width']/0x2,0x0),new Phaser['Point'](config['Tile']['width'],config['Tile']['height']/0x2),new Phaser['Point'](config['Tile']['width']/0x2,config['Tile']['height']),new Phaser['Point'](0x0,config['Tile']['height']/0x2));this['hover']['endFill']();this['hover']['visible']=![];_0x40c497['add'](this['hover']);}['drawTracks'](_0x27e0c6){this['tracks']['draw'](_0x27e0c6);if(this['hasTracks']()&&this['trees']!==null){this['trees']['remove']();}}['drawVehicles'](_0x5da7c7,_0x316b78){this['vehicles']['forEach'](_0x3c3d27=>_0x3c3d27['draw'](_0x5da7c7,_0x316b78));}['drawStop'](_0x281e60){if(this['hasStop']()){this['tramstop']['draw'](_0x281e60);}}['setHover'](_0xec20d1){this['hover']['visible']=_0xec20d1;}['addStop'](){this['tramstop']=new TramStop(this);}['equals'](_0x1360f6){if(_0x1360f6===null){return![];}return this['hash']===_0x1360f6['hash'];}['equalsHash'](_0x4ca814){return this['hash']==_0x4ca814;}['update'](){this['vehicles']['forEach'](_0x2011f5=>_0x2011f5['update']());}['isGrass'](){return this['fileId']===config['Tile']['grass'];}['isStreet'](){return this['fileId']['startsWith'](config['Tile']['streetPrefix']);}['isHouse'](){return!this['isGrass']()&&!this['isStreet']();}['isStraight'](){return config['Street']['straights']['includes'](this['fileId']);}['isHighway'](){return config['Street']['highways']['includes'](this['fileId']);}['isCurve'](){return config['Street']['curves']['includes'](this['fileId']);}['isStraightOrCurve'](){return this['isStraight']()||this['isCurve']();}['isDeadEnd'](){return config['Street']['deadEnds']['includes'](this['fileId']);}['isStraightTrack'](){if(this['hasTracks']()){return this['tracks']['isStraight']();}return![];}['getStraightTracks'](){if(this['hasTracks']()){return this['tracks']['getStraights']();}return null;}['isNonIntersectingTrack'](){if(this['hasTracks']()){return this['tracks']['isNotIntersecting']();}return!![];}['isDeadEndOrJunctionOrCrossing'](){if(this['isDeadEnd']()){return!![];}if(!this['isStraightOrCurve']()&&!this['isGrass']()){return!![];}if(this['hasTracks']()){if(this['tracks']['isDeadEnd']()){return!![];}var _0x1a8fc6=this['lineSegments']['concat'](this['tracks']['getLineSegments']());if(this['linesIntersectInside'](_0x1a8fc6)){return!![];}}return![];}['linesIntersectInside'](_0x2af4f9){var _0x9fe72a=null;for(var _0x12ede1=0x0;_0x12ede1<_0x2af4f9['length'];_0x12ede1++){for(var _0x3b3d42=_0x12ede1+0x1;_0x3b3d42<_0x2af4f9['length'];_0x3b3d42++){if(!linesAreEqual(_0x2af4f9[_0x12ede1],_0x2af4f9[_0x3b3d42])){for(var _0x53b859 of _0x2af4f9[_0x12ede1]){for(var _0x4d9c8a of _0x2af4f9[_0x3b3d42]){_0x9fe72a=Phaser['Line']['intersects'](_0x53b859,_0x4d9c8a);if(_0x9fe72a!==null&&this['inside'](_0x9fe72a['x'],_0x9fe72a['y'],0.99)){return!![];}}}}}}return![];}['hasStop'](){return this['tramstop']!==null;}['hasTracks'](){return this['tracks']['hasTracks']();}['generateHouse'](_0xc828ff){if(!this['isGrass']()||this['hasTracks']()){return;}var _0x5b1604=![];for(var _0x23eb83 of this['neighbours']){if(_0x23eb83['isStreet']()&&!_0x23eb83['isHighway']()){_0x5b1604=!![];break;}}if(_0x5b1604&&Math['random']()<config['Tile']['probHouse']){var _0x1a7355=_0xc828ff[Math['floor'](Math['random']()*_0xc828ff['length'])];this['updateImage'](_0x1a7355);}}['generateTrees'](_0x52e7c7){if(this['isGrass']()&&!this['hasTracks']()){this['trees']=new Trees(this,_0x52e7c7);this['trees']['generateTrees']();}}['generateCars'](_0x1d0945){if(this['isStreet']()){var _0x351310=this['getStreetConnections']();var _0x2d377e=_0x351310[Math['floor'](Math['random']()*_0x351310['length'])];if(this['hasFreeParkingLot'](_0x2d377e)){if(Math['random']()<config['Tile']['probCar']){this['addVehicle'](new Car(this,_0x2d377e,_0x1d0945,config['Car']['numTypes'],null));}}}}['generateTrack'](_0x2f0ba6){this['tracks']['generate'](_0x2f0ba6);}['abortTrack'](){this['tracks']['abort']();}['finalizeTrack'](){this['tracks']['finalize']();if(this['hasStop']()&&!this['isStraightTrack']()){this['tramstop']['draw'](null);this['tramstop']=null;}}['getTrackHeadsFrom'](_0x183361){return this['tracks']['getHeadsFrom'](_0x183361);}['computeAllNeighbours'](_0x529673){var _0x59fb06=0xa;for(var _0x1a7c4f of _0x529673){if(!this['equals'](_0x1a7c4f)){if(this['x']+_0x59fb06<_0x1a7c4f['x']&&_0x1a7c4f['x']<this['x']+config['Tile']['width']-_0x59fb06&&this['y']-config['Tile']['height']+_0x59fb06<_0x1a7c4f['y']&&_0x1a7c4f['y']<this['y']-_0x59fb06){this['neighbours']['push'](_0x1a7c4f);}else if(this['x']+_0x59fb06<_0x1a7c4f['x']&&_0x1a7c4f['x']<this['x']+config['Tile']['width']-_0x59fb06&&this['y']+_0x59fb06<_0x1a7c4f['y']&&_0x1a7c4f['y']<this['y']+config['Tile']['height']-_0x59fb06){this['neighbours']['push'](_0x1a7c4f);}else if(this['x']-config['Tile']['width']+_0x59fb06<_0x1a7c4f['x']&&_0x1a7c4f['x']<this['x']-_0x59fb06&&this['y']+_0x59fb06<_0x1a7c4f['y']&&_0x1a7c4f['y']<this['y']+config['Tile']['height']-_0x59fb06){this['neighbours']['push'](_0x1a7c4f);}else if(this['x']-config['Tile']['width']+_0x59fb06<_0x1a7c4f['x']&&_0x1a7c4f['x']<this['x']-_0x59fb06&&this['y']-config['Tile']['height']+_0x59fb06<_0x1a7c4f['y']&&_0x1a7c4f['y']<this['y']-_0x59fb06){this['neighbours']['push'](_0x1a7c4f);}}}}['computeStreetNeighboursAndConnections'](){for(var _0xbb3457 of this['neighbours']){if(!_0xbb3457['isHouse']()){var _0x458b90=null;if(_0xbb3457['x']>this['x']&&_0xbb3457['y']<this['y']){_0x458b90=0x3c;}else if(_0xbb3457['x']>this['x']&&_0xbb3457['y']>this['y']){_0x458b90=0x78;}else if(_0xbb3457['x']<this['x']&&_0xbb3457['y']>this['y']){_0x458b90=0xf0;}else if(_0xbb3457['x']<this['x']&&_0xbb3457['y']<this['y']){_0x458b90=0x12c;}this['neighbourConnections'][_0xbb3457['hash']]=convertInt(_0x458b90);if(_0xbb3457['isStreet']()&&this['isConnectedTo'](_0x458b90)){if(!this['isStraightOrCurve']()&&!_0xbb3457['isStraightOrCurve']()){error('Cannot\x20handle\x20neighbouring\x20junctions,\x20crossings,\x20or\x20dead\x20ends.',this,null);}this['streetNeighbours']['push'](_0xbb3457);}}}}['computeLineSegments'](){var _0x5907ee=this['getStreetConnections']();if(_0x5907ee['length']===0x2){for(var _0x290173=0x0;_0x290173<0x2;_0x290173++){var _0x4d2627=normalizeAngle(_0x5907ee[_0x290173]+0xb4);var _0x5590c4=_0x5907ee[0x1-_0x290173];var _0x5ce79e=this['getLaneStartPoint'](_0x4d2627,config['Street']['laneDrive'],0x1);var _0x5a8791=this['getLaneTargetPoint'](_0x5590c4,config['Street']['laneDrive'],0.24);var _0x110ea5=[];if(getTurnDirection(_0x4d2627,_0x5590c4)===-0x1){_0x110ea5['push'](new Phaser['Line'](Math['round'](_0x5ce79e['x']),Math['round'](_0x5ce79e['y']),Math['round'](this['x']),Math['round'](this['y'])));_0x110ea5['push'](new Phaser['Line'](Math['round'](this['x']),Math['round'](this['y']),Math['round'](_0x5a8791['x']),Math['round'](_0x5a8791['y'])));}else{_0x110ea5['push'](new Phaser['Line'](Math['round'](_0x5ce79e['x']),Math['round'](_0x5ce79e['y']),Math['round'](_0x5a8791['x']),Math['round'](_0x5a8791['y'])));}this['lineSegments']['push'](_0x110ea5);}}}['getNeighbourConnection'](_0x255ae4){var _0x567bf3=_0x255ae4;if(typeof _0x255ae4!=='string'){_0x567bf3=_0x255ae4['hash'];}if(!(_0x567bf3 in this['neighbourConnections'])){return null;}return this['neighbourConnections'][_0x567bf3];}['getNeighbourAtHead'](_0x301353){var _0xec2b38=this['neighbours']['filter'](_0x5ccff8=>this['neighbourConnections'][_0x5ccff8['hash']]===_0x301353);if(_0xec2b38['length']!==0x1){return null;}return _0xec2b38[0x0];}['isTrackNeighbourOf'](_0x4800d0){return this['neighbours']['includes'](_0x4800d0)&&!_0x4800d0['isHouse']();}['isConnectedTo'](_0x5028c1){var _0x5a8556=parseInt(this['fileId']['substring'](0x1,0x5));if([0x1,0x5,0x9,0x15,0x2d,0x31,0x35,0x4d,0x55]['includes'](_0x5a8556)){if(convertInt(_0x5028c1)===0x12c){return!![];}}if([0x5,0x9,0xd,0x11,0x2d,0x35,0x39,0x41,0x51]['includes'](_0x5a8556)){if(convertInt(_0x5028c1)===0x3c){return!![];}}if([0x1,0x9,0xd,0x15,0x2d,0x39,0x3d,0x45,0x55]['includes'](_0x5a8556)){if(convertInt(_0x5028c1)===0x78){return!![];}}if([0x1,0x5,0xd,0x11,0x2d,0x31,0x3d,0x49,0x51]['includes'](_0x5a8556)){if(convertInt(_0x5028c1)===0xf0){return!![];}}return![];}['getStreetConnections'](){var _0x19869b=[0x3c,0x78,0xf0,0x12c];return _0x19869b['filter'](_0x3fc53d=>this['isConnectedTo'](_0x3fc53d));}['inside'](_0x596ecd,_0x19d9e4,_0xba0bf){_0xba0bf=typeof _0xba0bf==='undefined'?0x1:_0xba0bf;var _0x5018f4=this['x']-_0x596ecd;var _0x3ccef9=this['y']-_0x19d9e4;var _0x23061c=config['Tile']['width']/config['Tile']['height'];return Math['abs'](_0x5018f4+_0x23061c*_0x3ccef9)<_0xba0bf*config['Tile']['width']*0.5&&Math['abs'](_0x5018f4-_0x23061c*_0x3ccef9)<_0xba0bf*config['Tile']['width']*0.5;}['nearCenter'](_0x32fd96,_0x1d1173){return this['inside'](_0x32fd96,_0x1d1173,config['Street']['centerSizeFactor']);}['centerAhead'](_0x446684,_0x8d8faf){if(0x0<_0x8d8faf&&_0x8d8faf<0xb4){return _0x446684<this['x'];}return _0x446684>this['x'];}['getLane'](_0x460d8e,_0x2fa3f5){var _0x477ded=Math['cos'](_0x460d8e*Math['PI']/0xb4);var _0xe9c5a1=Math['sin'](_0x460d8e*Math['PI']/0xb4);var _0x26709b=this['x'];var _0xf923f8=this['y'];if(convertInt(_0x460d8e)===0x3c||convertInt(_0x460d8e)===0x78){_0xf923f8+=_0x2fa3f5;}else{_0xf923f8-=_0x2fa3f5;}return{'nx':_0x477ded,'ny':_0xe9c5a1,'px':_0x26709b,'py':_0xf923f8};}['getClosestPointInLane'](_0x53b27c,_0x58f78c,_0x2a5950,_0x2e1d43){var _0x295a3e=this['getLane'](_0x2a5950,_0x2e1d43);var _0x375845=_0x295a3e['nx']**0x2*_0x295a3e['px']+_0x295a3e['ny']**0x2*_0x53b27c+_0x295a3e['nx']*_0x295a3e['ny']*(_0x295a3e['py']-_0x58f78c);var _0x4ac11a=_0x295a3e['ny']**0x2*_0x295a3e['py']+_0x295a3e['nx']**0x2*_0x58f78c+_0x295a3e['nx']*_0x295a3e['ny']*(_0x295a3e['px']-_0x53b27c);return new Point(_0x375845,_0x4ac11a);}['getDistanceToLane'](_0xa50c71,_0x28ade4,_0x55fe6a,_0xdf5dcc){var _0x1205bc=this['getClosestPointInLane'](_0xa50c71,_0x28ade4,_0x55fe6a,_0xdf5dcc);return Math['sqrt']((_0xa50c71-_0x1205bc['x'])**0x2+(_0x28ade4-_0x1205bc['y'])**0x2);}['getTileBoundaryPoint'](_0x25623a,_0x26a5d1,_0x120f04,_0x39cead){var _0x1ee682=this['x'];var _0x4f2c3e=this['y'];if(convertInt(_0x120f04)===0x3c||convertInt(_0x120f04)===0x78){_0x4f2c3e+=_0x39cead;_0x26a5d1+=_0x39cead;}else{_0x4f2c3e-=_0x39cead;_0x26a5d1-=_0x39cead;}var _0x54b181=new Phaser['Line'](_0x1ee682,_0x4f2c3e,_0x25623a,_0x26a5d1);var _0x27e7b7=null;for(var _0x120f04 of[0x3c,0x78,0xf0,0x12c]){switch(_0x120f04){case 0x3c:_0x27e7b7=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0x78:_0x27e7b7=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0xf0:_0x27e7b7=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;case 0x12c:_0x27e7b7=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;}var _0xa77d6d=Phaser['Line']['intersects'](_0x54b181,_0x27e7b7);if(_0xa77d6d!==null){return _0xa77d6d;}}return null;}['getLaneTargetPoint'](_0x5b4ef2,_0x6cb42a,_0x27b170){var _0x331954=_0x27b170*config['Tile']['width'];var _0x4d607b=this['x']+Math['sin'](_0x5b4ef2*Math['PI']/0xb4)*_0x331954;var _0x3a1c75=this['y']-Math['cos'](_0x5b4ef2*Math['PI']/0xb4)*_0x331954;if(_0x27b170>=0x1){return this['getTileBoundaryPoint'](_0x4d607b,_0x3a1c75,_0x5b4ef2,_0x6cb42a);}return this['getClosestPointInLane'](_0x4d607b,_0x3a1c75,_0x5b4ef2,_0x6cb42a);}['getLaneStartPoint'](_0x5a1d83,_0x3b9e79,_0x38898c){var _0xca8d0a=_0x38898c*config['Tile']['width'];var _0x1b0b77=this['x']-Math['sin'](_0x5a1d83*Math['PI']/0xb4)*_0xca8d0a;var _0x413506=this['y']+Math['cos'](_0x5a1d83*Math['PI']/0xb4)*_0xca8d0a;if(_0x38898c>=0x1){return this['getTileBoundaryPoint'](_0x1b0b77,_0x413506,_0x5a1d83,_0x3b9e79);}return this['getClosestPointInLane'](_0x1b0b77,_0x413506,_0x5a1d83,_0x3b9e79);}['addVehicle'](_0x1d5fbb){this['vehicles']['push'](_0x1d5fbb);this['vehicleHashes']['push'](_0x1d5fbb['hash']);}['removeVehicle'](_0x476b5d){var _0x4e8681=this['vehicleHashes']['indexOf'](_0x476b5d['hash']);if(_0x4e8681>=0x0){this['vehicles']['splice'](_0x4e8681,0x1);this['vehicleHashes']['splice'](_0x4e8681,0x1);}}['clickVehicle'](_0x17cef0,_0x19cb04){for(var _0x57defa of this['vehicles']){if(_0x57defa['isTram']()&&_0x57defa['click'](_0x17cef0,_0x19cb04)){TramLine['show'](_0x57defa['getLine']());return _0x57defa;}}return null;}['getVehicleIndex'](_0x18e741){return this['vehicleHashes']['indexOf'](_0x18e741['hash']);}['onlySameVehicleType'](){if(this['vehicles']['length']>0x0){for(var _0x5c8013=0x1;_0x5c8013<this['vehicles']['length'];_0x5c8013++){if(this['vehicles'][_0x5c8013]['isTram']()!==this['vehicles'][0x0]['isTram']()){return![];}}}return!![];}['hasFreeParkingLot'](_0x40363c){if(!this['isStraight']()){return![];}if(this['isHighway']()){return![];}if(this['isDeadEndOrJunctionOrCrossing']()){return![];}if(this['hasStop']()){return![];}if(!this['isConnectedTo'](_0x40363c)){return![];}for(var _0x2b31d3 of this['vehicles']){if(_0x2b31d3['isParking']()&&_0x2b31d3['getHead']()===convertInt(_0x40363c)){return![];}}return!![];}};class Map{constructor(){this['tiles']=[];this['tileRowId']=[];this['masterGroup']=null;this['rowGroupsGround']=[];this['rowGroupsHouses']=[];this['nCols']=0x0;this['nRows']=0x0;this['newTrack']=[];this['newLine']=new TramLine();this['selectedVehicle']=null;this['tileHover']=null;}['loadMap'](_0x2edf54){var _0x55e298=_0x2edf54['trim']()['split']('\x0a');this['masterGroup']=game['add']['group']();for(var _0x5877d4=0x0;_0x5877d4<_0x55e298['length'];_0x5877d4++){if(_0x55e298[_0x5877d4]['includes'](',')){var _0xe30b02=_0x55e298[_0x5877d4]['split'](',');this['nRows']++;this['nCols']=Math['max'](this['nCols'],_0xe30b02['length']);var _0x3754dd=game['add']['group']();var _0x3c03a6=game['add']['group']();_0x3754dd['yz']=(_0x5877d4-0x1)*config['Tile']['dy'];_0x3c03a6['yz']=(_0x5877d4-0x1)*config['Tile']['dy']+config['Tile']['height'];this['rowGroupsGround']['push'](_0x3754dd);this['rowGroupsHouses']['push'](_0x3c03a6);this['masterGroup']['add'](_0x3754dd);this['masterGroup']['add'](_0x3c03a6);var _0x2feae6=-config['Tile']['dx']*(0x1-_0x5877d4%0x2);for(var _0x13ef56=0x0;_0x13ef56<_0xe30b02['length'];_0x13ef56++){var _0xe80d93=_0xe30b02[_0x13ef56]['trim']();if(_0xe80d93['length']>0x0){var _0x81ff23=_0xe80d93['substring'](0x0,0x4);var _0x55e93a=_0xe80d93['substring'](0x4);var _0x3665e8=new Tile(_0x55e93a,_0x81ff23,_0x2feae6+0x2*_0x13ef56*config['Tile']['dx'],(_0x5877d4-0x1)*config['Tile']['dy']);this['tiles']['push'](_0x3665e8);this['tileRowId']['push'](this['nRows']-0x1);}}}}}['loadTracks'](_0x210e27){var _0x365ddb=_0x210e27['trim']()['split']('\x0a');for(var _0x4cea2d=0x0;_0x4cea2d<_0x365ddb['length'];_0x4cea2d++){if(_0x365ddb[_0x4cea2d]['includes'](',')){var _0x396ae5=_0x365ddb[_0x4cea2d]['split'](',');for(var _0x3affcc of _0x396ae5){for(var _0x3c0b88 of this['tiles']){if(_0x3c0b88['equalsHash'](_0x3affcc)){_0x3c0b88['generateTrack'](_0x396ae5);_0x3c0b88['finalizeTrack']();}}}}}}['loadStops'](_0x2b18b5){var _0xc8f62e=_0x2b18b5['trim']();if(_0xc8f62e['includes'](',')){var _0x32e608=_0xc8f62e['split'](',');for(var _0x1725b3 of _0x32e608){for(var _0x40605d of this['tiles']){if(_0x40605d['equalsHash'](_0x1725b3)){_0x40605d['addStop']();}}}}}['loadTrams'](_0x3580fe,_0x9b48e2){var _0x543071=_0x3580fe['trim']()['split']('\x0a');for(var _0x54608c=0x0;_0x54608c<_0x543071['length'];_0x54608c++){if(_0x543071[_0x54608c]['includes'](',')){var _0x3c273f=_0x543071[_0x54608c]['split'](',');var _0x22bd98=[];for(var _0x365714 of _0x3c273f){for(var _0x949331 of this['tiles']){if(_0x949331['equalsHash'](_0x365714)){_0x22bd98['push'](_0x949331);}}}if(_0x22bd98['length']>0x1){var _0x44f3a1=Math['ceil'](_0x22bd98['length']/config['Tram']['maxTilesPerTram']);var _0x540f56=getPermutations(_0x22bd98,_0x44f3a1);_0x540f56['forEach'](function(_0x59411e){_0x59411e[0x0]['addVehicle'](new Tram(_0x59411e[0x0],_0x59411e[0x0]['getNeighbourConnection'](_0x59411e[0x1]),_0x9b48e2,config['Tram']['numTypes'],_0x59411e));});}}}}['getWidth'](){return 0x2*this['nCols']*config['Tile']['dx']-Math['floor'](config['Tile']['width']/0x2);}['getHeight'](_0x18f796){return this['nRows']*config['Tile']['dy']-Math['floor'](config['Tile']['height']/0x2);}['initTiles'](){this['tiles']['forEach'](function(_0x195ecb,_0x5f0fc2,_0x5f0015){_0x195ecb['computeAllNeighbours'](_0x5f0015);});this['tiles']['forEach'](function(_0x40b4de){_0x40b4de['computeStreetNeighboursAndConnections']();_0x40b4de['computeLineSegments']();});}['generateItems'](_0x3a3956,_0x162434,_0x15c5e1){this['tiles']['forEach'](function(_0x50a688){_0x50a688['generateHouse'](_0x3a3956);_0x50a688['generateTrees'](_0x162434);_0x50a688['generateCars'](_0x15c5e1);});}['draw'](){for(var _0x531513=0x0;_0x531513<this['tiles']['length'];_0x531513++){this['tiles'][_0x531513]['draw'](this['rowGroupsGround'][this['tileRowId'][_0x531513]],this['rowGroupsHouses'][this['tileRowId'][_0x531513]]);}this['drawVehicles']();this['drawTracks']();}['drawTracks'](){for(var _0x261a65=0x0;_0x261a65<this['tiles']['length'];_0x261a65++){this['tiles'][_0x261a65]['drawTracks'](this['rowGroupsGround'][this['tileRowId'][_0x261a65]]);}this['drawStops']();}['drawVehicles'](){for(var _0x29ee1d of this['tiles']){_0x29ee1d['drawVehicles'](this['masterGroup'],disableUI);}}['drawStops'](){for(var _0x128629=0x0;_0x128629<this['tiles']['length'];_0x128629++){this['tiles'][_0x128629]['drawStop'](this['rowGroupsGround'][this['tileRowId'][_0x128629]]);}}['update'](){this['tiles']['forEach'](_0x121b5b=>_0x121b5b['update']());this['masterGroup']['sort']('yz');}['disableTileHover'](){if(this['tileHover']!==null){this['tileHover']['setHover'](![]);}}['newTrackClick'](_0x317233,_0x43c65d,_0x131c7d){for(var _0x50610a of this['tiles']){if(_0x50610a['inside'](_0x317233,_0x43c65d)){this['disableTileHover']();if(!_0x50610a['isHouse']()&&(this['newTrack']['length']===0x0||this['newTrack'][this['newTrack']['length']-0x1]['isTrackNeighbourOf'](_0x50610a))){if(_0x131c7d){this['tileHover']=_0x50610a;this['tileHover']['setHover'](!![]);return!![];}this['newTrack']['push'](_0x50610a);var _0x2497a8=this['newTrack']['map'](_0x317233=>_0x317233['hash']);_0x50610a['generateTrack'](_0x2497a8);if(this['newTrack']['length']>0x1){this['newTrack'][0x0]['generateTrack'](_0x2497a8);this['newTrack'][this['newTrack']['length']-0x2]['generateTrack'](_0x2497a8);}this['drawTracks']();return!![];}return![];}}return![];}['newStopClick'](_0x29c940,_0x40836e,_0x4db6c2){for(var _0x44a9a9 of this['tiles']){if(_0x44a9a9['inside'](_0x29c940,_0x40836e)){this['disableTileHover']();if(_0x44a9a9['hasTracks']()&&_0x44a9a9['isStraightTrack']()&&(_0x44a9a9['isStraight']()||_0x44a9a9['isGrass']())&&!_0x44a9a9['hasStop']()){if(_0x4db6c2){this['tileHover']=_0x44a9a9;this['tileHover']['setHover'](!![]);return!![];}_0x44a9a9['addStop']();console['log'](_0x44a9a9['hash']);this['drawStops']();return!![];}return![];}}return![];}['newTramClick'](_0x4fabfd,_0x4b217d,_0x184257,_0x447283){for(var _0x36e425 of this['tiles']){if(_0x36e425['inside'](_0x4fabfd,_0x4b217d)){this['disableTileHover']();if(_0x36e425['hasTracks']()&&(this['newLine']['isEmpty']()&&_0x36e425['isStraightTrack']()||!this['newLine']['isEmpty']()&&this['newLine']['isAllowed'](_0x36e425))){if(_0x184257){this['tileHover']=_0x36e425;this['tileHover']['setHover'](!![]);return!![];}this['newLine']['proceed'](_0x36e425);this['drawTracks']();if(this['newLine']['closed']){this['newTramFinalize'](_0x447283);}return!![];}return![];}}return![];}['showTramClick'](_0x2487bf,_0x439b72){this['tiles']['forEach'](_0xd0dd6c=>_0xd0dd6c['abortTrack']());var _0x55b3bb=![];this['selectedVehicle']=null;for(var _0x2e2d53 of this['tiles']){var _0x4de6f2=_0x2e2d53['clickVehicle'](_0x2487bf,_0x439b72);if(_0x4de6f2!==null){this['selectedVehicle']=_0x4de6f2;_0x55b3bb=!![];}}this['drawTracks']();return _0x55b3bb;}['newTrackAbort'](){if(this['newTrack']['length']>0x0){this['newTrack']['forEach'](_0x39a6f=>_0x39a6f['abortTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramAbort'](){if(this['newLine']!==null){this['newLine']['abort']();this['drawTracks']();}this['disableTileHover']();}['newTrackFinalize'](){if(this['newTrack']['length']<0x2){this['newTrackAbort']();return;}if(this['newTrack']['length']>0x0){console['log'](this['newTrack']['map'](_0x494561=>_0x494561['hash'])['join']());this['newTrack']['forEach'](_0x1a271d=>_0x1a271d['finalizeTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramFinalize'](_0x43721b){if(this['newLine']!==null){var _0x3d8fd4=this['newLine']['getTiles']();console['log'](_0x3d8fd4['map'](_0x3c0b15=>_0x3c0b15['hash'])['join']());_0x3d8fd4[0x0]['addVehicle'](new Tram(_0x3d8fd4[0x0],_0x3d8fd4[0x0]['getNeighbourConnection'](_0x3d8fd4[0x1]),_0x43721b,config['Tram']['numTypes'],_0x3d8fd4));this['drawVehicles']();this['newTramAbort']();}}['removeSelectedTram'](){if(this['selectedVehicle']!==null){this['selectedVehicle']['disable']();this['selectedVehicle']=null;this['showTramClick'](-0x1,-0x1);}}};class Driver{};class CarDriver extends Driver{['leaveParkingLot'](){return Math['random']()<config['Driver']['probStepDrive'];}['parkNow'](){return Math['random']()<config['Driver']['probTilePark'];}['decideTurn'](_0x4e051e){return _0x4e051e[Math['floor'](Math['random']()*_0x4e051e['length'])];}['getLine'](){return null;}};class TramDriver extends Driver{constructor(_0x4cd312){super();this['tiles']=_0x4cd312;this['line']=_0x4cd312['map'](_0x2f3ad0=>_0x2f3ad0['hash']);this['lastLineIndex']=0x0;this['waitingTime']=0x0;}['leaveStop'](){this['waitingTime']+=0x1;if(this['waitingTime']>config['Driver']['waitAtStop']){this['waitingTime']=0x0;return!![];}return![];}['decideTurn'](_0x5366c9){var _0x551099=this['line']['indexOf'](_0x5366c9['hash'],this['lastLineIndex']);if(_0x551099<0x0){_0x551099=this['line']['indexOf'](_0x5366c9['hash']);if(_0x551099<0x0){return null;}}_0x551099+=0x1;if(_0x551099>this['line']['length']-0x1){_0x551099=0x0;}this['lastLineIndex']=_0x551099;return _0x5366c9['getNeighbourConnection'](this['line'][_0x551099]);}['getLine'](){return this['tiles'];}};class BezierCurve{constructor(_0x4e4a6f){this['anchorPoints']=_0x4e4a6f;}['get'](_0x16cc66){var _0x19c3a7=this['anchorPoints']['length'];var _0x57cf88=Array(_0x19c3a7);var _0x1a3734=null;var _0x520639=null;for(_0x1a3734=0x0;_0x1a3734<_0x19c3a7;_0x1a3734++){_0x57cf88[_0x1a3734]=Array(_0x19c3a7);}for(_0x1a3734=0x0;_0x1a3734<_0x19c3a7;_0x1a3734++){_0x57cf88[_0x1a3734][0x0]=this['anchorPoints'][_0x1a3734];}var _0x2c5b56=0x0;var _0x2e3451=0x0;for(_0x520639=0x1;_0x520639<_0x19c3a7;_0x520639++){for(_0x1a3734=0x0;_0x1a3734<_0x19c3a7-_0x520639;_0x1a3734++){_0x2c5b56=(0x1-_0x16cc66)*_0x57cf88[_0x1a3734][_0x520639-0x1]['x']+_0x16cc66*_0x57cf88[_0x1a3734+0x1][_0x520639-0x1]['x'];_0x2e3451=(0x1-_0x16cc66)*_0x57cf88[_0x1a3734][_0x520639-0x1]['y']+_0x16cc66*_0x57cf88[_0x1a3734+0x1][_0x520639-0x1]['y'];_0x57cf88[_0x1a3734][_0x520639]=new Point(_0x2c5b56,_0x2e3451);}}return _0x57cf88[0x0][_0x19c3a7-0x1];}['getPath'](_0x4b1680){var _0x26ec8e=[];var _0x3ef0e4=0x0;var _0x47d349=this['anchorPoints'][0x0];var _0x33c7d9=null;var _0x51b4ee=null;var _0x41e814=null;var _0x1c3f34=null;var _0x41ff96=null;var _0x4748cb=null;var _0x20fe6f=null;while(_0x3ef0e4<0x1){_0x51b4ee=_0x3ef0e4;_0x41e814=0x0;_0x1c3f34=0x0;_0x41ff96=0x0;while(_0x41e814<_0x4b1680){_0x51b4ee+=0.005;_0x33c7d9=this['get'](_0x51b4ee);_0x1c3f34=_0x33c7d9['x']-_0x47d349['x'];_0x41ff96=_0x33c7d9['y']-_0x47d349['y'];_0x41e814=Math['sqrt'](_0x1c3f34*_0x1c3f34+_0x41ff96*_0x41ff96);}_0x4748cb=Math['atan2'](_0x1c3f34,-_0x41ff96)*0xb4/Math['PI'];if(_0x4748cb<0x0){_0x4748cb+=0x168;}_0x20fe6f=new Point((_0x47d349['x']+_0x33c7d9['x'])/0x2,(_0x47d349['y']+_0x33c7d9['y'])/0x2);_0x20fe6f['head']=_0x4748cb;_0x26ec8e['push'](_0x20fe6f);_0x47d349=new Point(_0x33c7d9['x'],_0x33c7d9['y']);_0x3ef0e4=_0x51b4ee;}return _0x26ec8e['slice'](0x0,_0x26ec8e['length']-0x1);}};class Vehicle{constructor(_0x39375d,_0x36c54d,_0x28c057,_0x4c4e4e){this['hash']=generateRandomId();this['colorId']=_0x28c057[Math['floor'](Math['random']()*_0x28c057['length'])];this['typeId']=Math['floor'](Math['random']()*_0x4c4e4e);this['sprite']=null;this['bounds']={};this['tile']=_0x39375d;this['oldTile']='null';this['v']=0x0;this['head']=_0x36c54d;this['queue']=[];this['cachedHead']=null;this['cachedClosestHead']=null;this['cachedSpriteHead']=null;this['cachedSpritePosition']=new Point(null,null);this['start']();this['waitingTime']=0x0;this['collisionWith']=null;this['turnPath']=null;this['plannedHead']=null;this['error']=![];this['lastStop']=null;}['disable'](){this['y']=-0x64;this['error']=!![];this['tile']['removeVehicle'](this);this['sprite']['destroy']();this['queue']=[];}['equals'](_0x39a18b){return this['hash']===_0x39a18b['hash'];}['closeTo'](_0xbc7393,_0x26ab02,_0x34372e){return(_0x26ab02-_0xbc7393['x'])**0x2+(_0x34372e-_0xbc7393['y'])**0x2<0.5*(this['sprite']['height']+_0xbc7393['sprite']['height'])**0x2;}['startXY'](_0x3196c7,_0x4cdf08){this['x']=this['tile']['x'];if(_0x3196c7===0x3c||_0x3196c7===0x12c){this['x']+=config['Tile']['width']/0x4;}else{this['x']-=config['Tile']['width']/0x4;}this['y']=(_0x4cdf08['nx']*(_0x4cdf08['px']-this['x'])+_0x4cdf08['ny']*_0x4cdf08['py'])/_0x4cdf08['ny'];}['draw'](_0x5ed23e,_0x3758d7){if(this['sprite']===null){this['sprite']=game['add']['sprite'](0x0,0x0,this['colorId']);this['updateSprite'](this['x'],this['y'],this['getHead']());_0x5ed23e['add'](this['sprite']);this['createBounds']();if(!_0x3758d7){this['setCursor']();}}}['createBounds'](){var _0x49b569=this['sprite']['width'];var _0x366be0=document['getElementById']('vehicle-canvas');var _0x1ba6c5=this['sprite']['texture']['baseTexture']['source'];_0x366be0['getContext']('2d')['drawImage'](_0x1ba6c5,0x0,0x0,_0x1ba6c5['width'],_0x1ba6c5['height']);var _0x320da6=this['typeId']*_0x49b569;for(var _0x5659ab=0x0;_0x5659ab<config['Vehicle']['headingOrder']['length'];_0x5659ab++){var _0x14ac0b=[];var _0x49e65c=_0x5659ab*_0x49b569;for(var _0x22303c=0x0;_0x22303c<0x168;_0x22303c+=config['Vehicle']['collisionSampling']){for(var _0x3d4ee9=0x0;_0x3d4ee9<_0x49b569;_0x3d4ee9++){var _0x16f22e=Math['round'](_0x3d4ee9*Math['sin'](_0x22303c*Math['PI']/0xb4));var _0xc0de19=-Math['round'](_0x3d4ee9*Math['cos'](_0x22303c*Math['PI']/0xb4));var _0x1ed013=_0x366be0['getContext']('2d')['getImageData'](_0x16f22e+_0x49e65c+Math['round'](_0x49b569/0x2),_0xc0de19+_0x320da6+Math['round'](_0x49b569/0x2),0x1,0x1)['data'][0x3];if(_0x1ed013<0xff){_0x14ac0b['push'](_0x16f22e);_0x14ac0b['push'](_0xc0de19);break;}}}this['bounds'][config['Vehicle']['headingOrder'][_0x5659ab]]=new Phaser['Polygon'](_0x14ac0b);}}['getBounds'](){return this['bounds'][this['getHead']()];}['updateSprite'](_0x295843,_0xaf297e,_0x2f9c6f){if(this['sprite']!==null){this['updateSpritePosition'](_0x295843,_0xaf297e);this['updateSpriteFrame'](_0x2f9c6f);}}['updateSpritePosition'](_0x142ab9,_0x154616){if(!this['cachedSpritePosition']['equals'](_0x142ab9,_0x154616)){this['sprite']['x']=_0x142ab9-this['sprite']['width']/0x2;this['sprite']['y']=_0x154616-this['sprite']['height']/0x2;this['sprite']['yz']=_0x154616+this['sprite']['height']/0x2;this['cachedSpritePosition']=new Point(_0x142ab9,_0x154616);}}['updateSpriteFrame'](_0x536d11){_0x536d11=convertInt(_0x536d11);if(this['cachedSpriteHead']!==_0x536d11){var _0x1f268=config['Vehicle']['headingOrder']['indexOf'](_0x536d11);if(_0x1f268===-0x1){error('Heading\x20not\x20in\x20vehicle\x20sprite',this,this['disable']);return null;}this['sprite']['frame']=this['typeId']*config['Vehicle']['headingOrder']['length']+_0x1f268;this['cachedSpriteHead']=_0x536d11;}}['click'](_0xa42a86,_0x22e4a0){if(this['sprite']!==null){return Phaser['Rectangle']['containsPoint'](this['sprite']['getBounds'](),new Phaser['Point'](_0xa42a86,_0x22e4a0));}return![];}['getLine'](){return this['driver']['getLine']();}['update'](){if(this['error']){return;}if(this['queue'][0x0]['call'](this)){this['queue']['shift']();}var _0x2de64c=0x1/config['World']['stepsPerSecond'];this['waitingTime']+=_0x2de64c;if(this['v']>0x0){var _0x4a5dea=this['getHead']();var _0x2fb0df=Math['sin'](_0x4a5dea*Math['PI']/0xb4)*this['v']*_0x2de64c;var _0x15452b=-Math['cos'](_0x4a5dea*Math['PI']/0xb4)*this['v']*_0x2de64c;if(this['collision'](this['x']+_0x2fb0df,this['y']+_0x15452b,_0x4a5dea)){this['queue']['splice'](0x0,0x0,this['callbackWait']);}else{this['waitingTime']=0x0;this['x']+=_0x2fb0df;this['y']+=_0x15452b;this['enterNewTile']();if(!this['tile']['inside'](this['x'],this['y'])){error('Vehicle\x20has\x20left\x20its\x20tile',this,this['disable']);}this['updateSprite'](this['x'],this['y'],_0x4a5dea);}}if(this['waitingTime']>config['Vehicle']['waitForever']&&this['collisionWith']!==null){if(this['collisionWith']['collidingWith'](this)){error('Vehicle\x20is\x20in\x20a\x20collision\x20loop',this,this['disable']);}}}['enterNewTile'](){if(this['tile']['inside'](this['x'],this['y'])){return;}for(var _0x4b88ce of this['tile']['neighbours']){if(_0x4b88ce['inside'](this['x'],this['y'])){if(this['getHead']()===convertInt(this['tile']['getNeighbourConnection'](_0x4b88ce))){this['laneAssist']();if(this['tile']['inside'](this['x'],this['y'])){return;}}if(this['isInFront'](_0x4b88ce,this['x'],this['y'],this['head'])){this['oldTile']=this['tile']['hash'];this['tile']['removeVehicle'](this);this['tile']=_0x4b88ce;this['tile']['addVehicle'](this);this['plannedHead']=null;this['parkNow']();return;}}}}['getHead'](){if(this['cachedHead']!==this['head']){this['cachedHead']=this['head'];this['cachedClosestHead']=this['getClosestHead'](this['head'],![]);}return this['cachedClosestHead'];}['getNextHead'](_0x5ddc82){var _0x27eb02=config['Vehicle']['headingOrder']['indexOf'](this['getHead']())+_0x5ddc82;if(_0x27eb02<0x0){_0x27eb02+=config['Vehicle']['headingOrder']['length'];}else if(_0x27eb02>=config['Vehicle']['headingOrder']['length']){_0x27eb02-=config['Vehicle']['headingOrder']['length'];}return config['Vehicle']['headingOrder'][_0x27eb02];}['getClosestHead'](_0x332b48,_0x3c9753){if(_0x332b48<0x0||0x168<=_0x332b48){error('Heading\x20out\x20of\x20range',this,this['disable']);return null;}var _0xb3432b=config['Vehicle']['headingOrder']['slice'](0x0);if(_0x3c9753){_0xb3432b['sort'](function(_0x58c3f1,_0x112c03){return _0x58c3f1-_0x112c03;});for(var _0x381ee6=0x0;_0x381ee6<_0xb3432b['length']-0x1;_0x381ee6++){if(_0xb3432b[_0x381ee6]<=_0x332b48&&_0x332b48<_0xb3432b[_0x381ee6+0x1]){return _0xb3432b[_0x381ee6];}}return _0xb3432b['reverse']()[0x0];}else{if(_0x332b48>0x12c){_0xb3432b[config['Vehicle']['headingOrder']['indexOf'](0x0)]=0x168;}var _0x5df311=_0xb3432b['reduce'](function(_0x4dca45,_0x5ab9e1){if(Math['abs'](_0x4dca45-_0x332b48)<Math['abs'](_0x5ab9e1-_0x332b48)){return _0x4dca45;}return _0x5ab9e1;});if(_0x5df311===0x168){return 0x0;}return _0x5df311;}}['getTurnPath'](_0x13d5d2){var _0x370052=new Point(this['x'],this['y']);var _0x3e4702=this['tile']['getLaneTargetPoint'](_0x13d5d2,config['Street']['laneDrive'],config['Street']['lanePointFactor']);var _0x4c1a1e=getCurve(_0x370052,_0x3e4702,this['getHead'](),_0x13d5d2,config['Street']['bezierFactor']);return _0x4c1a1e['getPath'](config['Vehicle']['velocityTurn']/config['World']['stepsPerSecond']);}['laneAssist'](){var _0x30c06c=this['tile']['getClosestPointInLane'](this['x'],this['y'],this['getHead'](),config['Street']['laneDrive']);this['x']=_0x30c06c['x'];this['y']=_0x30c06c['y'];}['isInFront'](_0x1a692b,_0x5be99b,_0x8cea8d,_0x4322c3){var _0x44a948=_0x1a692b['x']-_0x5be99b;var _0x507f9d=_0x1a692b['y']-_0x8cea8d;var _0x10ac6f=this['getHeadFromDxDy'](_0x44a948,_0x507f9d);if(_0x4322c3+0x3c<_0x10ac6f&&_0x10ac6f<_0x4322c3+0x12c||_0x4322c3+0x3c<_0x10ac6f+0x168&&_0x10ac6f+0x168<_0x4322c3+0x12c){return![];}return!![];}['getHeadFromDxDy'](_0x2c1e32,_0x5171f2){var _0x26d352=Math['atan2'](_0x2c1e32,-_0x5171f2)*0xb4/Math['PI'];if(_0x26d352<0x0){_0x26d352+=0x168;}return _0x26d352;}['getMaxDistancePerStep'](){return Math['ceil'](this['v']/config['World']['stepsPerSecond']);}['collidingWith'](_0x44587b){if(this['collisionWith']===null){return![];}return this['collisionWith']['equals'](_0x44587b);}['collision'](_0x46a5d6,_0xb04121,_0x50d499){var _0x149da6=null;for(_0x149da6 of this['tile']['vehicles']){if(this['collideWith'](_0x149da6,_0x46a5d6,_0xb04121,_0x50d499)){this['collisionWith']=_0x149da6;return!![];}}for(var _0x3cc94c of this['tile']['neighbours']){for(_0x149da6 of _0x3cc94c['vehicles']){if(this['collideWith'](_0x149da6,_0x46a5d6,_0xb04121,_0x50d499)){this['collisionWith']=_0x149da6;return!![];}}}this['collisionWith']=null;return![];}['collideWith'](_0x42abac,_0x1647f0,_0x314e37,_0x1f8541){if(this['equals'](_0x42abac)){return![];}if(_0x42abac['error']){return![];}if(!this['closeTo'](_0x42abac,_0x1647f0,_0x314e37)){return![];}if(_0x42abac['isParking']()){return![];}if(!this['isInFront'](_0x42abac,_0x1647f0,_0x314e37,_0x1f8541)){return![];}for(var _0x8b5d43=0x4;_0x8b5d43<0xd;_0x8b5d43++){if(_0x42abac['getNextHead'](_0x8b5d43)===_0x1f8541){return![];}}var _0x4a2065=_0x42abac['x']-_0x1647f0;var _0x36a30d=_0x42abac['y']-_0x314e37;var _0x56f130=_0x42abac['getBounds']()['points'];for(var _0x5edd04 of _0x56f130){if(this['bounds'][_0x1f8541]['contains'](_0x5edd04['x']+_0x4a2065,_0x5edd04['y']+_0x36a30d)){return!![];}}return![];}['parkNow'](){}['callbackProceedToTargetLane'](_0x42735c,_0x3aff41){if(_0x42735c===null){_0x42735c=this['plannedHead'];}this['v']=config['Vehicle']['velocityTurn'];var _0x658913=this['tile']['getDistanceToLane'](this['x'],this['y'],_0x42735c,_0x3aff41);if(_0x658913<this['getMaxDistancePerStep']()){if(this['collision'](this['x'],this['y'],_0x42735c)){this['v']=0x0;return![];}this['head']=_0x42735c;return!![];}return![];}['callbackDrive'](){if(this['queue']['length']!==0x1){error('Callback\x20queue\x20corrupted',this,this['disable']);return!![];}if(this['tile']['isHighway']()||this['tile']['isGrass']()){this['v']=config['Vehicle']['velocityHighway'];}else{this['v']=config['Vehicle']['velocityCity'];}if(this['tile']['hasStop']()&&this['isOnStraight']()&&this['tile']['inside'](this['x'],this['y'],config['Vehicle']['centerSizeFactor'])){this['queue']['push'](this['callbackAtStop']);return!![];}if(this['tile']['isDeadEndOrJunctionOrCrossing']()){if(!(this['isOnNonIntersectingWay']()&&this['tile']['onlySameVehicleType']())){var _0x59aa74=this['tile']['getVehicleIndex'](this);for(var _0x3adb4d=0x0;_0x3adb4d<_0x59aa74;_0x3adb4d++){if(!this['tile']['vehicles'][_0x3adb4d]['isParking']()&&this['tile']['vehicles'][_0x3adb4d]['waitingTime']<=config['Vehicle']['waitBlocked']){this['v']=0x0;this['waitingTime']=0x0;return![];}}}}if(this['plannedHead']===null){if(!this['isOnStraight']()&&this['tile']['nearCenter'](this['x'],this['y'])){this['plannedHead']=this['getNextTurn']();if(this['plannedHead']===null){return!![];}if(this['plannedHead']===this['getHead']()){this['queue']['push'](this['callbackDrive']);}else{this['queue']['push'](this['callbackTurn']);this['queue']['push'](function(){return this['callbackProceedToTargetLane'](null,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);}return!![];}}return![];}['callbackWait'](){return!![];}['callbackTurn'](){this['v']=0.01;var _0x23ac67=this['tile']['getDistanceToLane'](this['x'],this['y'],this['plannedHead'],config['Street']['laneDrive']);if(_0x23ac67<this['getMaxDistancePerStep']()){this['turnPath']=null;return!![];}if(this['turnPath']===null){this['turnPath']=this['getTurnPath'](this['plannedHead']);}var _0x2b7a9b=this['turnPath'][0x0]['head'];var _0x4e9876=this['turnPath'][0x0]['x'];var _0x418851=this['turnPath'][0x0]['y'];var _0x118ca2=this['getClosestHead'](_0x2b7a9b,!![]);if(this['collision'](_0x4e9876,_0x418851,_0x118ca2)){this['v']=0x0;return![];}this['head']=_0x2b7a9b;this['x']=_0x4e9876;this['y']=_0x418851;this['turnPath']['splice'](0x0,0x1);if(this['turnPath']['length']===0x0){this['turnPath']=null;return!![];}return![];}};class Car extends Vehicle{constructor(..._0x2af291){super(..._0x2af291);this['driver']=new CarDriver();}['isTram'](){return![];}['setCursor'](){}['start'](){var _0x219b5e=this['getHead']();var _0x11b7b3=this['tile']['getLane'](_0x219b5e,config['Street']['lanePark']);this['startXY'](_0x219b5e,_0x11b7b3);this['queue']=[this['callbackPark']];}['getNextTurn'](){var _0x57ff42=this['tile']['getStreetConnections']()['slice'](0x0);if(!this['tile']['isDeadEnd']()){var _0x26cb0f=this['tile']['streetNeighbours']['map'](_0xb84a46=>_0xb84a46['hash']);if(_0x26cb0f['includes'](this['oldTile'])){var _0x40e1cf=this['tile']['neighbourConnections'][this['oldTile']];if(_0x57ff42['includes'](_0x40e1cf)){_0x57ff42['splice'](_0x57ff42['indexOf'](_0x40e1cf),0x1);}}}if(_0x57ff42['length']===0x0){error('Empty\x20connection\x20list',this,this['disable']);return null;}var _0xe503ec=this['tile']['getVehicleIndex'](this);for(var _0x192576=0x0;_0x192576<_0xe503ec;_0x192576++){var _0x7d928b=this['tile']['vehicles'][_0x192576];if(_0x7d928b['waitingTime']>config['Vehicle']['waitBlocked']&&_0x57ff42['length']>0x1){if(_0x57ff42['includes'](_0x7d928b['getHead']())){_0x57ff42['splice'](_0x57ff42['indexOf'](_0x7d928b['getHead']()),0x1);}else if(_0x57ff42['includes'](_0x7d928b['plannedHead'])){_0x57ff42['splice'](_0x57ff42['indexOf'](_0x7d928b['plannedHead']),0x1);}}}return this['driver']['decideTurn'](_0x57ff42);}['parkNow'](){if(this['queue'][0x0]===this['callbackDrive']&&this['driver']['parkNow']()&&this['tile']['hasFreeParkingLot'](this['getHead']())){this['queue']=[this['callbackEnterParkingLot']];}}['isOnStraight'](){return this['tile']['isStraight']();}['isOnNonIntersectingWay'](){return this['tile']['isStraight']()||this['tile']['isCurve']();}['isParking'](){return convertInt(this['v'])===0x0&&[this['callbackPark'],this['callbackLeaveParkingLot']]['includes'](this['queue'][0x0]);}['callbackEnterParkingLot'](){this['queue']['push'](function(){return this['callbackChangeLane'](0x1);});this['queue']['push'](function(){var _0x5a7105=this['getNextHead'](-0x2);return this['callbackProceedToTargetLane'](_0x5a7105,config['Street']['lanePark']);});this['queue']['push'](this['callbackPark']);return!![];}['callbackPark'](){this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveParkingLot']()){this['queue']['push'](this['callbackLeaveParkingLot']);return!![];}return![];}['callbackLeaveParkingLot'](){if(!this['tile']['onlySameVehicleType']()){return![];}for(var _0x14064a of this['tile']['vehicles']){if(!this['equals'](_0x14064a)&&!_0x14064a['isParking']()&&_0x14064a['getHead']()===this['getHead']()){return![];}}this['queue']['push'](function(){return this['callbackChangeLane'](-0x1);});this['queue']['push'](function(){var _0x42dd16=this['getNextHead'](0x2);return this['callbackProceedToTargetLane'](_0x42dd16,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);return!![];}['callbackChangeLane'](_0x5b3c43){this['head']=this['getNextHead'](0x2*_0x5b3c43);return!![];}['callbackAtStop'](){this['queue']['push'](this['callbackDrive']);return!![];}};class Tram extends Vehicle{constructor(_0x1387c0,_0x593137,_0x1af827,_0x5701af,_0x3277be){super(_0x1387c0,_0x593137,_0x1af827,_0x5701af);this['driver']=new TramDriver(_0x3277be);}['isTram'](){return!![];}['setCursor'](){if(this['sprite']!==null){this['sprite']['inputEnabled']=!![];this['sprite']['events']['onInputOver']['add'](function(){UI['setCursorInfo']();});this['sprite']['events']['onInputOut']['add'](function(){UI['unsetCursorInfo']();});}}['start'](){var _0x5590fe=this['getHead']();var _0x25f76f=this['tile']['getLane'](_0x5590fe,config['Street']['laneDrive']);this['startXY'](_0x5590fe,_0x25f76f);this['queue']=[this['callbackDrive']];}['getNextTurn'](){var _0x7c2a8c=this['driver']['decideTurn'](this['tile']);if(_0x7c2a8c===null){error('Tram\x20does\x20not\x20find\x20a\x20way',this,this['disable']);return null;}return _0x7c2a8c;}['isOnStraight'](){return this['tile']['isStraightTrack']();}['isOnNonIntersectingWay'](){return this['tile']['isNonIntersectingTrack']();}['isParking'](){return![];}['callbackAtStop'](){if(this['tile']['equals'](this['lastStop'])){this['queue']['push'](this['callbackDrive']);return!![];}this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveStop']()){this['lastStop']=this['tile'];this['queue']['push'](this['callbackDrive']);return!![];}return![];}};class UI{static['disableSpinner'](){document['getElementById']('spinner')['style']['display']='none';}static['buttonNewTrack'](_0x597ed9,_0x48409e){if(_0x597ed9){document['getElementById']('button-track')['classList']['remove']('button-disabled');}else{document['getElementById']('button-track')['classList']['add']('button-disabled');}if(_0x48409e){document['getElementById']('button-track')['classList']['add']('button-active');}else{document['getElementById']('button-track')['classList']['remove']('button-active');}}static['buttonNewStop'](_0x3a4272,_0x2a7645){if(_0x3a4272){document['getElementById']('button-stop')['classList']['remove']('button-disabled');}else{document['getElementById']('button-stop')['classList']['add']('button-disabled');}if(_0x2a7645){document['getElementById']('button-stop')['classList']['add']('button-active');}else{document['getElementById']('button-stop')['classList']['remove']('button-active');}}static['buttonNewTram'](_0x42cb3c,_0x1eca0f){if(_0x42cb3c){document['getElementById']('button-tram')['classList']['remove']('button-disabled');}else{document['getElementById']('button-tram')['classList']['add']('button-disabled');}if(_0x1eca0f){document['getElementById']('button-tram')['classList']['add']('button-active');}else{document['getElementById']('button-tram')['classList']['remove']('button-active');}}static['buttonAbort'](_0x42d717){if(_0x42d717){document['getElementById']('button-abort')['classList']['remove']('button-disabled');}else{document['getElementById']('button-abort')['classList']['add']('button-disabled');}}static['buttonFinish'](_0x4690b5){if(_0x4690b5){document['getElementById']('button-finish')['classList']['remove']('button-disabled');}else{document['getElementById']('button-finish')['classList']['add']('button-disabled');}}static['setCursorDefault'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorOk'](){document['getElementById']('canvas')['classList']['add']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorNok'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['add']('nok');}static['setCursorInfo'](){if(state['isClickable']()){document['getElementById']('canvas')['classList']['add']('info');}}static['unsetCursorInfo'](){document['getElementById']('canvas')['classList']['remove']('info');}};class State{['abort'](_0xeedd17){}['finish'](_0x464768){}['click'](_0x2207ab,_0x5e38cf,_0x5b2257){return this;}['hover'](_0x16776c,_0x1c8801,_0x70fc38){}['isClickable'](){return![];}};class StateDefault extends State{static['change'](){return new StateDefault();}['setButtons'](){UI['buttonNewTrack'](!![],![]);UI['buttonNewStop'](!![],![]);UI['buttonNewTram'](!![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](![]);}['setCursor'](){UI['setCursorDefault']();}['click'](_0x1573d9,_0x101e35,_0x4b170e){if(_0x4b170e['showTramClick'](_0x1573d9-game['camera']['x'],_0x101e35-game['camera']['y'])){return StateTramInfo['change']();}return this;}['isClickable'](){return!![];}};class StateNewTrack extends State{static['change'](){return new StateNewTrack();}['setButtons'](){UI['buttonNewTrack'](!![],!![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x4738cf){_0x4738cf['newTrackAbort']();}['finish'](_0x1658e5){_0x1658e5['newTrackFinalize']();}['click'](_0x41a6cf,_0x2ac664,_0x4e55ed){_0x4e55ed['newTrackClick'](_0x41a6cf,_0x2ac664,![]);return this;}['hover'](_0x4a3d0a,_0x12fa2d,_0x483db4){if(_0x483db4['newTrackClick'](_0x4a3d0a,_0x12fa2d,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewStop extends State{static['change'](){return new StateNewStop();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](!![],!![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['click'](_0x543aab,_0xb86887,_0x5ec9a1){_0x5ec9a1['newStopClick'](_0x543aab,_0xb86887,![]);return this;}['hover'](_0x4d77dd,_0x482f99,_0x567257){if(_0x567257['newStopClick'](_0x4d77dd,_0x482f99,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewTram extends State{static['change'](){return new StateNewTram();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](!![],!![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x5d756f){_0x5d756f['newTramAbort']();}['finish'](_0xf5b81a){this['abort'](_0xf5b81a);}['click'](_0x20b5b3,_0x5f4cc1,_0x245af2){_0x245af2['newTramClick'](_0x20b5b3,_0x5f4cc1,![],loader['trams']);return this;}['hover'](_0x40902d,_0x1f752c,_0x186389){if(_0x186389['newTramClick'](_0x40902d,_0x1f752c,!![],loader['trams'])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateTramInfo extends State{static['change'](){return new StateTramInfo();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorDefault']();}['abort'](_0xcc240d){_0xcc240d['removeSelectedTram']();}['finish'](_0x4481d9){_0x4481d9['showTramClick'](-0x1,-0x1);}['click'](_0x546c7b,_0x3b7fee,_0x2c8de2){return StateDefault['change']()['click'](_0x546c7b,_0x3b7fee,_0x2c8de2);}['isClickable'](){return!![];}};var game=new Phaser['Game']('100','100',Phaser['CANVAS'],'canvas',{'preload':preload,'create':create,'update':update});var loader=new Loader();var map=new Map();var state=StateDefault['change']();var config;var cursors;var mouseDown=![];var disableUI=!![];function loadConfig(_0x5c4868,_0x224532,_0x386732,_0x22656e,_0x339620){if(_0x224532==='config'){config=game['cache']['getJSON']('config');loader['load']();}}function step(){map['update']();}function preload(){game['load']['onFileComplete']['add'](loadConfig,this);game['load']['text']('world','city/world.dat');game['load']['text']('tracks','city/tracks.dat');game['load']['text']('stops','city/stops.dat');game['load']['text']('trams','city/trams.dat');game['load']['json']('config','city/config.json');}function updateUI(){state['setButtons']();state['setCursor']();}function create(){cursors=game['input']['keyboard']['createCursorKeys']();Phaser['Canvas']['setTouchAction'](game['canvas'],'auto');game['stage']['backgroundColor']=config['Street']['color'];map['loadMap'](game['cache']['getText']('world'));map['initTiles']();map['loadTracks'](game['cache']['getText']('tracks'));map['loadStops'](game['cache']['getText']('stops'));map['generateItems'](loader['houses'],loader['trees'],loader['cars']);map['loadTrams'](game['cache']['getText']('trams'),loader['trams']);game['world']['resize'](map['getWidth'](),map['getHeight']());map['draw']();var _0x560f8f=0x1/config['World']['stepsPerSecond'];game['time']['events']['loop'](_0x560f8f,step);if(disableUI){document['getElementById']('button-track')['style']['display']='none';document['getElementById']('button-stop')['style']['display']='none';document['getElementById']('button-tram')['style']['display']='none';document['getElementById']('button-abort')['style']['display']='none';document['getElementById']('button-finish')['style']['display']='none';}else{document['getElementById']('button-track')['addEventListener']('click',onButtonTrack);document['getElementById']('button-stop')['addEventListener']('click',onButtonStop);document['getElementById']('button-tram')['addEventListener']('click',onButtonTram);document['getElementById']('button-abort')['addEventListener']('click',onButtonAbort);document['getElementById']('button-finish')['addEventListener']('click',onButtonFinish);}UI['disableSpinner']();updateUI();}function onButtonTrack(){state=StateNewTrack['change']();updateUI();}function onButtonStop(){state=StateNewStop['change']();updateUI();}function onButtonTram(){state=StateNewTram['change']();updateUI();}function onTramInfo(){state=StateTramInfo['change']();updateUI();}function onButtonAbort(){state['abort'](map);state=StateDefault['change']();updateUI();}function onButtonFinish(){state['finish'](map);state=StateDefault['change']();updateUI();}function update(){if(cursors['up']['isDown']){game['camera']['y']-=0x14;}else if(cursors['down']['isDown']){game['camera']['y']+=0x14;}if(cursors['left']['isDown']){game['camera']['x']-=0x14;}else if(cursors['right']['isDown']){game['camera']['x']+=0x14;}if(!disableUI){if(game['input']['mousePointer']['leftButton']['isDown']){mouseDown=!![];}if(game['input']['mousePointer']['leftButton']['isUp']&&mouseDown){mouseDown=![];state=state['click'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);updateUI();}else{state['hover'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);}}}