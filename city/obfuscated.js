'use strict';function error(_0x5e3a17,_0xc0908b,_0x46539e){console['error'](_0x5e3a17);if(_0x46539e===null){throw new Error(_0x5e3a17);}else{_0x46539e['call'](_0xc0908b);}}function convertInt(_0x2417b7){return parseInt(_0x2417b7,0xa);}function getPermutations(_0x1ecab1,_0x163067){var _0x115b83=[];for(var _0x5b85cb=0x0;_0x5b85cb<_0x163067;_0x5b85cb++){var _0x3c421f=Math['floor'](_0x1ecab1['length']*_0x5b85cb/_0x163067);var _0x297a58=_0x1ecab1['slice'](_0x3c421f);var _0x2ec616=_0x1ecab1['slice'](0x0,_0x3c421f);_0x115b83['push'](_0x297a58['concat'](_0x2ec616));}return _0x115b83;}function normalizeAngle(_0x4bbade){if(_0x4bbade>=0x168){_0x4bbade-=0x168;}return _0x4bbade;}function generateRandomId(){var _0x1f4cf3='';_0x1f4cf3+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x1f4cf3+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);_0x1f4cf3+=Math['random']()['toString'](0x24)['substr'](0x2,0x5);return _0x1f4cf3;}function getTurnDirection(_0x42599a,_0x3e8c60){if(0x0<_0x3e8c60-_0x42599a&&_0x3e8c60-_0x42599a<0xb4){return 0x1;}else if(-0xb4<=_0x3e8c60-_0x42599a&&_0x3e8c60-_0x42599a<0x0){return-0x1;}else if(_0x3e8c60-_0x42599a>=0xb4){return-0x1;}else if(-0xb4>_0x3e8c60-_0x42599a){return 0x1;}return 0x0;}function getDeltaHead(_0x3b6465,_0x27db6c){var _0x1a0db5=getTurnDirection(_0x3b6465,_0x27db6c);var _0x6e3a1b=0x0;if(_0x1a0db5<0x0){if(_0x27db6c>_0x3b6465){_0x6e3a1b=_0x3b6465-(_0x27db6c-0x168);}else{_0x6e3a1b=_0x3b6465-_0x27db6c;}}else if(_0x1a0db5>0x0){if(_0x27db6c<_0x3b6465){_0x6e3a1b=_0x27db6c+0x168-_0x3b6465;}else{_0x6e3a1b=_0x27db6c-_0x3b6465;}}return _0x6e3a1b;}function getCurve(_0x17f502,_0x23dd57,_0x16516a,_0x233c8d,_0x395b24){var _0x23e3b1=Math['sin'](_0x16516a*Math['PI']/0xb4);var _0x4bc874=-Math['cos'](_0x16516a*Math['PI']/0xb4);var _0x29e5cf=Math['sin'](_0x233c8d*Math['PI']/0xb4);var _0x580bb3=-Math['cos'](_0x233c8d*Math['PI']/0xb4);var _0x4d99c5=getDeltaHead(_0x16516a,_0x233c8d);var _0x395b24=_0x395b24*_0x4d99c5;if(_0x4d99c5===0x0){return new BezierCurve([_0x17f502,_0x23dd57]);}return new BezierCurve([_0x17f502,new Point(_0x17f502['x']+_0x395b24*_0x23e3b1,_0x17f502['y']+_0x395b24*_0x4bc874),new Point(_0x23dd57['x']-_0x395b24*_0x29e5cf,_0x23dd57['y']-_0x395b24*_0x580bb3),_0x23dd57]);}function linesAreEqual(_0x40214d,_0x1f98c7){if(_0x40214d['length']!==_0x1f98c7['length']){return![];}for(var _0x12b758=0x0;_0x12b758<_0x40214d['length'];_0x12b758++){if(_0x40214d[_0x12b758]['start']['x']!==_0x1f98c7[_0x12b758]['start']['x']||_0x40214d[_0x12b758]['start']['y']!==_0x1f98c7[_0x12b758]['start']['y']){return![];}if(_0x40214d[_0x12b758]['end']['x']!==_0x1f98c7[_0x12b758]['end']['x']||_0x40214d[_0x12b758]['end']['y']!==_0x1f98c7[_0x12b758]['end']['y']){return![];}}return!![];}class Point{constructor(_0x14eb8e,_0x204537){this['x']=_0x14eb8e;this['y']=_0x204537;}['equals'](_0x45caf1,_0x57ff2f){return this['x']===_0x45caf1&&this['y']===_0x57ff2f;}};class Loader{['load'](){this['streets']=['g0000','r0001','r0005','r0009','r0013','r0017','r0021','r0045','r0049','r0053','r0057','r0061','r0065','r0069','r0073','r0077','r0081','r0085'];this['houses']=['h0001','h0005','h0009','h0013','h0017','h0021','h0025','h0029','h0033','h0037','h0041','h0045','h0049','h0053','h0057','h0061','h0065','h0069','h0073','h0077','h0081','h0085','h0089','h0093','h0097','h0101','h0105','h0109','h0113','h0117','h0121','h0125','h0129','h0133','h0137','h0141','h0145','h0149','h0153','h0157','h0161','h0165','h0169','h0173','h0177','h0181','h0185','h0189','h0193','h0197','h0201','h0205','h0209','h0213','h0217','h0221','h0225','h0229','h0233','h0237','h0241','h0245','h0249','h0253'];this['trees']=['t01','t02','t03','t04','t05','t06','t07','t08','t09','t10','t11'];this['cars']=['v01','v02','v03','v04','v05','v06','v07','v08','v09','v10','v11','v12'];this['trams']=['v00'];this['streets']['forEach'](function(_0x112ac4){game['load']['image'](_0x112ac4,'city/img/'+_0x112ac4+'.png');});this['houses']['forEach'](function(_0x23fdb0){game['load']['image'](_0x23fdb0,'city/img/'+_0x23fdb0+'.png');});this['trees']['forEach'](function(_0x308b67){game['load']['image'](_0x308b67,'city/img/'+_0x308b67+'.png');});this['cars']['forEach'](function(_0x5df22a){game['load']['spritesheet'](_0x5df22a,'city/img/'+_0x5df22a+'.png',config['Car']['imgSize'],config['Car']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Car']['numTypes']);});this['trams']['forEach'](function(_0x3d91c7){game['load']['spritesheet'](_0x3d91c7,'city/img/'+_0x3d91c7+'.png',config['Tram']['imgSize'],config['Tram']['imgSize'],config['Vehicle']['headingOrder']['length']*config['Tram']['numTypes']);});}};class Trees{constructor(_0x55e550,_0x29f18b){this['tile']=_0x55e550;this['treeImages']=_0x29f18b;this['trees']=[];this['sprites']=[];}['generateTrees'](){for(var _0x19d638=0x0;_0x19d638<config['Tree']['numTrees'];_0x19d638++){var _0x4dc265=this['newTree']();if(_0x4dc265!==null){this['trees']['push'](_0x4dc265);}}this['trees']['sort'](function(_0x5c3326,_0x41dffb){return _0x5c3326['y']-_0x41dffb['y'];});}['newTree'](){var _0x2ddabf=this['treeImages'][Math['floor'](Math['random']()*this['treeImages']['length'])];var _0x45b9e6=game['cache']['getImage'](_0x2ddabf);var _0x22f475=this['tile']['imgX']+Math['floor'](Math['random']()*(config['Tile']['width']-_0x45b9e6['width']));var _0x5ea1ff=this['tile']['imgY']+Math['floor'](Math['random']()*config['Tile']['height'])-_0x45b9e6['height'];var _0x51a098=_0x22f475+Math['floor'](_0x45b9e6['width']/0x2);var _0x1c9bc3=_0x5ea1ff+_0x45b9e6['height'];if(this['tile']['inside'](_0x51a098,_0x1c9bc3,config['Tree']['insideFactor'])){return{'y':_0x1c9bc3,'tree':_0x2ddabf,'imgX':_0x22f475,'imgY':_0x5ea1ff};}return null;}['draw'](_0x5a57c5){for(var _0x46aa72 of this['trees']){this['sprites']['push'](game['add']['image'](_0x46aa72['imgX'],_0x46aa72['imgY'],_0x46aa72['tree']));}this['sprites']['forEach'](_0x3badb3=>_0x5a57c5['add'](_0x3badb3));}['remove'](){this['sprites']['forEach'](_0x34db44=>_0x34db44['destroy']());}};class Tracks{constructor(_0x2bc4d6){this['tile']=_0x2bc4d6;this['track']={};this['newTrack']={};this['trackPoints']=null;this['headsFrom']=[];this['headsTo']=[];this['lineSegments']=[];}['generate'](_0x1fb150){if(this['tile']['isHouse']()){return;}this['newTrack']={};if(_0x1fb150['length']===0x1&&_0x1fb150[0x0]===this['tile']['hash']){this['newTrack'][0x3c]=[0xf0];this['newTrack'][0x78]=[0x12c];this['newTrack'][0xf0]=[0x3c];this['newTrack'][0x12c]=[0x78];return;}var _0x1a16a4=[];var _0x3dedef=_0x1fb150['indexOf'](this['tile']['hash']);while(_0x3dedef!=-0x1){_0x1a16a4['push'](_0x3dedef);_0x3dedef=_0x1fb150['indexOf'](this['tile']['hash'],_0x3dedef+0x1);}for(_0x3dedef of _0x1a16a4){var _0x1e27d5=_0x3dedef+0x1;var _0xa084f=_0x3dedef-0x1;if(_0x1e27d5===_0x1fb150['length']){_0x1e27d5=0x0;}if(_0xa084f===-0x1){_0xa084f=_0x1fb150['length']-0x1;}var _0x1f250e=null;var _0xd094d2=null;if(_0x1fb150[_0xa084f]in this['tile']['neighbourConnections']&&_0x1fb150[_0x1e27d5]in this['tile']['neighbourConnections']){_0x1f250e=this['tile']['neighbourConnections'][_0x1fb150[_0xa084f]];_0xd094d2=this['tile']['neighbourConnections'][_0x1fb150[_0x1e27d5]];}else if(_0x1fb150[_0xa084f]in this['tile']['neighbourConnections']){_0x1f250e=this['tile']['neighbourConnections'][_0x1fb150[_0xa084f]];_0xd094d2=normalizeAngle(_0x1f250e+0xb4);}else if(_0x1fb150[_0x1e27d5]in this['tile']['neighbourConnections']){_0xd094d2=this['tile']['neighbourConnections'][_0x1fb150[_0x1e27d5]];_0x1f250e=normalizeAngle(_0xd094d2+0xb4);}if(_0xd094d2!==null){if(_0x1f250e in this['newTrack']){this['newTrack'][_0x1f250e]['push'](_0xd094d2);}else{this['newTrack'][_0x1f250e]=[_0xd094d2];}}}}['finalize'](){var _0x24fde5=null;for(var _0x32bb92 in this['newTrack']){if(_0x32bb92 in this['track']){for(_0x24fde5=0x0;_0x24fde5<this['newTrack'][_0x32bb92]['length'];_0x24fde5++){this['track'][_0x32bb92]['push'](this['newTrack'][_0x32bb92][_0x24fde5]);}}else{this['track'][_0x32bb92]=this['newTrack'][_0x32bb92];}}for(var _0x1a566b in this['track']){var _0x5aafa5=[];for(_0x24fde5=0x0;_0x24fde5<this['track'][_0x1a566b]['length'];_0x24fde5++){if(!_0x5aafa5['includes'](this['track'][_0x1a566b][_0x24fde5])){_0x5aafa5['push'](this['track'][_0x1a566b][_0x24fde5]);}}this['track'][_0x1a566b]=_0x5aafa5;}this['headsFrom']=Object['keys'](this['track']);this['headsTo']=Object['values'](this['track']);this['newTrack']={};this['lineSegments']=[];for(var _0x1a6e25 in this['track']){var _0x1a566b=normalizeAngle(convertInt(_0x1a6e25)+0xb4);for(var _0x4086eb of this['track'][_0x1a6e25]){var _0xb97bc8=this['tile']['getLaneStartPoint'](_0x1a566b,config['Street']['laneDrive'],0x1);var _0x3e4cd3=this['tile']['getLaneTargetPoint'](_0x4086eb,config['Street']['laneDrive'],0.24);var _0x1660ec=[];if(getTurnDirection(_0x1a566b,_0x4086eb)===-0x1){_0x1660ec['push'](new Phaser['Line'](Math['round'](_0xb97bc8['x']),Math['round'](_0xb97bc8['y']),Math['round'](this['tile']['x']),Math['round'](this['tile']['y'])));_0x1660ec['push'](new Phaser['Line'](Math['round'](this['tile']['x']),Math['round'](this['tile']['y']),Math['round'](_0x3e4cd3['x']),Math['round'](_0x3e4cd3['y'])));}else{_0x1660ec['push'](new Phaser['Line'](Math['round'](_0xb97bc8['x']),Math['round'](_0xb97bc8['y']),Math['round'](_0x3e4cd3['x']),Math['round'](_0x3e4cd3['y'])));}this['lineSegments']['push'](_0x1660ec);}}}['abort'](){this['newTrack']={};}['addSingleTrack'](_0x5203f5,_0x379a1b){var _0x4e7005=normalizeAngle(convertInt(_0x5203f5)+0xb4);for(var _0x5e80f6=-0x1;_0x5e80f6<=0x1;_0x5e80f6+=0x2){var _0x3a511c=this['tile']['getLaneStartPoint'](_0x4e7005,config['Street']['laneDrive']+_0x5e80f6*config['Track']['width']/0x2,0x1);var _0x3731e6=this['tile']['getLaneStartPoint'](_0x4e7005,config['Street']['laneDrive']+_0x5e80f6*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x59f2ce=this['tile']['getLaneTargetPoint'](_0x379a1b,config['Street']['laneDrive']+_0x5e80f6*config['Track']['width']/0x2,config['Track']['lanePointFactor']);var _0x2ffb87=this['tile']['getLaneTargetPoint'](_0x379a1b,config['Street']['laneDrive']+_0x5e80f6*config['Track']['width']/0x2,0x1);if(_0x4e7005===_0x379a1b){this['trackPoints']['moveTo'](_0x3a511c['x'],_0x3a511c['y']);this['trackPoints']['lineTo'](_0x2ffb87['x'],_0x2ffb87['y']);}else{var _0x443984=getCurve(_0x3731e6,_0x59f2ce,_0x4e7005,_0x379a1b,config['Track']['bezierFactor'])['getPath'](config['Track']['curveFactor']);this['trackPoints']['moveTo'](_0x3a511c['x'],_0x3a511c['y']);this['trackPoints']['lineTo'](_0x443984[0x0]['x'],_0x443984[0x0]['y']);for(var _0x2d0c76 of _0x443984){this['trackPoints']['lineTo'](_0x2d0c76['x'],_0x2d0c76['y']);}this['trackPoints']['lineTo'](_0x2ffb87['x'],_0x2ffb87['y']);}}}['getRandomConnection'](){return this['headsTo'][Math['floor'](Math['random']()*this['headsTo']['length'])];}['hasTracks'](){return this['headsFrom']['length']>0x0;}['getTrackKeys'](){return Object['keys'](this['track']);}['getLineSegments'](){return this['lineSegments'];}['isNotIntersecting'](){if(this['isDeadEnd']()){return![];}if(this['tile']['linesIntersectInside'](this['lineSegments'])){return![];}return!![];}['isDeadEnd'](){for(var _0x24b800 in this['track']){for(var _0x5890de of this['track'][_0x24b800]){if(_0x5890de===convertInt(_0x24b800)){return!![];}}}return![];}['isStraight'](){var _0x4f72b6=this['headsFrom']['map'](_0x81c0ae=>convertInt(_0x81c0ae));if(_0x4f72b6['length']>0x2){return![];}for(var _0xa326f2 in this['track']){if(this['track'][_0xa326f2]['length']>0x1){return![];}if(normalizeAngle(convertInt(_0xa326f2)+0xb4)!==convertInt(this['track'][_0xa326f2])){return![];}if(_0x4f72b6['length']===0x2&&!_0x4f72b6['includes'](this['track'][_0xa326f2][0x0])){return![];}}return!![];}['getStraights'](){if(this['isStraight']()){return Object['keys'](this['track'])['map'](_0x428ccf=>normalizeAngle(convertInt(_0x428ccf)+0xb4));}return null;}['getHeadsFrom'](_0xf730bd){if(_0xf730bd in this['track']){return this['track'][_0xf730bd];}return null;}['draw'](_0x16a7da){if(this['trackPoints']!==null){_0x16a7da['removeChild'](this['trackPoints']);this['trackPoints']['destroy']();}if(this['hasTracks']()||Object['keys'](this['newTrack'])['length']>0x0){this['trackPoints']=new Phaser['Graphics'](game,0x0,0x0);var _0x3d98e4=null;var _0x577a5d=null;var _0x1a3e65=null;this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['color']),0x1);for(_0x3d98e4 in this['track']){_0x1a3e65=this['track'][_0x3d98e4];for(_0x577a5d of _0x1a3e65){this['addSingleTrack'](_0x3d98e4,_0x577a5d);}}this['trackPoints']['lineStyle'](0x1,Phaser['Color']['hexToRGB'](config['Track']['activeColor']),0x1);for(_0x3d98e4 in this['newTrack']){_0x1a3e65=this['newTrack'][_0x3d98e4];for(_0x577a5d of _0x1a3e65){this['addSingleTrack'](_0x3d98e4,_0x577a5d);}}_0x16a7da['add'](this['trackPoints']);}}['highlight'](_0x5400ff,_0xcfce3f){if(_0x5400ff===null&&_0xcfce3f===null){for(var _0x5ce466 in this['track']){this['newTrack'][_0x5ce466]=this['track'][_0x5ce466]['slice'](0x0);}}else if(_0xcfce3f===null){this['newTrack'][_0x5400ff]=this['track'][_0x5400ff]['slice'](0x0);}else{var _0x1099f0=[_0xcfce3f];if(_0x5400ff in this['newTrack']){_0x1099f0=_0x1099f0['concat'](this['newTrack'][_0x5400ff]);}this['newTrack'][_0x5400ff]=_0x1099f0;}}};class TramStop{constructor(_0x32cad9){this['tile']=_0x32cad9;this['canvas']=null;}['draw'](_0x280352){if(this['canvas']!==null){_0x280352['removeChild'](this['canvas']);this['canvas']['destroy']();}if(_0x280352!==null){this['canvas']=new Phaser['Graphics'](game,this['tile']['imgX'],this['tile']['imgY']);var _0x5d2215=this['tile']['getStraightTracks']();for(var _0x103fd6 of _0x5d2215){var _0x3afd27=this['tile']['getClosestPointInLane'](this['tile']['x'],this['tile']['y'],_0x103fd6,config['Stop']['lane']);_0x3afd27['x']-=this['tile']['imgX'];_0x3afd27['y']-=this['tile']['imgY'];var _0x2fec7c=Math['sin'](_0x103fd6*Math['PI']/0xb4)*0x14;var _0x465b2e=-Math['cos'](_0x103fd6*Math['PI']/0xb4)*0x14;if(_0x103fd6===0x78||_0x103fd6===0x12c){_0x3afd27['x']-=_0x2fec7c;_0x3afd27['y']-=_0x465b2e;}_0x2fec7c=Math['sin'](_0x103fd6*Math['PI']/0xb4)*config['Stop']['length'];_0x465b2e=-Math['cos'](_0x103fd6*Math['PI']/0xb4)*config['Stop']['length'];var _0x24c20c=Math['sin']((0xb4-_0x103fd6)*Math['PI']/0xb4)*config['Stop']['width'];var _0x399b56=-Math['cos']((0xb4-_0x103fd6)*Math['PI']/0xb4)*config['Stop']['width'];this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color1']));var _0x3cc06d=new Phaser['Point'](_0x3afd27['x']+_0x24c20c-_0x2fec7c,_0x3afd27['y']+0x1+_0x399b56-_0x465b2e);var _0x2a6cb7=new Phaser['Point'](_0x3afd27['x']+_0x24c20c+_0x2fec7c,_0x3afd27['y']+0x1+_0x399b56+_0x465b2e);var _0x295cbc=new Phaser['Point'](_0x3afd27['x']-_0x24c20c+_0x2fec7c,_0x3afd27['y']+0x1-_0x399b56+_0x465b2e);var _0x5f53c1=new Phaser['Point'](_0x3afd27['x']-_0x24c20c-_0x2fec7c,_0x3afd27['y']+0x1-_0x399b56-_0x465b2e);this['canvas']['drawPolygon']([_0x3cc06d,_0x2a6cb7,_0x295cbc,_0x5f53c1]);this['canvas']['endFill']();this['canvas']['beginFill'](Phaser['Color']['hexToRGB'](config['Stop']['color2']));_0x3cc06d=new Phaser['Point'](_0x3afd27['x']+_0x24c20c-_0x2fec7c,_0x3afd27['y']-0x1+_0x399b56-_0x465b2e);_0x2a6cb7=new Phaser['Point'](_0x3afd27['x']+_0x24c20c+_0x2fec7c,_0x3afd27['y']-0x1+_0x399b56+_0x465b2e);_0x295cbc=new Phaser['Point'](_0x3afd27['x']-_0x24c20c+_0x2fec7c,_0x3afd27['y']-0x1-_0x399b56+_0x465b2e);_0x5f53c1=new Phaser['Point'](_0x3afd27['x']-_0x24c20c-_0x2fec7c,_0x3afd27['y']-0x1-_0x399b56-_0x465b2e);this['canvas']['drawPolygon']([_0x3cc06d,_0x2a6cb7,_0x295cbc,_0x5f53c1]);this['canvas']['endFill']();}_0x280352['add'](this['canvas']);}}};class TramLine{constructor(){this['NEIGHBOUR_STATUS']={'MULTIPLE_PATHS':0x0,'NO_NEIGHBOUR':0x1};this['tiles']=[];this['closed']=![];}['isEmpty'](){return this['tiles']['length']===0x0;}['isAllowed'](_0x16df86){if(!_0x16df86['hasTracks']()){return![];}var _0x312e7b=this['tiles']['length'];var _0x6fc8a9=null;if(_0x312e7b>0x1){_0x6fc8a9=this['tiles'][_0x312e7b-0x1]['getNeighbourConnection'](this['tiles'][_0x312e7b-0x2]);}else{_0x6fc8a9=_0x16df86['getNeighbourConnection'](this['tiles'][_0x312e7b-0x1]);}var _0xdd79ad=this['tiles'][_0x312e7b-0x1]['getNeighbourConnection'](_0x16df86);if(_0xdd79ad===null){return![];}var _0x5ac0f6=this['tiles'][_0x312e7b-0x1]['getTrackHeadsFrom'](_0x6fc8a9);if(_0x5ac0f6===null){return![];}if(!_0x5ac0f6['includes'](_0xdd79ad)){return![];}if(_0x16df86['getTrackHeadsFrom'](normalizeAngle(_0xdd79ad+0xb4))===null){return![];}return!![];}['getNextUniqueNeighbour'](){var _0x202f16=this['tiles']['length'];var _0x358d37=null;if(_0x202f16>0x1){_0x358d37=this['tiles'][_0x202f16-0x1]['getNeighbourConnection'](this['tiles'][_0x202f16-0x2]);}else{var _0x51e528=this['tiles'][_0x202f16-0x1]['tracks']['getTrackKeys']();if(_0x51e528['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}_0x358d37=_0x51e528[0x0];}var _0xf4cce7=this['tiles'][_0x202f16-0x1]['getTrackHeadsFrom'](_0x358d37);if(_0xf4cce7===null){return this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR'];}if(_0xf4cce7['length']>0x1){return this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS'];}return this['tiles'][_0x202f16-0x1]['getNeighbourAtHead'](_0xf4cce7[0x0]);}['getTiles'](){return this['tiles'];}['abort'](){this['tiles']['forEach'](_0x2a8d6a=>_0x2a8d6a['abortTrack']());this['tiles']=[];this['closed']=![];}['proceed'](_0x4fbb88){if(this['isEmpty']()){this['tiles']=[_0x4fbb88];this['tiles'][0x0]['tracks']['highlight'](null,null);var _0x49db09=this['getNextUniqueNeighbour']();if(_0x49db09!==this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){this['proceed'](_0x49db09);}return;}var _0x43feda=this['tiles']['length'];this['tiles'][_0x43feda-0x1]['abortTrack']();if(_0x43feda>0x1){this['tiles'][_0x43feda-0x1]['tracks']['highlight'](this['tiles'][_0x43feda-0x1]['getNeighbourConnection'](this['tiles'][_0x43feda-0x2]),this['tiles'][_0x43feda-0x1]['getNeighbourConnection'](_0x4fbb88));}else{this['tiles'][_0x43feda-0x1]['tracks']['highlight'](_0x4fbb88['getNeighbourConnection'](this['tiles'][_0x43feda-0x1]),this['tiles'][_0x43feda-0x1]['getNeighbourConnection'](_0x4fbb88));}this['tiles']['push'](_0x4fbb88);while(!![]){var _0x49db09=this['getNextUniqueNeighbour']();_0x43feda=this['tiles']['length'];if(_0x49db09===this['NEIGHBOUR_STATUS']['NO_NEIGHBOUR']||_0x49db09===null){this['abort']();break;}else if(_0x49db09===this['NEIGHBOUR_STATUS']['MULTIPLE_PATHS']){if(this['isAllowed'](this['tiles'][0x0])){this['closed']=!![];}else{this['tiles'][_0x43feda-0x1]['tracks']['highlight'](this['tiles'][_0x43feda-0x1]['getNeighbourConnection'](this['tiles'][_0x43feda-0x2]),null);}break;}this['tiles'][_0x43feda-0x1]['tracks']['highlight'](this['tiles'][_0x43feda-0x1]['getNeighbourConnection'](this['tiles'][_0x43feda-0x2]),this['tiles'][_0x43feda-0x1]['getNeighbourConnection'](_0x49db09));if(_0x49db09['equals'](this['tiles'][0x1])&&this['tiles'][_0x43feda-0x1]['equals'](this['tiles'][0x0])){this['tiles']['pop']();this['closed']=!![];break;}if(this['tiles']['length']>config['Tram']['maxLineLength']){this['abort']();break;}this['tiles']['push'](_0x49db09);}}static['show'](_0x15a2c7){for(var _0x5e67af=0x0;_0x5e67af<_0x15a2c7['length'];_0x5e67af++){var _0x10103a=_0x5e67af-0x1;var _0x413610=_0x5e67af+0x1;if(_0x10103a<0x0){_0x10103a=_0x15a2c7['length']-0x1;}if(_0x413610>_0x15a2c7['length']-0x1){_0x413610=0x0;}_0x15a2c7[_0x5e67af]['tracks']['highlight'](_0x15a2c7[_0x5e67af]['getNeighbourConnection'](_0x15a2c7[_0x10103a]),_0x15a2c7[_0x5e67af]['getNeighbourConnection'](_0x15a2c7[_0x413610]));}}}class Tile{constructor(_0x3f1027,_0x5e2744,_0x36ae66,_0x21fb52){this['fileId']=_0x3f1027;this['hash']=_0x5e2744;this['imgX']=_0x36ae66;this['imgY']=_0x21fb52;this['x']=this['imgX']+Math['floor'](config['Tile']['width']/0x2);this['y']=this['imgY']+Math['floor'](config['Tile']['height']/0x2);this['neighbours']=[];this['streetNeighbours']=[];this['neighbourConnections']={};this['lineSegments']=[];this['tracks']=new Tracks(this);this['tramstop']=null;this['hover']=null;this['trees']=null;this['vehicles']=[];this['vehicleHashes']=[];}['updateImage'](_0x35c122){this['fileId']=_0x35c122;var _0xd79c88=game['cache']['getImage'](this['fileId']);this['imgY']=this['imgY']+config['Tile']['height']-_0xd79c88['height'];}['draw'](_0x23ff60,_0x599095){if(this['isGrass']()||this['isStreet']()){_0x23ff60['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}else{_0x599095['add'](game['add']['image'](this['imgX'],this['imgY'],this['fileId']));}if(this['trees']!==null){this['trees']['draw'](_0x599095);}this['hover']=new Phaser['Graphics'](game,this['imgX'],this['imgY']);this['hover']['beginFill'](Phaser['Color']['hexToRGB'](config['Tile']['hoverColor']));this['hover']['fillAlpha']=0.5;this['hover']['drawPolygon'](new Phaser['Point'](config['Tile']['width']/0x2,0x0),new Phaser['Point'](config['Tile']['width'],config['Tile']['height']/0x2),new Phaser['Point'](config['Tile']['width']/0x2,config['Tile']['height']),new Phaser['Point'](0x0,config['Tile']['height']/0x2));this['hover']['endFill']();this['hover']['visible']=![];_0x23ff60['add'](this['hover']);}['drawTracks'](_0x4d0050){this['tracks']['draw'](_0x4d0050);if(this['hasTracks']()&&this['trees']!==null){this['trees']['remove']();}}['drawVehicles'](_0x203c4b,_0x3ac1f0){this['vehicles']['forEach'](_0x7e13ad=>_0x7e13ad['draw'](_0x203c4b,_0x3ac1f0));}['drawStop'](_0x48be36){if(this['hasStop']()){this['tramstop']['draw'](_0x48be36);}}['setHover'](_0x341692){this['hover']['visible']=_0x341692;}['addStop'](){this['tramstop']=new TramStop(this);}['equals'](_0x1c1e71){if(_0x1c1e71===null){return![];}return this['hash']===_0x1c1e71['hash'];}['equalsHash'](_0x44f4ee){return this['hash']==_0x44f4ee;}['update'](){this['vehicles']['forEach'](_0x1300c3=>_0x1300c3['update']());}['isGrass'](){return this['fileId']===config['Tile']['grass'];}['isStreet'](){return this['fileId']['startsWith'](config['Tile']['streetPrefix']);}['isHouse'](){return!this['isGrass']()&&!this['isStreet']();}['isStraight'](){return config['Street']['straights']['includes'](this['fileId']);}['isHighway'](){return config['Street']['highways']['includes'](this['fileId']);}['isCurve'](){return config['Street']['curves']['includes'](this['fileId']);}['isStraightOrCurve'](){return this['isStraight']()||this['isCurve']();}['isDeadEnd'](){return config['Street']['deadEnds']['includes'](this['fileId']);}['isStraightTrack'](){if(this['hasTracks']()){return this['tracks']['isStraight']();}return![];}['getStraightTracks'](){if(this['hasTracks']()){return this['tracks']['getStraights']();}return null;}['isNonIntersectingTrack'](){if(this['hasTracks']()){return this['tracks']['isNotIntersecting']();}return!![];}['isDeadEndOrJunctionOrCrossing'](){if(this['isDeadEnd']()){return!![];}if(!this['isStraightOrCurve']()&&!this['isGrass']()){return!![];}if(this['hasTracks']()){if(this['tracks']['isDeadEnd']()){return!![];}var _0xb95f62=this['lineSegments']['concat'](this['tracks']['getLineSegments']());if(this['linesIntersectInside'](_0xb95f62)){return!![];}}return![];}['linesIntersectInside'](_0x2ad3c6){var _0x464247=null;for(var _0x1f604f=0x0;_0x1f604f<_0x2ad3c6['length'];_0x1f604f++){for(var _0x46701f=_0x1f604f+0x1;_0x46701f<_0x2ad3c6['length'];_0x46701f++){if(!linesAreEqual(_0x2ad3c6[_0x1f604f],_0x2ad3c6[_0x46701f])){for(var _0x315f2d of _0x2ad3c6[_0x1f604f]){for(var _0x3bff87 of _0x2ad3c6[_0x46701f]){_0x464247=Phaser['Line']['intersects'](_0x315f2d,_0x3bff87);if(_0x464247!==null&&this['inside'](_0x464247['x'],_0x464247['y'],0.99)){return!![];}}}}}}return![];}['hasStop'](){return this['tramstop']!==null;}['hasTracks'](){return this['tracks']['hasTracks']();}['generateHouse'](_0x5834a4){if(!this['isGrass']()||this['hasTracks']()){return;}var _0x295d79=![];for(var _0x301995 of this['neighbours']){if(_0x301995['isStreet']()&&!_0x301995['isHighway']()){_0x295d79=!![];break;}}if(_0x295d79&&Math['random']()<config['Tile']['probHouse']){var _0x2b4fed=_0x5834a4[Math['floor'](Math['random']()*_0x5834a4['length'])];this['updateImage'](_0x2b4fed);}}['generateTrees'](_0x214fc4){if(this['isGrass']()&&!this['hasTracks']()){this['trees']=new Trees(this,_0x214fc4);this['trees']['generateTrees']();}}['generateCars'](_0x274eed){if(this['isStreet']()){var _0x5adfe6=this['getStreetConnections']();var _0x3af174=_0x5adfe6[Math['floor'](Math['random']()*_0x5adfe6['length'])];if(this['hasFreeParkingLot'](_0x3af174)){if(Math['random']()<config['Tile']['probCar']){this['addVehicle'](new Car(this,_0x3af174,_0x274eed,config['Car']['numTypes'],null));}}}}['generateTrack'](_0x4af17a){this['tracks']['generate'](_0x4af17a);}['abortTrack'](){this['tracks']['abort']();}['finalizeTrack'](){this['tracks']['finalize']();if(this['hasStop']()&&!this['isStraightTrack']()){this['tramstop']['draw'](null);this['tramstop']=null;}}['getTrackHeadsFrom'](_0x17e5e5){return this['tracks']['getHeadsFrom'](_0x17e5e5);}['computeAllNeighbours'](_0xaacca4){var _0x4d734b=0xa;for(var _0xb50c7b of _0xaacca4){if(!this['equals'](_0xb50c7b)){if(this['x']+_0x4d734b<_0xb50c7b['x']&&_0xb50c7b['x']<this['x']+config['Tile']['width']-_0x4d734b&&this['y']-config['Tile']['height']+_0x4d734b<_0xb50c7b['y']&&_0xb50c7b['y']<this['y']-_0x4d734b){this['neighbours']['push'](_0xb50c7b);}else if(this['x']+_0x4d734b<_0xb50c7b['x']&&_0xb50c7b['x']<this['x']+config['Tile']['width']-_0x4d734b&&this['y']+_0x4d734b<_0xb50c7b['y']&&_0xb50c7b['y']<this['y']+config['Tile']['height']-_0x4d734b){this['neighbours']['push'](_0xb50c7b);}else if(this['x']-config['Tile']['width']+_0x4d734b<_0xb50c7b['x']&&_0xb50c7b['x']<this['x']-_0x4d734b&&this['y']+_0x4d734b<_0xb50c7b['y']&&_0xb50c7b['y']<this['y']+config['Tile']['height']-_0x4d734b){this['neighbours']['push'](_0xb50c7b);}else if(this['x']-config['Tile']['width']+_0x4d734b<_0xb50c7b['x']&&_0xb50c7b['x']<this['x']-_0x4d734b&&this['y']-config['Tile']['height']+_0x4d734b<_0xb50c7b['y']&&_0xb50c7b['y']<this['y']-_0x4d734b){this['neighbours']['push'](_0xb50c7b);}}}}['computeStreetNeighboursAndConnections'](){for(var _0x263765 of this['neighbours']){if(!_0x263765['isHouse']()){var _0x141774=null;if(_0x263765['x']>this['x']&&_0x263765['y']<this['y']){_0x141774=0x3c;}else if(_0x263765['x']>this['x']&&_0x263765['y']>this['y']){_0x141774=0x78;}else if(_0x263765['x']<this['x']&&_0x263765['y']>this['y']){_0x141774=0xf0;}else if(_0x263765['x']<this['x']&&_0x263765['y']<this['y']){_0x141774=0x12c;}this['neighbourConnections'][_0x263765['hash']]=convertInt(_0x141774);if(_0x263765['isStreet']()&&this['isConnectedTo'](_0x141774)){if(!this['isStraightOrCurve']()&&!_0x263765['isStraightOrCurve']()){error('Cannot\x20handle\x20neighbouring\x20junctions,\x20crossings,\x20or\x20dead\x20ends.',this,null);}this['streetNeighbours']['push'](_0x263765);}}}}['computeLineSegments'](){var _0x24ef5c=this['getStreetConnections']();if(_0x24ef5c['length']===0x2){for(var _0x27a7a5=0x0;_0x27a7a5<0x2;_0x27a7a5++){var _0x422c0e=normalizeAngle(_0x24ef5c[_0x27a7a5]+0xb4);var _0xe38116=_0x24ef5c[0x1-_0x27a7a5];var _0x115dfc=this['getLaneStartPoint'](_0x422c0e,config['Street']['laneDrive'],0x1);var _0x19e139=this['getLaneTargetPoint'](_0xe38116,config['Street']['laneDrive'],0.24);var _0x40d69b=[];if(getTurnDirection(_0x422c0e,_0xe38116)===-0x1){_0x40d69b['push'](new Phaser['Line'](Math['round'](_0x115dfc['x']),Math['round'](_0x115dfc['y']),Math['round'](this['x']),Math['round'](this['y'])));_0x40d69b['push'](new Phaser['Line'](Math['round'](this['x']),Math['round'](this['y']),Math['round'](_0x19e139['x']),Math['round'](_0x19e139['y'])));}else{_0x40d69b['push'](new Phaser['Line'](Math['round'](_0x115dfc['x']),Math['round'](_0x115dfc['y']),Math['round'](_0x19e139['x']),Math['round'](_0x19e139['y'])));}this['lineSegments']['push'](_0x40d69b);}}}['getNeighbourConnection'](_0x37b6bb){var _0xba7840=_0x37b6bb;if(typeof _0x37b6bb!=='string'){_0xba7840=_0x37b6bb['hash'];}if(!(_0xba7840 in this['neighbourConnections'])){return null;}return this['neighbourConnections'][_0xba7840];}['getNeighbourAtHead'](_0x21f194){var _0xdc6bd5=this['neighbours']['filter'](_0x3fe4ac=>this['neighbourConnections'][_0x3fe4ac['hash']]===_0x21f194);if(_0xdc6bd5['length']!==0x1){return null;}return _0xdc6bd5[0x0];}['isTrackNeighbourOf'](_0x27422e){return this['neighbours']['includes'](_0x27422e)&&!_0x27422e['isHouse']();}['isConnectedTo'](_0x31ce8d){var _0x1b349a=parseInt(this['fileId']['substring'](0x1,0x5));if([0x1,0x5,0x9,0x15,0x2d,0x31,0x35,0x4d,0x55]['includes'](_0x1b349a)){if(convertInt(_0x31ce8d)===0x12c){return!![];}}if([0x5,0x9,0xd,0x11,0x2d,0x35,0x39,0x41,0x51]['includes'](_0x1b349a)){if(convertInt(_0x31ce8d)===0x3c){return!![];}}if([0x1,0x9,0xd,0x15,0x2d,0x39,0x3d,0x45,0x55]['includes'](_0x1b349a)){if(convertInt(_0x31ce8d)===0x78){return!![];}}if([0x1,0x5,0xd,0x11,0x2d,0x31,0x3d,0x49,0x51]['includes'](_0x1b349a)){if(convertInt(_0x31ce8d)===0xf0){return!![];}}return![];}['getStreetConnections'](){var _0x46f89b=[0x3c,0x78,0xf0,0x12c];return _0x46f89b['filter'](_0x2e386b=>this['isConnectedTo'](_0x2e386b));}['inside'](_0x21f12a,_0x258189,_0x24bdd1){_0x24bdd1=typeof _0x24bdd1==='undefined'?0x1:_0x24bdd1;var _0x236bf2=this['x']-_0x21f12a;var _0x3ffeda=this['y']-_0x258189;var _0x28b0b4=config['Tile']['width']/config['Tile']['height'];return Math['abs'](_0x236bf2+_0x28b0b4*_0x3ffeda)<_0x24bdd1*config['Tile']['width']*0.5&&Math['abs'](_0x236bf2-_0x28b0b4*_0x3ffeda)<_0x24bdd1*config['Tile']['width']*0.5;}['nearCenter'](_0x246f2d,_0x3dbce7){return this['inside'](_0x246f2d,_0x3dbce7,config['Street']['centerSizeFactor']);}['centerAhead'](_0x42f682,_0x3013f3){if(0x0<_0x3013f3&&_0x3013f3<0xb4){return _0x42f682<this['x'];}return _0x42f682>this['x'];}['getLane'](_0x26efc5,_0x3ef0a9){var _0xcd433a=Math['cos'](_0x26efc5*Math['PI']/0xb4);var _0x296f49=Math['sin'](_0x26efc5*Math['PI']/0xb4);var _0x187d73=this['x'];var _0x16a6bf=this['y'];if(convertInt(_0x26efc5)===0x3c||convertInt(_0x26efc5)===0x78){_0x16a6bf+=_0x3ef0a9;}else{_0x16a6bf-=_0x3ef0a9;}return{'nx':_0xcd433a,'ny':_0x296f49,'px':_0x187d73,'py':_0x16a6bf};}['getClosestPointInLane'](_0x533752,_0x1fc5e8,_0x5694e3,_0x1385f4){var _0x2731f7=this['getLane'](_0x5694e3,_0x1385f4);var _0x284ba6=_0x2731f7['nx']**0x2*_0x2731f7['px']+_0x2731f7['ny']**0x2*_0x533752+_0x2731f7['nx']*_0x2731f7['ny']*(_0x2731f7['py']-_0x1fc5e8);var _0x25f7d4=_0x2731f7['ny']**0x2*_0x2731f7['py']+_0x2731f7['nx']**0x2*_0x1fc5e8+_0x2731f7['nx']*_0x2731f7['ny']*(_0x2731f7['px']-_0x533752);return new Point(_0x284ba6,_0x25f7d4);}['getDistanceToLane'](_0xa0ff34,_0x44eb6b,_0x979b90,_0x57d223){var _0x521c1c=this['getClosestPointInLane'](_0xa0ff34,_0x44eb6b,_0x979b90,_0x57d223);return Math['sqrt']((_0xa0ff34-_0x521c1c['x'])**0x2+(_0x44eb6b-_0x521c1c['y'])**0x2);}['getTileBoundaryPoint'](_0x5e3baf,_0x49aeeb,_0x4b2141,_0x4aee71){var _0x2d13a1=this['x'];var _0x1ab007=this['y'];if(convertInt(_0x4b2141)===0x3c||convertInt(_0x4b2141)===0x78){_0x1ab007+=_0x4aee71;_0x49aeeb+=_0x4aee71;}else{_0x1ab007-=_0x4aee71;_0x49aeeb-=_0x4aee71;}var _0x376412=new Phaser['Line'](_0x2d13a1,_0x1ab007,_0x5e3baf,_0x49aeeb);var _0x2b3bf4=null;for(var _0x4b2141 of[0x3c,0x78,0xf0,0x12c]){switch(_0x4b2141){case 0x3c:_0x2b3bf4=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0x78:_0x2b3bf4=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']+config['Tile']['width']/0x2,this['y']);break;case 0xf0:_0x2b3bf4=new Phaser['Line'](this['x'],this['y']+config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;case 0x12c:_0x2b3bf4=new Phaser['Line'](this['x'],this['y']-config['Tile']['height']/0x2,this['x']-config['Tile']['width']/0x2,this['y']);break;}var _0x3146d1=Phaser['Line']['intersects'](_0x376412,_0x2b3bf4);if(_0x3146d1!==null){return _0x3146d1;}}return null;}['getLaneTargetPoint'](_0xfa1de1,_0x40757f,_0x35abb3){var _0x37eabd=_0x35abb3*config['Tile']['width'];var _0xf48103=this['x']+Math['sin'](_0xfa1de1*Math['PI']/0xb4)*_0x37eabd;var _0x6cf3ca=this['y']-Math['cos'](_0xfa1de1*Math['PI']/0xb4)*_0x37eabd;if(_0x35abb3>=0x1){return this['getTileBoundaryPoint'](_0xf48103,_0x6cf3ca,_0xfa1de1,_0x40757f);}return this['getClosestPointInLane'](_0xf48103,_0x6cf3ca,_0xfa1de1,_0x40757f);}['getLaneStartPoint'](_0x131720,_0x461f4d,_0x4c82fc){var _0x204a3b=_0x4c82fc*config['Tile']['width'];var _0x176482=this['x']-Math['sin'](_0x131720*Math['PI']/0xb4)*_0x204a3b;var _0x29bbf1=this['y']+Math['cos'](_0x131720*Math['PI']/0xb4)*_0x204a3b;if(_0x4c82fc>=0x1){return this['getTileBoundaryPoint'](_0x176482,_0x29bbf1,_0x131720,_0x461f4d);}return this['getClosestPointInLane'](_0x176482,_0x29bbf1,_0x131720,_0x461f4d);}['addVehicle'](_0x15067d){this['vehicles']['push'](_0x15067d);this['vehicleHashes']['push'](_0x15067d['hash']);}['removeVehicle'](_0x1d834b){var _0x9c5c2a=this['vehicleHashes']['indexOf'](_0x1d834b['hash']);if(_0x9c5c2a>=0x0){this['vehicles']['splice'](_0x9c5c2a,0x1);this['vehicleHashes']['splice'](_0x9c5c2a,0x1);}}['clickVehicle'](_0x50c91a,_0x59fa65){for(var _0x4190b4 of this['vehicles']){if(_0x4190b4['isTram']()&&_0x4190b4['click'](_0x50c91a,_0x59fa65)){TramLine['show'](_0x4190b4['getLine']());return _0x4190b4;}}return null;}['getVehicleIndex'](_0xffd646){return this['vehicleHashes']['indexOf'](_0xffd646['hash']);}['onlySameVehicleType'](){if(this['vehicles']['length']>0x0){for(var _0x298dfe=0x1;_0x298dfe<this['vehicles']['length'];_0x298dfe++){if(this['vehicles'][_0x298dfe]['isTram']()!==this['vehicles'][0x0]['isTram']()){return![];}}}return!![];}['hasFreeParkingLot'](_0x5b82c2){if(!this['isStraight']()){return![];}if(this['isHighway']()){return![];}if(this['isDeadEndOrJunctionOrCrossing']()){return![];}if(this['hasStop']()){return![];}if(!this['isConnectedTo'](_0x5b82c2)){return![];}for(var _0x4568db of this['vehicles']){if(_0x4568db['isParking']()&&_0x4568db['getHead']()===convertInt(_0x5b82c2)){return![];}}return!![];}};class Map{constructor(){this['tiles']=[];this['tileRowId']=[];this['masterGroup']=null;this['rowGroupsGround']=[];this['rowGroupsHouses']=[];this['nCols']=0x0;this['nRows']=0x0;this['newTrack']=[];this['newLine']=new TramLine();this['selectedVehicle']=null;this['tileHover']=null;}['loadMap'](_0x25a53b){var _0x12668b=_0x25a53b['trim']()['split']('\x0a');this['masterGroup']=game['add']['group']();for(var _0x4b5536=0x0;_0x4b5536<_0x12668b['length'];_0x4b5536++){if(_0x12668b[_0x4b5536]['includes'](',')){var _0x1bdcdf=_0x12668b[_0x4b5536]['split'](',');this['nRows']++;this['nCols']=Math['max'](this['nCols'],_0x1bdcdf['length']);var _0x56bfff=game['add']['group']();var _0x58d609=game['add']['group']();_0x56bfff['yz']=(_0x4b5536-0x1)*config['Tile']['dy'];_0x58d609['yz']=(_0x4b5536-0x1)*config['Tile']['dy']+config['Tile']['height'];this['rowGroupsGround']['push'](_0x56bfff);this['rowGroupsHouses']['push'](_0x58d609);this['masterGroup']['add'](_0x56bfff);this['masterGroup']['add'](_0x58d609);var _0x319bcb=-config['Tile']['dx']*(0x1-_0x4b5536%0x2);for(var _0x21c544=0x0;_0x21c544<_0x1bdcdf['length'];_0x21c544++){var _0x30cb87=_0x1bdcdf[_0x21c544]['trim']();if(_0x30cb87['length']>0x0){var _0x22cd5c=_0x30cb87['substring'](0x0,0x4);var _0x5a4f39=_0x30cb87['substring'](0x4);var _0xb94de1=new Tile(_0x5a4f39,_0x22cd5c,_0x319bcb+0x2*_0x21c544*config['Tile']['dx'],(_0x4b5536-0x1)*config['Tile']['dy']);this['tiles']['push'](_0xb94de1);this['tileRowId']['push'](this['nRows']-0x1);}}}}}['loadTracks'](_0x18e57b){var _0x4e8143=_0x18e57b['trim']()['split']('\x0a');for(var _0x50a966=0x0;_0x50a966<_0x4e8143['length'];_0x50a966++){if(_0x4e8143[_0x50a966]['includes'](',')){var _0x2adb96=_0x4e8143[_0x50a966]['split'](',');for(var _0x2405cc of _0x2adb96){for(var _0x2d3bf0 of this['tiles']){if(_0x2d3bf0['equalsHash'](_0x2405cc)){_0x2d3bf0['generateTrack'](_0x2adb96);_0x2d3bf0['finalizeTrack']();}}}}}}['loadStops'](_0x24c245){var _0x3ff64e=_0x24c245['trim']();if(_0x3ff64e['includes'](',')){var _0x2b7a3e=_0x3ff64e['split'](',');for(var _0x4e8853 of _0x2b7a3e){for(var _0x319be2 of this['tiles']){if(_0x319be2['equalsHash'](_0x4e8853)){_0x319be2['addStop']();}}}}}['loadTrams'](_0x5f4039,_0x57ab26){var _0x126c43=_0x5f4039['trim']()['split']('\x0a');for(var _0x2aa46c=0x0;_0x2aa46c<_0x126c43['length'];_0x2aa46c++){if(_0x126c43[_0x2aa46c]['includes'](',')){var _0x28dd96=_0x126c43[_0x2aa46c]['split'](',');var _0x5777c7=[];for(var _0x592abf of _0x28dd96){for(var _0x2633b6 of this['tiles']){if(_0x2633b6['equalsHash'](_0x592abf)){_0x5777c7['push'](_0x2633b6);}}}if(_0x5777c7['length']>0x1){var _0x11f1a6=Math['ceil'](_0x5777c7['length']/config['Tram']['maxTilesPerTram']);var _0x6ba9e8=getPermutations(_0x5777c7,_0x11f1a6);_0x6ba9e8['forEach'](function(_0x73bd25){_0x73bd25[0x0]['addVehicle'](new Tram(_0x73bd25[0x0],_0x73bd25[0x0]['getNeighbourConnection'](_0x73bd25[0x1]),_0x57ab26,config['Tram']['numTypes'],_0x73bd25));});}}}}['getWidth'](){return 0x2*this['nCols']*config['Tile']['dx']-Math['floor'](config['Tile']['width']/0x2);}['getHeight'](_0x22dea0){return this['nRows']*config['Tile']['dy']-Math['floor'](config['Tile']['height']/0x2);}['initTiles'](){this['tiles']['forEach'](function(_0x48fc67,_0x287c1c,_0xc83151){_0x48fc67['computeAllNeighbours'](_0xc83151);});this['tiles']['forEach'](function(_0x8531cd){_0x8531cd['computeStreetNeighboursAndConnections']();_0x8531cd['computeLineSegments']();});}['generateItems'](_0x147d85,_0x430ab2,_0x1bf10b){this['tiles']['forEach'](function(_0x3ed5ef){_0x3ed5ef['generateHouse'](_0x147d85);_0x3ed5ef['generateTrees'](_0x430ab2);_0x3ed5ef['generateCars'](_0x1bf10b);});}['draw'](){for(var _0x464016=0x0;_0x464016<this['tiles']['length'];_0x464016++){this['tiles'][_0x464016]['draw'](this['rowGroupsGround'][this['tileRowId'][_0x464016]],this['rowGroupsHouses'][this['tileRowId'][_0x464016]]);}this['drawVehicles']();this['drawTracks']();}['drawTracks'](){for(var _0x1e029a=0x0;_0x1e029a<this['tiles']['length'];_0x1e029a++){this['tiles'][_0x1e029a]['drawTracks'](this['rowGroupsGround'][this['tileRowId'][_0x1e029a]]);}this['drawStops']();}['drawVehicles'](){for(var _0xb49a05 of this['tiles']){_0xb49a05['drawVehicles'](this['masterGroup'],disableUI);}}['drawStops'](){for(var _0x54754f=0x0;_0x54754f<this['tiles']['length'];_0x54754f++){this['tiles'][_0x54754f]['drawStop'](this['rowGroupsGround'][this['tileRowId'][_0x54754f]]);}}['update'](){this['tiles']['forEach'](_0x1b2dc3=>_0x1b2dc3['update']());this['masterGroup']['sort']('yz');}['disableTileHover'](){if(this['tileHover']!==null){this['tileHover']['setHover'](![]);}}['newTrackClick'](_0x21d6bd,_0x4ece38,_0x1df497){for(var _0x2a3e94 of this['tiles']){if(_0x2a3e94['inside'](_0x21d6bd,_0x4ece38)){this['disableTileHover']();if(!_0x2a3e94['isHouse']()&&(this['newTrack']['length']===0x0||this['newTrack'][this['newTrack']['length']-0x1]['isTrackNeighbourOf'](_0x2a3e94))){if(_0x1df497){this['tileHover']=_0x2a3e94;this['tileHover']['setHover'](!![]);return!![];}this['newTrack']['push'](_0x2a3e94);var _0x1f17e5=this['newTrack']['map'](_0x21d6bd=>_0x21d6bd['hash']);_0x2a3e94['generateTrack'](_0x1f17e5);if(this['newTrack']['length']>0x1){this['newTrack'][0x0]['generateTrack'](_0x1f17e5);this['newTrack'][this['newTrack']['length']-0x2]['generateTrack'](_0x1f17e5);}this['drawTracks']();return!![];}return![];}}return![];}['newStopClick'](_0x1f0383,_0x528f73,_0x5de550){for(var _0x159132 of this['tiles']){if(_0x159132['inside'](_0x1f0383,_0x528f73)){this['disableTileHover']();if(_0x159132['hasTracks']()&&_0x159132['isStraightTrack']()&&(_0x159132['isStraight']()||_0x159132['isGrass']())&&!_0x159132['hasStop']()){if(_0x5de550){this['tileHover']=_0x159132;this['tileHover']['setHover'](!![]);return!![];}_0x159132['addStop']();console['log'](_0x159132['hash']);this['drawStops']();return!![];}return![];}}return![];}['newTramClick'](_0x110a63,_0x506425,_0x2059a1,_0x525d75){for(var _0x1b9a28 of this['tiles']){if(_0x1b9a28['inside'](_0x110a63,_0x506425)){this['disableTileHover']();if(_0x1b9a28['hasTracks']()&&(this['newLine']['isEmpty']()&&_0x1b9a28['isStraightTrack']()||!this['newLine']['isEmpty']()&&this['newLine']['isAllowed'](_0x1b9a28))){if(_0x2059a1){this['tileHover']=_0x1b9a28;this['tileHover']['setHover'](!![]);return!![];}this['newLine']['proceed'](_0x1b9a28);this['drawTracks']();if(this['newLine']['closed']){this['newTramFinalize'](_0x525d75);}return!![];}return![];}}return![];}['showTramClick'](_0x411989,_0x28a83c){this['tiles']['forEach'](_0x4fda2e=>_0x4fda2e['abortTrack']());var _0xb6aa82=![];this['selectedVehicle']=null;for(var _0xbd1b92 of this['tiles']){var _0x839b0c=_0xbd1b92['clickVehicle'](_0x411989,_0x28a83c);if(_0x839b0c!==null){this['selectedVehicle']=_0x839b0c;_0xb6aa82=!![];}}this['drawTracks']();return _0xb6aa82;}['newTrackAbort'](){if(this['newTrack']['length']>0x0){this['newTrack']['forEach'](_0x4ea4e7=>_0x4ea4e7['abortTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramAbort'](){if(this['newLine']!==null){this['newLine']['abort']();this['drawTracks']();}this['disableTileHover']();}['newTrackFinalize'](){if(this['newTrack']['length']<0x2){this['newTrackAbort']();return;}if(this['newTrack']['length']>0x0){console['log'](this['newTrack']['map'](_0x5b5c46=>_0x5b5c46['hash'])['join']());this['newTrack']['forEach'](_0x51f5c4=>_0x51f5c4['finalizeTrack']());this['drawTracks']();this['newTrack']=[];}this['disableTileHover']();}['newTramFinalize'](_0x18ec4){if(this['newLine']!==null){var _0x375bae=this['newLine']['getTiles']();console['log'](_0x375bae['map'](_0x4af6c0=>_0x4af6c0['hash'])['join']());_0x375bae[0x0]['addVehicle'](new Tram(_0x375bae[0x0],_0x375bae[0x0]['getNeighbourConnection'](_0x375bae[0x1]),_0x18ec4,config['Tram']['numTypes'],_0x375bae));this['drawVehicles']();this['newTramAbort']();}}['removeSelectedTram'](){if(this['selectedVehicle']!==null){this['selectedVehicle']['disable']();this['selectedVehicle']=null;this['showTramClick'](-0x1,-0x1);}}};class Driver{};class CarDriver extends Driver{['leaveParkingLot'](){return Math['random']()<config['Driver']['probStepDrive'];}['parkNow'](){return Math['random']()<config['Driver']['probTilePark'];}['decideTurn'](_0x1e2153){return _0x1e2153[Math['floor'](Math['random']()*_0x1e2153['length'])];}['getLine'](){return null;}};class TramDriver extends Driver{constructor(_0x2895b5){super();this['tiles']=_0x2895b5;this['line']=_0x2895b5['map'](_0x165589=>_0x165589['hash']);this['lastLineIndex']=0x0;this['waitingTime']=0x0;}['leaveStop'](){this['waitingTime']+=0x1;if(this['waitingTime']>config['Driver']['waitAtStop']){this['waitingTime']=0x0;return!![];}return![];}['decideTurn'](_0x375716){var _0x2a1d05=this['line']['indexOf'](_0x375716['hash'],this['lastLineIndex']);if(_0x2a1d05<0x0){_0x2a1d05=this['line']['indexOf'](_0x375716['hash']);if(_0x2a1d05<0x0){return null;}}_0x2a1d05+=0x1;if(_0x2a1d05>this['line']['length']-0x1){_0x2a1d05=0x0;}this['lastLineIndex']=_0x2a1d05;return _0x375716['getNeighbourConnection'](this['line'][_0x2a1d05]);}['getLine'](){return this['tiles'];}};class BezierCurve{constructor(_0x2a0c6e){this['anchorPoints']=_0x2a0c6e;}['get'](_0x2c7c99){var _0x2fa991=this['anchorPoints']['length'];var _0x13f130=Array(_0x2fa991);var _0x2a5913=null;var _0x453435=null;for(_0x2a5913=0x0;_0x2a5913<_0x2fa991;_0x2a5913++){_0x13f130[_0x2a5913]=Array(_0x2fa991);}for(_0x2a5913=0x0;_0x2a5913<_0x2fa991;_0x2a5913++){_0x13f130[_0x2a5913][0x0]=this['anchorPoints'][_0x2a5913];}var _0x5f3553=0x0;var _0x1026b5=0x0;for(_0x453435=0x1;_0x453435<_0x2fa991;_0x453435++){for(_0x2a5913=0x0;_0x2a5913<_0x2fa991-_0x453435;_0x2a5913++){_0x5f3553=(0x1-_0x2c7c99)*_0x13f130[_0x2a5913][_0x453435-0x1]['x']+_0x2c7c99*_0x13f130[_0x2a5913+0x1][_0x453435-0x1]['x'];_0x1026b5=(0x1-_0x2c7c99)*_0x13f130[_0x2a5913][_0x453435-0x1]['y']+_0x2c7c99*_0x13f130[_0x2a5913+0x1][_0x453435-0x1]['y'];_0x13f130[_0x2a5913][_0x453435]=new Point(_0x5f3553,_0x1026b5);}}return _0x13f130[0x0][_0x2fa991-0x1];}['getPath'](_0x2de553){var _0x375398=[];var _0x3e4b83=0x0;var _0x1848da=this['anchorPoints'][0x0];var _0x47f8f0=null;var _0x4a3736=null;var _0x252edc=null;var _0x158666=null;var _0xfe6c32=null;var _0x637eb2=null;var _0x517afb=null;while(_0x3e4b83<0x1){_0x4a3736=_0x3e4b83;_0x252edc=0x0;_0x158666=0x0;_0xfe6c32=0x0;while(_0x252edc<_0x2de553){_0x4a3736+=0.005;_0x47f8f0=this['get'](_0x4a3736);_0x158666=_0x47f8f0['x']-_0x1848da['x'];_0xfe6c32=_0x47f8f0['y']-_0x1848da['y'];_0x252edc=Math['sqrt'](_0x158666*_0x158666+_0xfe6c32*_0xfe6c32);}_0x637eb2=Math['atan2'](_0x158666,-_0xfe6c32)*0xb4/Math['PI'];if(_0x637eb2<0x0){_0x637eb2+=0x168;}_0x517afb=new Point((_0x1848da['x']+_0x47f8f0['x'])/0x2,(_0x1848da['y']+_0x47f8f0['y'])/0x2);_0x517afb['head']=_0x637eb2;_0x375398['push'](_0x517afb);_0x1848da=new Point(_0x47f8f0['x'],_0x47f8f0['y']);_0x3e4b83=_0x4a3736;}return _0x375398['slice'](0x0,_0x375398['length']-0x1);}};class Vehicle{constructor(_0x427cee,_0x55b69b,_0x340898,_0x4a2725){this['hash']=generateRandomId();this['colorId']=_0x340898[Math['floor'](Math['random']()*_0x340898['length'])];this['typeId']=Math['floor'](Math['random']()*_0x4a2725);this['sprite']=null;this['bounds']={};this['tile']=_0x427cee;this['oldTile']='null';this['v']=0x0;this['head']=_0x55b69b;this['queue']=[];this['cachedHead']=null;this['cachedClosestHead']=null;this['cachedSpriteHead']=null;this['cachedSpritePosition']=new Point(null,null);this['start']();this['waitingTime']=0x0;this['collisionWith']=null;this['turnPath']=null;this['plannedHead']=null;this['error']=![];this['lastStop']=null;}['disable'](){this['y']=-0x64;this['error']=!![];this['tile']['removeVehicle'](this);this['sprite']['destroy']();this['queue']=[];}['equals'](_0xf68a86){return this['hash']===_0xf68a86['hash'];}['closeTo'](_0x235dcd,_0x148c58,_0x1836e4){return(_0x148c58-_0x235dcd['x'])**0x2+(_0x1836e4-_0x235dcd['y'])**0x2<0.5*(this['sprite']['height']+_0x235dcd['sprite']['height'])**0x2;}['startXY'](_0x115f25,_0x153934){this['x']=this['tile']['x'];if(_0x115f25===0x3c||_0x115f25===0x12c){this['x']+=config['Tile']['width']/0x4;}else{this['x']-=config['Tile']['width']/0x4;}this['y']=(_0x153934['nx']*(_0x153934['px']-this['x'])+_0x153934['ny']*_0x153934['py'])/_0x153934['ny'];}['draw'](_0x21bc49,_0xbd6940){if(this['sprite']===null){this['sprite']=game['add']['sprite'](0x0,0x0,this['colorId']);this['updateSprite'](this['x'],this['y'],this['getHead']());_0x21bc49['add'](this['sprite']);this['createBounds']();if(!_0xbd6940){this['setCursor']();}}}['createBounds'](){var _0xf2d01e=this['sprite']['width'];var _0x2f64d7=document['getElementById']('vehicle-canvas');var _0x2b0e4a=this['sprite']['texture']['baseTexture']['source'];_0x2f64d7['getContext']('2d')['drawImage'](_0x2b0e4a,0x0,0x0,_0x2b0e4a['width'],_0x2b0e4a['height']);var _0x444363=this['typeId']*_0xf2d01e;for(var _0x32f4aa=0x0;_0x32f4aa<config['Vehicle']['headingOrder']['length'];_0x32f4aa++){var _0x3cdde7=[];var _0x408c28=_0x32f4aa*_0xf2d01e;for(var _0x456a04=0x0;_0x456a04<0x168;_0x456a04+=config['Vehicle']['collisionSampling']){for(var _0x13a32c=0x0;_0x13a32c<_0xf2d01e;_0x13a32c++){var _0x28cbce=Math['round'](_0x13a32c*Math['sin'](_0x456a04*Math['PI']/0xb4));var _0x156121=-Math['round'](_0x13a32c*Math['cos'](_0x456a04*Math['PI']/0xb4));var _0x722f3=_0x2f64d7['getContext']('2d')['getImageData'](_0x28cbce+_0x408c28+Math['round'](_0xf2d01e/0x2),_0x156121+_0x444363+Math['round'](_0xf2d01e/0x2),0x1,0x1)['data'][0x3];if(_0x722f3<0xff){_0x3cdde7['push'](_0x28cbce);_0x3cdde7['push'](_0x156121);break;}}}this['bounds'][config['Vehicle']['headingOrder'][_0x32f4aa]]=new Phaser['Polygon'](_0x3cdde7);}}['getBounds'](){return this['bounds'][this['getHead']()];}['updateSprite'](_0x3d950d,_0x432bec,_0x3d230a){if(this['sprite']!==null){this['updateSpritePosition'](_0x3d950d,_0x432bec);this['updateSpriteFrame'](_0x3d230a);}}['updateSpritePosition'](_0x2549e0,_0x16df47){if(!this['cachedSpritePosition']['equals'](_0x2549e0,_0x16df47)){this['sprite']['x']=_0x2549e0-this['sprite']['width']/0x2;this['sprite']['y']=_0x16df47-this['sprite']['height']/0x2;this['sprite']['yz']=_0x16df47+this['sprite']['height']/0x2;this['cachedSpritePosition']=new Point(_0x2549e0,_0x16df47);}}['updateSpriteFrame'](_0x5c5f5e){_0x5c5f5e=convertInt(_0x5c5f5e);if(this['cachedSpriteHead']!==_0x5c5f5e){var _0x44d962=config['Vehicle']['headingOrder']['indexOf'](_0x5c5f5e);if(_0x44d962===-0x1){error('Heading\x20not\x20in\x20vehicle\x20sprite',this,this['disable']);return null;}this['sprite']['frame']=this['typeId']*config['Vehicle']['headingOrder']['length']+_0x44d962;this['cachedSpriteHead']=_0x5c5f5e;}}['click'](_0x42f7f4,_0x58dc90){if(this['sprite']!==null){return Phaser['Rectangle']['containsPoint'](this['sprite']['getBounds'](),new Phaser['Point'](_0x42f7f4,_0x58dc90));}return![];}['getLine'](){return this['driver']['getLine']();}['update'](){if(this['error']){return;}if(this['queue'][0x0]['call'](this)){this['queue']['shift']();}var _0x2f9040=0x1/config['World']['stepsPerSecond'];this['waitingTime']+=_0x2f9040;if(this['v']>0x0){var _0x4adf57=this['getHead']();var _0x4183cd=Math['sin'](_0x4adf57*Math['PI']/0xb4)*this['v']*_0x2f9040;var _0xf78771=-Math['cos'](_0x4adf57*Math['PI']/0xb4)*this['v']*_0x2f9040;if(this['collision'](this['x']+_0x4183cd,this['y']+_0xf78771,_0x4adf57)){this['queue']['splice'](0x0,0x0,this['callbackWait']);}else{this['waitingTime']=0x0;this['x']+=_0x4183cd;this['y']+=_0xf78771;this['enterNewTile']();if(!this['tile']['inside'](this['x'],this['y'])){error('Vehicle\x20has\x20left\x20its\x20tile',this,this['disable']);}this['updateSprite'](this['x'],this['y'],_0x4adf57);}}if(this['waitingTime']>config['Vehicle']['waitForever']&&this['collisionWith']!==null){if(this['collisionWith']['collidingWith'](this)){error('Vehicle\x20is\x20in\x20a\x20collision\x20loop',this,this['disable']);}}}['enterNewTile'](){if(this['tile']['inside'](this['x'],this['y'])){return;}for(var _0x371df3 of this['tile']['neighbours']){if(_0x371df3['inside'](this['x'],this['y'])){if(this['getHead']()===convertInt(this['tile']['getNeighbourConnection'](_0x371df3))){this['laneAssist']();if(this['tile']['inside'](this['x'],this['y'])){return;}}if(this['isInFront'](_0x371df3,this['x'],this['y'],this['head'])){this['oldTile']=this['tile']['hash'];this['tile']['removeVehicle'](this);this['tile']=_0x371df3;this['tile']['addVehicle'](this);this['plannedHead']=null;this['parkNow']();return;}}}}['getHead'](){if(this['cachedHead']!==this['head']){this['cachedHead']=this['head'];this['cachedClosestHead']=this['getClosestHead'](this['head'],![]);}return this['cachedClosestHead'];}['getNextHead'](_0x22f887){var _0x3194fd=config['Vehicle']['headingOrder']['indexOf'](this['getHead']())+_0x22f887;if(_0x3194fd<0x0){_0x3194fd+=config['Vehicle']['headingOrder']['length'];}else if(_0x3194fd>=config['Vehicle']['headingOrder']['length']){_0x3194fd-=config['Vehicle']['headingOrder']['length'];}return config['Vehicle']['headingOrder'][_0x3194fd];}['getClosestHead'](_0x4c1c8d,_0x5c429e){if(_0x4c1c8d<0x0||0x168<=_0x4c1c8d){error('Heading\x20out\x20of\x20range',this,this['disable']);return null;}var _0x5bf494=config['Vehicle']['headingOrder']['slice'](0x0);if(_0x5c429e){_0x5bf494['sort'](function(_0x9f6a23,_0x5cd599){return _0x9f6a23-_0x5cd599;});for(var _0x5332f2=0x0;_0x5332f2<_0x5bf494['length']-0x1;_0x5332f2++){if(_0x5bf494[_0x5332f2]<=_0x4c1c8d&&_0x4c1c8d<_0x5bf494[_0x5332f2+0x1]){return _0x5bf494[_0x5332f2];}}return _0x5bf494['reverse']()[0x0];}else{if(_0x4c1c8d>0x12c){_0x5bf494[config['Vehicle']['headingOrder']['indexOf'](0x0)]=0x168;}var _0x13844a=_0x5bf494['reduce'](function(_0x11fa3f,_0x3424ca){if(Math['abs'](_0x11fa3f-_0x4c1c8d)<Math['abs'](_0x3424ca-_0x4c1c8d)){return _0x11fa3f;}return _0x3424ca;});if(_0x13844a===0x168){return 0x0;}return _0x13844a;}}['getTurnPath'](_0x248939){var _0x564409=new Point(this['x'],this['y']);var _0x1a68db=this['tile']['getLaneTargetPoint'](_0x248939,config['Street']['laneDrive'],config['Street']['lanePointFactor']);var _0x5e0d04=getCurve(_0x564409,_0x1a68db,this['getHead'](),_0x248939,config['Street']['bezierFactor']);return _0x5e0d04['getPath'](config['Vehicle']['velocityTurn']/config['World']['stepsPerSecond']);}['laneAssist'](){var _0x2cefa7=this['tile']['getClosestPointInLane'](this['x'],this['y'],this['getHead'](),config['Street']['laneDrive']);this['x']=_0x2cefa7['x'];this['y']=_0x2cefa7['y'];}['isInFront'](_0x5604ac,_0x1a2f47,_0x40f3b9,_0x45def9){var _0x12c6bb=_0x5604ac['x']-_0x1a2f47;var _0x5ecdae=_0x5604ac['y']-_0x40f3b9;var _0x50724c=this['getHeadFromDxDy'](_0x12c6bb,_0x5ecdae);if(_0x45def9+0x3c<_0x50724c&&_0x50724c<_0x45def9+0x12c||_0x45def9+0x3c<_0x50724c+0x168&&_0x50724c+0x168<_0x45def9+0x12c){return![];}return!![];}['getHeadFromDxDy'](_0x20679a,_0x2612eb){var _0x2f0264=Math['atan2'](_0x20679a,-_0x2612eb)*0xb4/Math['PI'];if(_0x2f0264<0x0){_0x2f0264+=0x168;}return _0x2f0264;}['getMaxDistancePerStep'](){return Math['ceil'](this['v']/config['World']['stepsPerSecond']);}['collidingWith'](_0x31a80f){if(this['collisionWith']===null){return![];}return this['collisionWith']['equals'](_0x31a80f);}['collision'](_0x2975e9,_0x36e4e2,_0x2be5dc){var _0x554c8a=null;for(_0x554c8a of this['tile']['vehicles']){if(this['collideWith'](_0x554c8a,_0x2975e9,_0x36e4e2,_0x2be5dc)){this['collisionWith']=_0x554c8a;return!![];}}for(var _0x12b322 of this['tile']['neighbours']){for(_0x554c8a of _0x12b322['vehicles']){if(this['collideWith'](_0x554c8a,_0x2975e9,_0x36e4e2,_0x2be5dc)){this['collisionWith']=_0x554c8a;return!![];}}}this['collisionWith']=null;return![];}['collideWith'](_0x51807e,_0x3dc9a6,_0x470c71,_0x334dc7){if(this['equals'](_0x51807e)){return![];}if(_0x51807e['error']){return![];}if(!this['closeTo'](_0x51807e,_0x3dc9a6,_0x470c71)){return![];}if(_0x51807e['isParking']()){return![];}if(!this['isInFront'](_0x51807e,_0x3dc9a6,_0x470c71,_0x334dc7)){return![];}for(var _0x29a63d=0x4;_0x29a63d<0xd;_0x29a63d++){if(_0x51807e['getNextHead'](_0x29a63d)===_0x334dc7){return![];}}var _0x2fda5b=_0x51807e['x']-_0x3dc9a6;var _0x28503e=_0x51807e['y']-_0x470c71;var _0x107fbb=_0x51807e['getBounds']()['points'];for(var _0x10f20d of _0x107fbb){if(this['bounds'][_0x334dc7]['contains'](_0x10f20d['x']+_0x2fda5b,_0x10f20d['y']+_0x28503e)){return!![];}}return![];}['parkNow'](){}['callbackProceedToTargetLane'](_0x1ac2c7,_0x36ab17){if(_0x1ac2c7===null){_0x1ac2c7=this['plannedHead'];}this['v']=config['Vehicle']['velocityTurn'];var _0x2129d4=this['tile']['getDistanceToLane'](this['x'],this['y'],_0x1ac2c7,_0x36ab17);if(_0x2129d4<this['getMaxDistancePerStep']()){if(this['collision'](this['x'],this['y'],_0x1ac2c7)){this['v']=0x0;return![];}this['head']=_0x1ac2c7;return!![];}return![];}['callbackDrive'](){if(this['queue']['length']!==0x1){error('Callback\x20queue\x20corrupted',this,this['disable']);return!![];}if(this['tile']['isHighway']()||this['tile']['isGrass']()){this['v']=config['Vehicle']['velocityHighway'];}else{this['v']=config['Vehicle']['velocityCity'];}if(this['tile']['hasStop']()&&this['isOnStraight']()&&this['tile']['inside'](this['x'],this['y'],config['Vehicle']['centerSizeFactor'])){this['queue']['push'](this['callbackAtStop']);return!![];}if(this['tile']['isDeadEndOrJunctionOrCrossing']()){if(!(this['isOnNonIntersectingWay']()&&this['tile']['onlySameVehicleType']())){var _0x4ca104=this['tile']['getVehicleIndex'](this);for(var _0x417ade=0x0;_0x417ade<_0x4ca104;_0x417ade++){if(!this['tile']['vehicles'][_0x417ade]['isParking']()&&this['tile']['vehicles'][_0x417ade]['waitingTime']<=config['Vehicle']['waitBlocked']){this['v']=0x0;this['waitingTime']=0x0;return![];}}}}if(this['plannedHead']===null){if(!this['isOnStraight']()&&this['tile']['nearCenter'](this['x'],this['y'])){this['plannedHead']=this['getNextTurn']();if(this['plannedHead']===null){return!![];}if(this['plannedHead']===this['getHead']()){this['queue']['push'](this['callbackDrive']);}else{this['queue']['push'](this['callbackTurn']);this['queue']['push'](function(){return this['callbackProceedToTargetLane'](null,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);}return!![];}}return![];}['callbackWait'](){return!![];}['callbackTurn'](){this['v']=0.01;var _0x45fbbd=this['tile']['getDistanceToLane'](this['x'],this['y'],this['plannedHead'],config['Street']['laneDrive']);if(_0x45fbbd<this['getMaxDistancePerStep']()){this['turnPath']=null;return!![];}if(this['turnPath']===null){this['turnPath']=this['getTurnPath'](this['plannedHead']);}var _0x63e404=this['turnPath'][0x0]['head'];var _0x4a3117=this['turnPath'][0x0]['x'];var _0x2b9299=this['turnPath'][0x0]['y'];var _0x251cb8=this['getClosestHead'](_0x63e404,!![]);if(this['collision'](_0x4a3117,_0x2b9299,_0x251cb8)){this['v']=0x0;return![];}this['head']=_0x63e404;this['x']=_0x4a3117;this['y']=_0x2b9299;this['turnPath']['splice'](0x0,0x1);if(this['turnPath']['length']===0x0){this['turnPath']=null;return!![];}return![];}};class Car extends Vehicle{constructor(..._0x58461f){super(..._0x58461f);this['driver']=new CarDriver();}['isTram'](){return![];}['setCursor'](){}['start'](){var _0x3b136f=this['getHead']();var _0x43035c=this['tile']['getLane'](_0x3b136f,config['Street']['lanePark']);this['startXY'](_0x3b136f,_0x43035c);this['queue']=[this['callbackPark']];}['getNextTurn'](){var _0x4ae754=this['tile']['getStreetConnections']()['slice'](0x0);if(!this['tile']['isDeadEnd']()){var _0x7ed08=this['tile']['streetNeighbours']['map'](_0x3d89df=>_0x3d89df['hash']);if(_0x7ed08['includes'](this['oldTile'])){var _0x1e6227=this['tile']['neighbourConnections'][this['oldTile']];if(_0x4ae754['includes'](_0x1e6227)){_0x4ae754['splice'](_0x4ae754['indexOf'](_0x1e6227),0x1);}}}if(_0x4ae754['length']===0x0){error('Empty\x20connection\x20list',this,this['disable']);return null;}var _0x54a30a=this['tile']['getVehicleIndex'](this);for(var _0x1c4c03=0x0;_0x1c4c03<_0x54a30a;_0x1c4c03++){var _0x494a21=this['tile']['vehicles'][_0x1c4c03];if(_0x494a21['waitingTime']>config['Vehicle']['waitBlocked']&&_0x4ae754['length']>0x1){if(_0x4ae754['includes'](_0x494a21['getHead']())){_0x4ae754['splice'](_0x4ae754['indexOf'](_0x494a21['getHead']()),0x1);}else if(_0x4ae754['includes'](_0x494a21['plannedHead'])){_0x4ae754['splice'](_0x4ae754['indexOf'](_0x494a21['plannedHead']),0x1);}}}return this['driver']['decideTurn'](_0x4ae754);}['parkNow'](){if(this['queue'][0x0]===this['callbackDrive']&&this['driver']['parkNow']()&&this['tile']['hasFreeParkingLot'](this['getHead']())){this['queue']=[this['callbackEnterParkingLot']];}}['isOnStraight'](){return this['tile']['isStraight']();}['isOnNonIntersectingWay'](){return this['tile']['isStraight']()||this['tile']['isCurve']();}['isParking'](){return convertInt(this['v'])===0x0&&[this['callbackPark'],this['callbackLeaveParkingLot']]['includes'](this['queue'][0x0]);}['callbackEnterParkingLot'](){this['queue']['push'](function(){return this['callbackChangeLane'](0x1);});this['queue']['push'](function(){var _0x4c3b7c=this['getNextHead'](-0x2);return this['callbackProceedToTargetLane'](_0x4c3b7c,config['Street']['lanePark']);});this['queue']['push'](this['callbackPark']);return!![];}['callbackPark'](){this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveParkingLot']()){this['queue']['push'](this['callbackLeaveParkingLot']);return!![];}return![];}['callbackLeaveParkingLot'](){if(!this['tile']['onlySameVehicleType']()){return![];}for(var _0x14e5ec of this['tile']['vehicles']){if(!this['equals'](_0x14e5ec)&&!_0x14e5ec['isParking']()&&_0x14e5ec['getHead']()===this['getHead']()){return![];}}this['queue']['push'](function(){return this['callbackChangeLane'](-0x1);});this['queue']['push'](function(){var _0x58b42e=this['getNextHead'](0x2);return this['callbackProceedToTargetLane'](_0x58b42e,config['Street']['laneDrive']);});this['queue']['push'](this['callbackDrive']);return!![];}['callbackChangeLane'](_0x2cbe7c){this['head']=this['getNextHead'](0x2*_0x2cbe7c);return!![];}['callbackAtStop'](){this['queue']['push'](this['callbackDrive']);return!![];}};class Tram extends Vehicle{constructor(_0x48c914,_0x51455b,_0x256b08,_0x521daa,_0x62644f){super(_0x48c914,_0x51455b,_0x256b08,_0x521daa);this['driver']=new TramDriver(_0x62644f);}['isTram'](){return!![];}['setCursor'](){if(this['sprite']!==null){this['sprite']['inputEnabled']=!![];this['sprite']['events']['onInputOver']['add'](function(){UI['setCursorInfo']();});this['sprite']['events']['onInputOut']['add'](function(){UI['unsetCursorInfo']();});}}['start'](){var _0x4a5935=this['getHead']();var _0x21b21e=this['tile']['getLane'](_0x4a5935,config['Street']['laneDrive']);this['startXY'](_0x4a5935,_0x21b21e);this['queue']=[this['callbackDrive']];}['getNextTurn'](){var _0x323659=this['driver']['decideTurn'](this['tile']);if(_0x323659===null){error('Tram\x20does\x20not\x20find\x20a\x20way',this,this['disable']);return null;}return _0x323659;}['isOnStraight'](){return this['tile']['isStraightTrack']();}['isOnNonIntersectingWay'](){return this['tile']['isNonIntersectingTrack']();}['isParking'](){return![];}['callbackAtStop'](){if(this['tile']['equals'](this['lastStop'])){this['queue']['push'](this['callbackDrive']);return!![];}this['v']=0x0;this['waitingTime']=0x0;if(this['driver']['leaveStop']()){this['lastStop']=this['tile'];this['queue']['push'](this['callbackDrive']);return!![];}return![];}};class UI{static['disableSpinner'](){document['getElementById']('spinner')['style']['display']='none';}static['buttonNewTrack'](_0x2ec5b2,_0x4728f8){if(_0x2ec5b2){document['getElementById']('button-track')['classList']['remove']('button-disabled');}else{document['getElementById']('button-track')['classList']['add']('button-disabled');}if(_0x4728f8){document['getElementById']('button-track')['classList']['add']('button-active');}else{document['getElementById']('button-track')['classList']['remove']('button-active');}}static['buttonNewStop'](_0x1922d5,_0x4b389b){if(_0x1922d5){document['getElementById']('button-stop')['classList']['remove']('button-disabled');}else{document['getElementById']('button-stop')['classList']['add']('button-disabled');}if(_0x4b389b){document['getElementById']('button-stop')['classList']['add']('button-active');}else{document['getElementById']('button-stop')['classList']['remove']('button-active');}}static['buttonNewTram'](_0x1aac36,_0x166616){if(_0x1aac36){document['getElementById']('button-tram')['classList']['remove']('button-disabled');}else{document['getElementById']('button-tram')['classList']['add']('button-disabled');}if(_0x166616){document['getElementById']('button-tram')['classList']['add']('button-active');}else{document['getElementById']('button-tram')['classList']['remove']('button-active');}}static['buttonAbort'](_0x241f7c){if(_0x241f7c){document['getElementById']('button-abort')['classList']['remove']('button-disabled');}else{document['getElementById']('button-abort')['classList']['add']('button-disabled');}}static['buttonFinish'](_0x539d66){if(_0x539d66){document['getElementById']('button-finish')['classList']['remove']('button-disabled');}else{document['getElementById']('button-finish')['classList']['add']('button-disabled');}}static['setCursorDefault'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorOk'](){document['getElementById']('canvas')['classList']['add']('ok');document['getElementById']('canvas')['classList']['remove']('nok');}static['setCursorNok'](){document['getElementById']('canvas')['classList']['remove']('ok');document['getElementById']('canvas')['classList']['add']('nok');}static['setCursorInfo'](){if(state['isClickable']()){document['getElementById']('canvas')['classList']['add']('info');}}static['unsetCursorInfo'](){document['getElementById']('canvas')['classList']['remove']('info');}};class State{['abort'](_0x1d2729){}['finish'](_0x1a172f){}['click'](_0x558e1a,_0x20ef04,_0x43c78e){return this;}['hover'](_0x6ca0f1,_0x184ef2,_0xb620fe){}['isClickable'](){return![];}};class StateDefault extends State{static['change'](){return new StateDefault();}['setButtons'](){UI['buttonNewTrack'](!![],![]);UI['buttonNewStop'](!![],![]);UI['buttonNewTram'](!![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](![]);}['setCursor'](){UI['setCursorDefault']();}['click'](_0x70c602,_0x560d2c,_0x727fe0){if(_0x727fe0['showTramClick'](_0x70c602-game['camera']['x'],_0x560d2c-game['camera']['y'])){return StateTramInfo['change']();}return this;}['isClickable'](){return!![];}};class StateNewTrack extends State{static['change'](){return new StateNewTrack();}['setButtons'](){UI['buttonNewTrack'](!![],!![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x533807){_0x533807['newTrackAbort']();}['finish'](_0x4ea4be){_0x4ea4be['newTrackFinalize']();}['click'](_0x1dab3b,_0x11b2ab,_0x3c781e){_0x3c781e['newTrackClick'](_0x1dab3b,_0x11b2ab,![]);return this;}['hover'](_0x25d5b5,_0x359b19,_0x4d17be){if(_0x4d17be['newTrackClick'](_0x25d5b5,_0x359b19,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewStop extends State{static['change'](){return new StateNewStop();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](!![],!![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['click'](_0x3336e9,_0x29d7ec,_0x35ad41){_0x35ad41['newStopClick'](_0x3336e9,_0x29d7ec,![]);return this;}['hover'](_0x3bd010,_0x428072,_0x3fa639){if(_0x3fa639['newStopClick'](_0x3bd010,_0x428072,!![])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateNewTram extends State{static['change'](){return new StateNewTram();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](!![],!![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorNok']();}['abort'](_0x80d0b9){_0x80d0b9['newTramAbort']();}['finish'](_0x434d86){this['abort'](_0x434d86);}['click'](_0x36dd43,_0x5f1b89,_0x3b3e58){_0x3b3e58['newTramClick'](_0x36dd43,_0x5f1b89,![],loader['trams']);return this;}['hover'](_0x48888f,_0x1fa376,_0x9b7278){if(_0x9b7278['newTramClick'](_0x48888f,_0x1fa376,!![],loader['trams'])){UI['setCursorOk']();}else{UI['setCursorNok']();}}};class StateTramInfo extends State{static['change'](){return new StateTramInfo();}['setButtons'](){UI['buttonNewTrack'](![],![]);UI['buttonNewStop'](![],![]);UI['buttonNewTram'](![],![]);UI['buttonAbort'](!![]);UI['buttonFinish'](!![]);}['setCursor'](){UI['setCursorDefault']();}['abort'](_0x56923c){_0x56923c['removeSelectedTram']();}['finish'](_0x45dc4e){_0x45dc4e['showTramClick'](-0x1,-0x1);}['click'](_0x4c0572,_0xa2c20a,_0x6828ba){return StateDefault['change']()['click'](_0x4c0572,_0xa2c20a,_0x6828ba);}['isClickable'](){return!![];}};var game=new Phaser['Game']('100','100',Phaser['CANVAS'],'canvas',{'preload':preload,'create':create,'update':update});var loader=new Loader();var map=new Map();var state=StateDefault['change']();var config;var cursors;var mouseDown=![];var disableUI=!![];function loadConfig(_0x574c8a,_0x49d381,_0x1ea972,_0x21a432,_0x30dc2e){if(_0x49d381==='config'){config=game['cache']['getJSON']('config');loader['load']();}}function step(){map['update']();}function preload(){game['load']['onFileComplete']['add'](loadConfig,this);game['load']['text']('world','city/world.dat');game['load']['text']('tracks','city/tracks.dat');game['load']['text']('stops','city/stops.dat');game['load']['text']('trams','city/trams.dat');game['load']['json']('config','city/config.json');}function updateUI(){state['setButtons']();state['setCursor']();}function create(){cursors=game['input']['keyboard']['createCursorKeys']();game['kineticScrolling']=game['plugins']['add'](Phaser['Plugin']['KineticScrolling']);game['kineticScrolling']['configure']({'kineticMovement':!![],'timeConstantScroll':0x145,'horizontalScroll':!![],'verticalScroll':!![],'horizontalWheel':![],'verticalWheel':![]});game['kineticScrolling']['start']();game['stage']['backgroundColor']=config['Street']['color'];map['loadMap'](game['cache']['getText']('world'));map['initTiles']();map['loadTracks'](game['cache']['getText']('tracks'));map['loadStops'](game['cache']['getText']('stops'));map['generateItems'](loader['houses'],loader['trees'],loader['cars']);map['loadTrams'](game['cache']['getText']('trams'),loader['trams']);game['world']['resize'](map['getWidth'](),map['getHeight']());document['getElementById']('vehicle-canvas')['width']=config['Tram']['imgSize']*config['Vehicle']['headingOrder']['length'];document['getElementById']('vehicle-canvas')['height']=config['Tram']['imgSize']*config['Vehicle']['headingOrder']['length'];map['draw']();var _0x23324b=0x3e8/config['World']['stepsPerSecond'];game['time']['events']['loop'](_0x23324b,step);var _0x4af72c=Math['max'](0x1,window['devicePixelRatio']*0.6);game['camera']['scale']['setTo'](_0x4af72c,_0x4af72c);if(disableUI){document['getElementById']('button-track')['style']['display']='none';document['getElementById']('button-stop')['style']['display']='none';document['getElementById']('button-tram')['style']['display']='none';document['getElementById']('button-abort')['style']['display']='none';document['getElementById']('button-finish')['style']['display']='none';}else{document['getElementById']('button-track')['addEventListener']('click',onButtonTrack);document['getElementById']('button-stop')['addEventListener']('click',onButtonStop);document['getElementById']('button-tram')['addEventListener']('click',onButtonTram);document['getElementById']('button-abort')['addEventListener']('click',onButtonAbort);document['getElementById']('button-finish')['addEventListener']('click',onButtonFinish);}UI['disableSpinner']();updateUI();}function onButtonTrack(){state=StateNewTrack['change']();updateUI();}function onButtonStop(){state=StateNewStop['change']();updateUI();}function onButtonTram(){state=StateNewTram['change']();updateUI();}function onTramInfo(){state=StateTramInfo['change']();updateUI();}function onButtonAbort(){state['abort'](map);state=StateDefault['change']();updateUI();}function onButtonFinish(){state['finish'](map);state=StateDefault['change']();updateUI();}function update(){if(cursors['up']['isDown']){game['camera']['y']-=0x14;}else if(cursors['down']['isDown']){game['camera']['y']+=0x14;}if(cursors['left']['isDown']){game['camera']['x']-=0x14;}else if(cursors['right']['isDown']){game['camera']['x']+=0x14;}if(!disableUI){if(game['input']['mousePointer']['leftButton']['isDown']){mouseDown=!![];}if(game['input']['mousePointer']['leftButton']['isUp']&&mouseDown){mouseDown=![];state=state['click'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);updateUI();}else{state['hover'](game['input']['mousePointer']['worldX'],game['input']['mousePointer']['worldY'],map);}}}